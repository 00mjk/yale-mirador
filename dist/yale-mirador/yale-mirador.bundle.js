window._YaleMiradorVersion="Yale-Mirador v0.8.2-22-g69fc174 built Tue Nov 27 2018 12:27:47 GMT-0500 (Eastern Standard Time)",function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/public/",e(e.s=19)}([function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){o||(o=new i);return o};var o=null,i=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.DEBUG=0,this.INFO=1,this.WARNING=2,this.ERROR=3,this._logLevel=n||this.INFO}return r(t,[{key:"setLogLevel",value:function(t){this._logLevel=t}},{key:"error",value:function(){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];(t=console).error.apply(t,["ERROR"].concat(e))}},{key:"warning",value:function(){if(this._logLevel<=this.WARNING){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];(t=console).warn.apply(t,["WARNING"].concat(e))}}},{key:"info",value:function(){if(this._logLevel<=this.INFO){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];(t=console).info.apply(t,["INFO"].concat(e))}}},{key:"debug",value:function(){if(this._logLevel<=this.DEBUG){for(var t,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];(t=console).log.apply(t,["DEBUG"].concat(e))}}}]),t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.annoUtil=n.Anno=void 0;var r=i(e(6)),o=i(e(23));function i(t){return t&&t.__esModule?t:{default:t}}n.Anno=r.default,n.annoUtil=o.default},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StateStore=void 0;var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){c||(c=new s);return c};var o,i=e(0);var a=(0,((o=i)&&o.__esModule?o:{default:o}).default)(),u=new Set(["annotationLayers","lastSelectedLayer","layerIndexMap","textDirection"]),s=n.StateStore=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._settings={},this._state={},this._localStorageAvailable=function(t){try{var n=window[t],e="__storage_test__";return n.setItem(e,e),n.removeItem(e),!0}catch(t){return!1}}("localStorage")}return r(t,[{key:"init",value:function(t){this._settings=t}},{key:"getSetting",value:function(){for(var t=this._settings,n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];var o=!0,i=!1,a=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){if(void 0===(t=t[u.value]))return}}catch(t){i=!0,a=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}return t}},{key:"getTransient",value:function(t){return this._checkKey(t),this._settings[t]}},{key:"setTransient",value:function(t,n){this._checkKey(t),this._settings[t]=n}},{key:"getString",value:function(t){this._checkKey(t);var n=this._settings[t];return n||(n=this._localStorageAvailable?localStorage.getItem(t):null,this._settings[t]=n),n}},{key:"setString",value:function(t,n){this._checkKey(t),this._settings[t]=n,this._localStorageAvailable&&localStorage.setItem(t,n)}},{key:"getBoolean",value:function(t){return"true"===this.getString(t)}},{key:"setBoolean",value:function(t,n){this.setString(t,n?"true":"false")}},{key:"getObject",value:function(t){a.debug("StateStore#getObject",t),this._checkKey(t);var n=this.getString(t);return n?JSON.parse(n):null}},{key:"setObject",value:function(t,n){a.debug("StateStore#setObject",t,n),this._checkKey(t);var e=JSON.stringify(n);this.setString(t,e)}},{key:"_checkKey",value:function(t){if(!u.has(t))throw"ERROR Invalid key for StateStore "+t}}]),t}();var c=null},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=u(e(0)),i=u(e(24)),a=u(e(7));function u(t){return t&&t.__esModule?t:{default:t}}(0,o.default)();var s=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._miradorProxiesMap={}}return r(t,[{key:"addMirador",value:function(t,n){var e=this._miradorProxiesMap[t];if(e)throw"MiradorProxyManager#addMirador duplicate ID "+t;return e=new i.default(n,t),this._miradorProxiesMap[t]=e,e}},{key:"getMiradorProxies",value:function(){return Object.values(this._miradorProxiesMap)}},{key:"getMiradorProxy",value:function(t){return this._miradorProxiesMap[t]||null}},{key:"getMiradorProxyByWindowId",value:function(t){var n=!0,e=!1,r=void 0;try{for(var o,i=Object.values(this._miradorProxiesMap)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value;if(a.getWindowById(t))return a}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return null}},{key:"getAllWindowProxies",value:function(){var t=[],n=!0,e=!1,r=void 0;try{for(var o,i=Object.values(this._miradorProxiesMap)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value;t=t.concat(a.getWindowProxies())}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return t}},{key:"getWindowProxyById",value:function(t){var n=this.getWindowById(t);return n?new a.default(n):null}},{key:"getWindowById",value:function(t){var n=null,e=!0,r=!1,o=void 0;try{for(var i,a=Object.values(this._miradorProxiesMap)[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){if(n=i.value.getWindowById(t))return n}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}return null}},{key:"getCurrentCanvasIdByWindowId",value:function(t){var n=this.getWindowProxyById(t);return n?n.getCurrentCanvasId():null}},{key:"anyId",value:function(){return Object.keys(this._miradorProxies)[0]}},{key:"subscribe",value:function(t,n){var e=!0,r=!1,o=void 0;try{for(var i,a=Object.values(this._miradorProxiesMap)[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.subscribe(t,n)}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}}}]),t}(),c=null;function l(t){return c&&!t||(c=new s),c}n.default=l,Mirador.getMiradorProxyManager=l},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getApp=n.App=void 0;var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();e(22);var o=e(1),i=h(e(42)),a=h(e(11)),u=h(e(43)),s=(h(e(12)),h(e(14))),c=(h(e(44)),h(e(0))),l=h(e(10)),f=h(e(2)),d=h(e(45));function h(t){return t&&t.__esModule?t:{default:t}}function v(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}e(56);var g=(0,c.default)(),p=null,y=null,m=null,_=n.App=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._setupLogger(),this._state=(0,f.default)(),this.initHandlebars()}return r(t,[{key:"init",value:function(){var t=v(regeneratorRuntime.mark(function t(n){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return g.debug("App#init settings:",n),t.next=3,this.initState(n);case 3:return t.next=5,(0,s.default)();case 5:return this._preConfigureTinyMce(n.mirador.buildPath+"/"),this._setupAnnotationTocCache(),e=new d.default(n.ui.rootElementId),this._pageController=(0,l.default)(),this._pageController.init({grid:e,appSettings:n,appState:this._state}),t.abrupt("return",this);case 11:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"initHandlebars",value:function(){Handlebars.registerHelper("t",function(t){return i18next.t(t)})}},{key:"initState",value:function(){var t=v(regeneratorRuntime.mark(function t(n){var e,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return g.debug("App#initState settings:",n),(e=this._state).init(n),r=this.getAnnotationExplorer(),t.next=6,r.getLayers();case 6:o=t.sent,e.setTransient("annotationLayers",o);case 8:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_setupLogger",value:function(){"#debug"===window.location.hash?g.setLogLevel(g.DEBUG):g.setLogLevel(g.INFO),o.annoUtil.setLogger(g)}},{key:"_preConfigureTinyMce",value:function(t){g.debug("App#preConfigureTinyMce buildPath:",t),tinymce.base=t+"/",tinymce.setup()}},{key:"_setupAnnotationTocCache",value:function(){var t=this._state.getSetting("annotations","tocSpec");this._annotationTocCache=t?new u.default({tocSpec:t,annotationExplorer:this.getAnnotationExplorer()}):null}},{key:"getAnnotationExplorer",value:function(){return y||(y=new i.default({dataSource:this.getAnnotationSource(),logger:g})),y}},{key:"getAnnotationSource",value:function(){if(!m){var t=this._state.getSetting("annotations","store");m=new a.default({prefix:t,state:this._state})}return m}},{key:"getAnnotationTocCache",value:function(){return this._annotationTocCache}}]),t}(),b=n.getApp=function(){return p||(p=new _),p};n.default=b},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=e(2),i=(r=o)&&r.__esModule?r:{default:r};n.default={serverSettings:null,loggedIn:function(){return"true"==Cookies.get("loggedIn")},isEditor:function(){return"true"==Cookies.get("isEditor")||(0,i.default)().getSetting("auth","isEditor")}}},function(t,n,e){"use strict";function r(t){return new o(t)}e.r(n),e.d(n,"default",function(){return r});class o{constructor(t){this.oaAnnotation=t}get id(){return this.oaAnnotation["@id"]}get layerId(){return this.oaAnnotation.layerId}get layers(){return this.oaAnnotation.layers}get bodyText(){const t=this._getTextResource();return t?t.chars:null}set bodyText(t){const n=this._getTextResource();return!!n&&(n.chars=t,!0)}get bodyStyle(){const t=this._getTextResource();return t?t.style:null}get tags(){const t=this._makeArray(this.oaAnnotation.resource),n=[];for(let e of t)"oa:Tag"===e["@type"]&&n.push(e.chars);return n}addTag(t){const n=this._makeArray(this.oaAnnotation.resource);n.push(this._createTag(t)),this.oaAnnotation.resource=n}get targets(){return this._makeArray(this.oaAnnotation.on)}addTarget(t){const n=this.oaAnnotation;n.on=this._makeArray(n.on),n.on.push(t)}get targetedBy(){return this._makeArray(this.oaAnnotation.targetedBy)}addInverseTarget(t){const n=this.oaAnnotation;n.targetedBy=this._makeArray(n.targetedBy),n.targetedBy.push(t)}_makeArray(t){return"null"==typeof t||void 0===t?[]:t instanceof Array?t:[t]}_getTextResource(){const t=this._makeArray(this.oaAnnotation.resource).filter(t=>"dctypes:Text"===t["@type"]);return t.length>0?(t.length>1&&console.log("WARNING Annotation#_getTextResource too many text items:",t.length),t[0]):null}_createTag(t){return{"@type":"oa:Tag",chars:t}}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);(0,((r=i)&&r.__esModule?r:{default:r}).default)();var a=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.window=n}return o(t,[{key:"getWindowId",value:function(){return this.window.id}},{key:"getManifest",value:function(){return this.window.manifest}},{key:"getCurrentCanvasId",value:function(){return this.window.canvasID}},{key:"getCurrentCanvas",value:function(){var t=this.getCanvases(),n=this.getCurrentCanvasId();return t.filter(function(t){return t["@id"]===n})[0]}},{key:"setCurrentCanvasId",value:function(t,n){this.window.setCurrentCanvasID(t,n)}},{key:"getImageView",value:function(){return this.window.focusModules.ImageView}},{key:"getEndPoint",value:function(){return this.window.endpoint}},{key:"getCanvases",value:function(){return this.window.manifest.getCanvases()}},{key:"getAnnotationsList",value:function(){return this.window.annotationsList}},{key:"getSvgOverlay",value:function(){var t=this.getDrawTool();return t?t.svgOverlay:null}},{key:"getDrawTool",value:function(){var t=this.getImageView();return t?t.annotationsLayer.drawTool:null}},{key:"getSidePanel",value:function(){return this.window.sidePanel}},{key:"getSidePanelTabContentElement",value:function(t){return this.getSidePanel().element.find(".tabContentArea > ."+t)}}]),t}();n.default=a},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){i||(i=new o);return i};var o=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.dimmer=this.addDimmer(),this.panel=this.addPanel()}return r(t,[{key:"addDimmer",value:function(){return jQuery("<div/>").addClass("ym-dimmer").appendTo(jQuery("body"))}},{key:"addPanel",value:function(){return jQuery("<div/>").attr("id","ym-modal-alert").addClass("ym-message-panel").appendTo(jQuery("body"))}},{key:"show",value:function(t){return this.dimmer.show(),this.panel.text(t),this.panel.show(),new Promise(function(t,n){setTimeout(function(){t()},50)})}},{key:"hide",value:function(){this.panel.hide(),this.dimmer.hide()}}]),t}(),i=null},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=e(0),i=(r=o)&&r.__esModule?r:{default:r};n.default={isMobileOrTablet:function(){return t=navigator.userAgent||navigator.vendor||window.opera,!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)));var t},getValues:function(t){var n=[];return jQuery.each(t,function(t,e){n.push(e)}),n},waitUntil:function(t,n,e,r){var o=this;if(void 0===e&&(e=100),void 0===r&&(r=1),r>5)return this.logger.debug("util.waitUntil max try num exceeded: giving up"),this.logger.debug("testFunc: "+t),void this.logger.debug("execFunc: "+n);t()?n():(this.logger.debug("util.waitUntil trial "+r+" failed. Retrying in "+2*e+" ms."),setTimeout(function(){o.waitUntil(t,n,2*e,r+1)},e))},directionClasses:["horizontal-lr","horizontal-rl","vertical-lr","vertical-rl"],setTextDirectionClass:function(t,n){this.directionClasses.includes(n)||((0,i.default)().debug("util.setTextDriectionClass no class provided, using horizontal-lr"),n="horizontal-lr");var e=!0,r=!1,o=void 0;try{for(var a,u=this.directionClasses[Symbol.iterator]();!(e=(a=u.next()).done);e=!0){var s=a.value;s===n?t.addClass(s):t.removeClass(s)}}catch(t){r=!0,o=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw o}}}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){d||(d=new v);return d};var o=e(1),i=l(e(4)),a=l(e(0)),u=(l(e(3)),l(e(26))),s=l(e(27)),c=l(e(5));function l(t){return t&&t.__esModule?t:{default:t}}function f(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var d=null,h=(0,a.default)(),v=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,[{key:"init",value:function(t){h.debug("PageController#init options:",t),this._grid=t.grid,this._settings=t.appSettings,this._state=t.appState;var n=jQuery.extend(this._settings,{miradorId:Mirador.genUUID(),defaultSettings:Mirador.DEFAULT_SETTINGS,isEditor:c.default.isEditor()});this._miradorWrapper=this._createMirador(n),this._miradorProxy=this._miradorWrapper.getMiradorProxy(),this._miradorId=this._miradorProxy.getId(),this._tocSpec=this._state.getSetting("annotations","tocSpec"),this._annotationTocCache=(0,i.default)().getAnnotationTocCache(),this._annotationExplorer=(0,i.default)().getAnnotationExplorer(),this._bindEvents(n)}},{key:"getConfig",value:function(){return this.miradorWrapper.getConfig()}},{key:"_createMirador",value:function(t){try{return this._grid.addMiradorWindow(t.miradorId),new s.default({grid:this._grid,miradorOptions:t})}catch(t){var n="PageController#_createMirador "+t;throw h.error(n),n}}},{key:"_showAnnotation",value:function(){var t=f(regeneratorRuntime.mark(function t(n,e){var r,i,a,u,s,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.debug("PageController#showAnnotation windowId:",n,"annoId:"+e,"defaultLayer:",this._tocSpec?this._tocSpec.defaultLayer:null),r=this._grid,i=this._miradorProxy.getWindowProxyById(n),a=i.getCurrentCanvasId(),t.next=6,this._annotationExplorer.getAnnotations({canvasId:a});case 6:if(u=t.sent,s=u.filter(function(t){return t["@id"]===e})[0],c=s.layerId,!this._tocSpec||!this._tocSpec.defaultLayer){t.next=15;break}return t.next=12,this._getAnnotationByTagsAndLayer((0,o.Anno)(s).tags,this._tocSpec.defaultLayer,a);case 12:l=t.sent,c=this._tocSpec.defaultLayer,l?s=l:h.warning("PageController#_showAnnotation no annotation found for layer",c);case 15:if(r.getAnnotationWindowByLayer(c)){t.next=24;break}if(!s){t.next=23;break}return t.next=20,r.addAnnotationWindow({miradorId:this._miradorId,imageWindowId:n,layerId:c,annotationId:s["@id"]}).catch(function(t){h.error("PageController#_showAnnotation addAnnotationWindow failed <- "+t)});case 20:t.sent,t.next=24;break;case 23:h.error("PageController#_showAnnotation annotation not found in annotation window, annoId: "+s["@id"]);case 24:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"_getAnnotationByTagsAndLayer",value:function(){var t=f(regeneratorRuntime.mark(function t(n,e,r){var i,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._annotationTocCache.getToc(r);case 2:if(i=t.sent,a=i.getNodeFromTags(n)){t.next=7;break}return h.warning("PageController#_getAnnotationByTagsAndLayer tocNode not found for tags",n),t.abrupt("return",null);case 7:return u=o.annoUtil.findAllAnnotationsForTocNode(a).filter(function(t){return t.layerId===e}),t.abrupt("return",u[0]);case 9:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"_createAnnotationWindows",value:function(t,n){var e=(0,i.default)().getAnnotationExplorer().getAnnotationToc(),r=new u.default({miradorId:n.miradorId,imageWindowId:t,layerIds:n.layerIds,toc:e,tocTags:n.tocTags,annotationId:n.annotationId}).getWindowsConfig();h.debug("PageController#_createAnnotationWindows windowsConfig:",r),r&&(this._miradorProxy.publish("YM_DISPLAY_ON"),jQuery.publish("YM_ADD_WINDOWS",r))}},{key:"_processUrlOptions",value:function(t,n){var e=this;if(h.debug("PageController#_processUrlOptions imageWindowId:",t,"options:",n,"_urlOptionsProcessed:",this._urlOptionsProcessed),!this._urlOptionsProcessed){this._urlOptionsProcessed=!0;var r=this._state.getSetting("initialLayout","windows")[0],o=r?r.annotation:null;if((this._state.getSetting("mirador","annotationsOverlay","showByDefault")||o)&&this._miradorProxy.publish("YM_DISPLAY_ON"),o){n.annotationId=o,this._miradorProxy.subscribe("annotationsRendered."+t,function r(o){h.debug("PageController#_processUrlOptions annotationsRendered"),e._zoomToAnnotation(n.annotationId,t),e._miradorProxy.unsubscribe("annotationsRendered."+t,r)})}this._createAnnotationWindows(t,n)}}},{key:"_findCanvasAnnotationsFromTargets",value:function(t,n,e){h.debug("PageController#_findCanvasAnnotationsFromTargets sourceAnnotation:",t,"allAnnotations:",n,"canvasId:",e);var r={},i=!0,a=!1,u=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value;r[l["@id"]]=l}}catch(t){a=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}return o.annoUtil.findTransitiveTargetAnnotations(t,r).filter(function(t){var n=!0,r=!1,i=void 0;try{for(var a,u=(0,o.Anno)(t).targets[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){if(a.value.full===e)return!0}}catch(t){r=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}})}},{key:"_zoomToAnnotation",value:function(t,n){var e=this._miradorProxy.getWindowProxyById(n),r=e.getImageView(),o=e.getCurrentCanvasId(),i=e.getAnnotationsList(),a=i.filter(function(n){return n["@id"]===t});(a=this._findCanvasAnnotationsFromTargets(a[0],i,o)).length>0?(a.length>1&&h.error("PageController#_zoomToAnnotation",a.length,"duplicate annos:",a,"imageWindowId:",n),h.debug("PageController#_zoomToAnnotation canvas annos:",a),r.zoomToAnnotation(a[0]),r.panToAnnotation(a[0]),r.annotationsLayer.drawTool.updateHighlights(a[0])):h.error("PageController#_zoomToAnnotation annotation not found: annotationId:",t,"imageWindowId:",n)}},{key:"_bindEvents",value:function(t){var n=this;h.debug("PageController#_bindEvents options:",t);var e,r,i=this;jQuery(window).resize(function(){i._grid.resize()}),this._miradorProxy.subscribe("ANNOTATIONS_LIST_UPDATED",function(e,r){h.debug("PageController:SUB:ANNOTATIONS_LIST_UPDATED params:",r),n._miradorProxy.shouldIgnoreEvent("ANNOTATIONS_LIST_UPDATED")?n._miradorProxy.unmarkEventToBeIgnored("ANNOTATIONS_LIST_UPDATED"):n._processUrlOptions(r.windowId,t)}),this._miradorProxy.subscribe("YM_IMAGE_WINDOW_TOOLTIP_ANNO_CLICKED",(e=f(regeneratorRuntime.mark(function t(e,r,o){var i,a,u,s,c,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("PageController:SUB:YM_IMAGE_WINDOW_TOOLTIP_ANNO_CLICKED windowId: "+r+", annoId: "+o),i=n._miradorProxy.getWindowProxyById(r),a=i.getCurrentCanvasId(),u=i.getSidePanelTabContentElement("ym-annotation-toc"),s=u.data("AnnotationTableOfContent"),n._showAnnotation(r,o),!s){t.next=12;break}return t.next=9,n._annotationTocCache.getToc(a);case 9:c=t.sent,(l=c.annotations.filter(function(t){return t["@id"]===o})[0])&&s.scrollToTags(l.tocTags);case 12:case"end":return t.stop()}},t,n)})),function(t,n,r){return e.apply(this,arguments)})),jQuery.subscribe("ANNOWIN_ANNOTATION_FOCUSED",function(t,e){h.debug("PageController has received event ANNOWIN_ANNOTATION_FOCUSED with options",e);var r=n._miradorProxy.getWindowProxyById(e.imageWindowId),i=r.getCurrentCanvasId(),a=r.getImageView(),u=r.getAnnotationsList(),s={};if(e.canvasId===r.getCurrentCanvasId()){var c=!0,l=!1,f=void 0;try{for(var d,v=u[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var g=d.value;s[g["@id"]]=g}}catch(t){l=!0,f=t}finally{try{!c&&v.return&&v.return()}finally{if(l)throw f}}var p=e.annotation;if(!o.annoUtil.hasTargetOnCanvas(p))p=n._findCanvasAnnotationsFromTargets(p,u,i)[0];p?(a.zoomToAnnotation(p),a.panToAnnotation(p),a.annotationsLayer.drawTool.updateHighlights(p)):h.error("PageController:SUB:ANNOWIN_ANNOTATION_FOCUSED annotation not found",e.annotation)}else a._annotationToBeFocused=e.annotation,r.setCurrentCanvasId(e.canvasId)}),jQuery.subscribe("YM_ANNOTATION_TOC_TAGS_SELECTED",(r=f(regeneratorRuntime.mark(function t(e,r,o,i){var a,u,s,c,l,f,d,v,g;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.debug("PageController:SUB:YM_ANNOTATION_TOC_TAGS_SELECTED imageWindow:",r,"canvasId:",o,"tags:",i),a=n._grid,u=n._tocSpec.defaultLayer,s=a.getAnnotationWindowByLayer(u),t.prev=4,n._miradorProxy.publish("YM_DISPLAY_ON"),t.next=8,new Promise(function(t,n){setTimeout(function(){t()},0)});case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(4),h.error("PageController#SUB:YM_ANNOTATION_TOC_TAGS_SELECTED failed to enable annotation layer");case 13:for(c=n._grid.getAnnotationWindows(),l=!0,f=!1,d=void 0,t.prev=17,v=Object.values(c)[Symbol.iterator]();!(l=(g=v.next()).done);l=!0)g.value.ignoreEvent("ANNOTATIONS_LIST_UPDATED",35e3);t.next=25;break;case 21:t.prev=21,t.t1=t.catch(17),f=!0,d=t.t1;case 25:t.prev=25,t.prev=26,!l&&v.return&&v.return();case 28:if(t.prev=28,!f){t.next=31;break}throw d;case 31:return t.finish(28);case 32:return t.finish(25);case 33:return t.next=35,n._miradorWrapper.zoomToTags(r,o,i).catch(function(t){h.error("PageController:SUB:YM_ANNOTATION_TOC_TAGS_SELECTED zoomToTags failed:",t)});case 35:if(s){t.next=39;break}return t.next=38,a.addAnnotationWindow({miradorId:n._miradorId,imageWindowId:r,layerId:u,tocTags:i}).catch(function(t){h.error("PageController#_showAnnotation addAnnotationWindow failed <- "+t)});case 38:s=t.sent;case 39:case"end":return t.stop()}},t,n,[[4,10],[17,21,25,33],[26,,28,32]])})),function(t,n,e,o){return r.apply(this,arguments)}))}}]),t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=(e(1),c(e(14))),i=c(e(4)),a=e(15),u=c(e(0)),s=c(e(8));c(e(10)),c(e(2));function c(t){return t&&t.__esModule?t:{default:t}}function l(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var f=(0,u.default)(),d=function(t){t.setRequestHeader("Authorization","Bearer "+Cookies.get("jwtToken"))},h=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._prefix=n.prefix,this._state=n.state,this._layers=null}return r(t,[{key:"getLayers",value:function(){var t=l(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f.debug("AnnotationSource#getLayers"),n=null,!this._layers){t.next=7;break}f.debug("AnnotationSource#getLayers hit cache",this._layers),n=this._layers,t.next=11;break;case 7:return t.next=9,this._getRemoteLayers();case 9:n=t.sent,this._updateLayerIndex(n);case 11:return t.abrupt("return",n);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_getRemoteLayers",value:function(){var t=this;return new Promise(function(n,e){var r=t._state.getSetting("auth","groupId"),o=t._prefix+"/layers";r&&(o+="?group_id="+r),f.debug("AnnotationSource#_getRemoteLayers url:",o),jQuery.ajax({url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:d,success:function(e,r,o){f.debug("AnnotationSource#getLayers layers: ",e),t._layers=e,n(e)},error:function(t,n,r){var i="AnnotationSource#getLayers error status code: "+t.status+", textStatus: "+n+", errorThrown: "+r+", URL: "+o;f.error(i),e(i)}})})}},{key:"_updateLayerIndex",value:function(t){if(f.debug("AnnotationSource#_updateLayerIndex"),!this._state.getTransient("layerIndexMap")){var n={},e=0;t.forEach(function(t){n[t["@id"]]=e,++e}),this._state.setTransient("layerIndexMap",e>0?n:null)}return t}},{key:"getAnnotations",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.canvasId,r=n.layerId,t.next=4,(0,o.default)();case 4:return i=t.sent,a=null,t.next=8,(0,s.default)().show("Retrieving annotations...");case 8:if(!i){t.next=13;break}return t.next=11,i.getAnnotationsPerCanvas(e);case 11:a=t.sent,f.debug("AnnotationSource#getAnnotations from cache:",a);case 13:if(a){t.next=20;break}return t.next=16,this._getRemoteAnnotations(e);case 16:if(a=t.sent,!i){t.next=20;break}return t.next=20,i.setAnnotationsPerCanvas(e,a);case 20:return this._attachEndpoint(a),r&&(a=a.filter(function(t){return t.layerId===r})),(0,s.default)().hide(),t.abrupt("return",a);case 24:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_attachEndpoint",value:function(t){f.debug("AnnotationSource#_attachEndpoint annotations:",t);var n=(0,a.getEndpoint)(),e=!0,r=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){i.value.endpoint=n}}catch(t){r=!0,o=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw o}}}},{key:"_detachEndpoint",value:function(t){f.debug("AnnotationSource#_detachEndpoint annotations:",t);var n=!0,e=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){delete o.value.endpoint}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}}},{key:"_getRemoteAnnotations",value:function(t){var n=this;return f.debug("AnnotationSource#_getRemoteAnnotations canvas: "+t),new Promise(function(e,r){var o=n._prefix+"/getAnnotationsViaList?canvas_id="+encodeURIComponent(t);f.debug("AnnotationSource#_getRemoteAnnotations url: ",o);jQuery.ajax({url:o,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:d,success:function(r,o,i){f.debug("AnnotationSource#_getRemoteAnnotations data: ",r);try{var a=[],u=!0,s=!1,c=void 0;try{for(var l,d=r[Symbol.iterator]();!(u=(l=d.next()).done);u=!0){var h=l.value,v=h.annotation;v.layerId=h.layer_id,a.push(n._toMiradorAnnotation(v))}}catch(t){s=!0,c=t}finally{try{!u&&d.return&&d.return()}finally{if(s)throw c}}e(a)}catch(n){f.error("AnnotationSource#_getRemoteAnnotations error parsing data for canvas",t,"data:",r,"error:",n),e([])}},error:function(t,n,e){var i="AnnotationSource#getAnnotations failed to get annotations from "+o;f.error(i),r({code:t.status,message:i})}})})}},{key:"createAnnotation",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r,u,s,c,h=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("AnnotationSource#createAnnotation oaAnnotation:",n),t.next=3,(0,o.default)();case 3:return e=t.sent,r=n.layerId,u=this._toBackendAnnotation(n),s=this._prefix+"/annotations",c={layer_id:r,annotation:u},f.debug("AnnotationSource#createAnnotation payload:",c),t.abrupt("return",new Promise(function(t,n){var o;jQuery.ajax({url:s,type:"POST",dataType:"json",data:JSON.stringify(c),contentType:"application/json; charset=utf-8",beforeSend:d,success:(o=l(regeneratorRuntime.mark(function n(o){var u,s,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(f.debug("AnnotationSource#createAnnotation creation successful on the annotation server:",o),u=o,(s=h._toMiradorAnnotation(u)).layerId=r,s.endpoint=(0,a.getEndpoint)(),!e){n.next=8;break}return n.next=8,e.invalidateAllCanvases();case 8:(c=(0,i.default)().getAnnotationTocCache())&&c.invalidate(),t(s);case 11:case"end":return n.stop()}},n,h)})),function(t){return o.apply(this,arguments)}),error:function(t,e,r){var o="Failed to create annotation: "+e+" "+t.status+" "+r;f.error(o),n({code:t.status,message:o})}})}));case 10:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"updateAnnotation",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r,u,s,c=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.default)();case 2:return e=t.sent,r=this._toBackendAnnotation(n),u=this._prefix+"/annotations",s={layer_id:[n.layerId],annotation:r},f.debug("AnnotationSource#updateAnnotation payload:",s),t.abrupt("return",new Promise(function(t,r){var o;jQuery.ajax({url:u,type:"PUT",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),beforeSend:d,success:(o=l(regeneratorRuntime.mark(function r(o,u,s){var l,d;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(f.debug("AnnotationSource#updateAnnotation successful",o),(l=c._toMiradorAnnotation(o)).layerId=n.layerId,l.endpoint=(0,a.getEndpoint)(),!e){r.next=7;break}return r.next=7,e.invalidateAllCanvases();case 7:(d=(0,i.default)().getAnnotationTocCache())&&d.invalidate(),t(l);case 10:case"end":return r.stop()}},r,c)})),function(t,n,e){return o.apply(this,arguments)}),error:function(t,n,e){var o="Failed to update annotation: "+n+" "+t.status+" "+e;f.error(o),r({code:t.status,message:o})}})}));case 8:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"deleteAnnotation",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("AnnotationSource#deleteAnnotations annotationId:",n),t.next=3,(0,o.default)();case 3:return e=t.sent,r=this._prefix+"/"+n.replace(/^https?:\/\/.*?(\/.*)$/,"$1"),t.abrupt("return",new Promise(function(t,o){var u;jQuery.ajax({url:r,type:"DELETE",dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:d,success:(u=l(regeneratorRuntime.mark(function n(r,o,u){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(f.debug("AnnotationSource#deleteAnnotation success data:",r),!e){n.next=4;break}return n.next=4,e.invalidateAllCanvases();case 4:(s=(0,i.default)().getAnnotationTocCache())&&s.invalidate(),t();case 7:case"end":return n.stop()}},n,a)})),function(t,n,e){return u.apply(this,arguments)}),error:function(t,e,r){var i="AnnotationSource#deleteAnnotation failed for annotationId: "+n;f.error(i),o({code:t.status,message:i})}})}));case 6:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"updateAnnotationListOrder",value:function(){var t=l(regeneratorRuntime.mark(function t(n,e,r){var a,u,s,c=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,o.default)();case 2:return a=t.sent,u=this._prefix+"/resequenceList",s={canvas_id:n,layer_id:e,annotation_ids:r},t.abrupt("return",new Promise(function(t,n){var e;jQuery.ajax({url:u,type:"PUT",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),beforeSend:d,success:(e=l(regeneratorRuntime.mark(function n(e,r,o){var u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(f.debug("AnnotationSource#updateAnnotationListOrder successful",e),!a){n.next=4;break}return n.next=4,a.invalidateAllCanvases();case 4:(u=(0,i.default)().getAnnotationTocCache())&&u.invalidate(),t(e);case 7:case"end":return n.stop()}},n,c)})),function(t,n,r){return e.apply(this,arguments)}),error:function(t,e,r){var o="AnnotationSource#updateAnnotation failed: "+e+" "+t.status+" "+r;f.error(o),n({code:t.status,message:o})}})}));case 6:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"_toMiradorAnnotation",value:function(t){var n=jQuery.extend(!0,{},t),e=n.on;return e&&e.selector&&"oa:Choice"===e.selector["@type"]&&(e=[e]),n.on=e,n}},{key:"_toBackendAnnotation",value:function(t){delete t.endpoint,delete t.target,delete t.targetedBy;var n=jQuery.extend(!0,{},t),e=n.on;return e instanceof Array&&(1!==e.length&&f.error("AnnotationSource#__toBackendAnnotation unexpected target length",e.length),e=e[0]),n.target=e,n}}]),t}();n.default=h},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){console.error("ERROR:",t);var n=jQuery(r());if("FATAL"===t)throw t;for(var e=arguments.length,o=Array(e>1?e-1:0),i=1;i<e;i++)o[i-1]=arguments[i];o.push(t);var a=!0,u=!1,s=void 0;try{for(var c,l=o[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;n.append(jQuery("<p>"+f+"</p>"))}}catch(t){u=!0,s=t}finally{try{!a&&l.return&&l.return()}finally{if(u)throw s}}throw jQuery(document.body).empty().append(n),"FATAL"};var r=Handlebars.compile(['<div class="fatal_error">','  <div class="header">Error</div>',"</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=e(1),i=l(e(0)),a=l(e(3)),u=(l(e(10)),l(e(2))),s=l(e(16)),c=l(e(9));function l(t){return t&&t.__esModule?t:{default:t}}var f=(0,i.default)(),d=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),f.debug("AnnotationEditor#constructor options:",n),jQuery.extend(this,{windowId:null,miradorDriven:!1,annotation:null,id:null,parent:null,endpoint:null,targetAnnotation:null,saveCallback:null,cancelCallback:null},n),this._mode=n.mode,this._$anno=this.annotation?(0,o.Anno)(this.annotation):null,this._textDirectionClass=this._getTextDirectionClass(this._$anno),f.debug("AnnotationEditor#constructor _useVerticalRL:",this._useVerticalRL),this.init(),this.hide()}return r(t,[{key:"init",value:function(){this.miradorProxyManager=(0,a.default)(),this.endpoint=this.endpoint||this.miradorProxyManager.getWindowProxyById(this.windowId).getEndPoint(),this.id=this.id||Mirador.genUUID();var t=this.annotation?this._$anno.tags.join(" "):"";this.element=jQuery(h({miradorDriven:this.miradorDriven,tags:t})).attr("id",this.id),this.miradorDriven||this.reload(this.parent)}},{key:"reload",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n){var e,r,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("AnnotationEditor#reload parent:",n),n.prepend(this.element),e=this.element.find(".header"),r=e.find(".title"),this.textArea=this.element.find("textarea"),this.layerSelectorContainer=this.element.find(".layer_select"),this.layerSelector=new s.default({parent:this.layerSelectorContainer}),t.next=9,this.endpoint.getLayers();case 9:o=t.sent,this.layerSelector.init(o).then(function(){if("create"===i._mode){r.text("Create Annotation");var t=(0,u.default)().getString("lastSelectedLayer");i.layerSelector.val(t)}else r.text(""),i.annotation&&(i.textArea.val(i._$anno.bodyText),i.annotation.layerId&&i.layerSelector.val(i.annotation.layerId));i.initTinyMce(),i.bindEvents()}).catch(function(t){f.error("ERROR AnnotationEditor#reload layerSelector.init failed - "+t)});case 11:case"end":return t.stop()}},t,this)}),function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})});return function(t){return n.apply(this,arguments)}}()},{key:"initTinyMce",value:function(){var t=this;tinymce.init({selector:"#"+this.id+" textarea",plugins:"link paste image",menubar:!1,toolbar:"bold italic fontsizeselect | bullist numlist | link image | undo redo | removeformat | TB_RL",fontsize_formats:"10px 12px 14px 18px 24px",statusbar:!1,toolbar_items_size:"small",default_link_target:"_blank",past_as_text:!0,resize:!0,height:"140",theme_advanced_resizing:!0,theme_advanced_statusbar_location:"bottom",setup:function(n){n.on("init",function(t){this.getDoc().body.style.fontSize="12px",tinymce.execCommand("mceFocus",!1,t.target.id)}),n.on("focus",function(t){f.debug("TinyMCE on focus e:",t)}),n.addButton("TB_RL",{type:"listbox",tooltip:"Set text direction",icon:!1,onselect:function(n){t._textDirectionClass=this.value(),(0,u.default)().setString("textDirection",this.value())},values:[{text:"Horizontal LR",value:"horizontal-lr"},{text:"Horizontal RL",value:"horizontal-rl"},{text:"Vertical LR",value:"vertical-lr"},{text:"Vertical RL",value:"vertical-rl"}],value:t._textDirectionClass})}})}},{key:"show",value:function(t){f.debug("AnnotationEditor#show",t),t&&this.reload(jQuery(t)),this.element.show()}},{key:"hide",value:function(){this.element.hide()}},{key:"destroy",value:function(){this.element.remove()}},{key:"isDirty",value:function(){return this.getEditor().isDirty()}},{key:"getEditor",value:function(){return tinymce.get(this.textArea.attr("id"))}},{key:"getMode",value:function(){return this._mode}},{key:"getLoadedAnnotation",value:function(){return this._loadedAnnotation}},{key:"createAnnotation",value:function(t){var n=this.element.find(".tags-editor").val().trim(),e=this.getEditor().getContent(),r=[],o=[],i=[];n&&(r=n.split(/\s+/)),r&&r.length>0&&(o.push("oa:tagging"),jQuery.each(r,function(t,n){i.push({"@type":"oa:Tag",chars:n})})),o.push("oa:commenting"),i.push({"@type":"dctypes:Text",format:"text/html",chars:e,style:this._textDirectionClass});var a=this.layerSelector.val(),u={"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:o,resource:i,layerId:a};return t&&(u.on={"@type":"oa:Annotation",full:t["@id"]}),f.debug("AnnotationEditor#createAnnotation anno:",u),u}},{key:"loadAnnotation",value:function(t){this._mode="merge",this._loadedAnnotation=t;var n=(0,o.Anno)(t),e=n.bodyText;this.layerSelector.val(n.layerId),this.getEditor().setContent(e);var r=n.tags;r.length>0&&this.element.find(".tags-editor").val(r.join(" ")),this.getEditor().getBody().setAttribute("contenteditable",!1)}},{key:"updateAnnotation",value:function(t){f.debug("AnnotationEditor#updateAnnotation oaAnno:",t);var n=this.element.find(".tags-editor").val().trim(),e=this.getEditor().getContent(),r=[];n&&(r=n.split(/\s+/));t.motivation=jQuery.grep(t.motivation,function(t){return"oa:tagging"!==t}),t.resource=jQuery.grep(t.resource,function(t){return"oa:Tag"!==t["@type"]}),r.length>0&&(t.motivation.push("oa:tagging"),jQuery.each(r,function(n,e){t.resource.push({"@type":"oa:Tag",chars:e})}));var o=!0,i=!1,a=void 0;try{for(var u,s=t.resource[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;"dctypes:Text"===c["@type"]&&(c.chars=e,c.style=this._textDirectionClass)}}catch(t){i=!0,a=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}var l=this.layerSelector.val();return t.layerId=l,t}},{key:"save",value:function(){var t=this,n=null;"create"==this._mode?(n=this.createAnnotation(this.targetAnnotation),this.endpoint.create(n,function(n){var e=n;"function"==typeof t.saveCallback&&t.saveCallback(e),t.destroy()},function(){f.error("AnnotationEditor#save endpoint.create failed for",n)})):(n=this.updateAnnotation(this.annotation),console.log("TTT UUU anno:",n),this.endpoint.update(n,function(n){if("function"==typeof t.saveCallback){var e=n,r=t.getEditor().getContent().trim();t.saveCallback(e,r)}t.destroy()},function(){f.error("AnnotationEditor#save endpoint.update failed for",n)}))}},{key:"validate",value:function(){f.debug("AnnotationEditor#validate target anno:",this.targetAnnotation);var t="";return"create"===this._mode&&(this.targetAnnotation||(t+="Target annotation is missing.\n")),this.layerSelector.val()||(t+="Layer is not selected.\n"),""===this.getEditor().getContent().trim()&&(t+="Please enter content.\n"),""===t||(alert(t),!1)}},{key:"bindEvents",value:function(){var t=this,n=this.element.find(".tags-editor");n.click(function(t){t.stopPropagation()}),n.keydown(function(t){t.stopPropagation()}),this.element.find(".ym_save").click(function(n){n.preventDefault(),n.stopPropagation(),t.validate()&&t.save()}),this.element.find(".ym_cancel").click(function(n){n.preventDefault(),n.stopPropagation(),t.destroy(),"function"==typeof t.cancelCallback&&t.cancelCallback()}),this.element.find(".ym_vertical_inc").click(function(n){var e=t.getEditor().id+"_ifr",r=tinyMCE.DOM.get(e),o=parseInt(tinyMCE.DOM.getStyle(r,"height"),10);tinyMCE.DOM.setStyle(r,"height",o+75+"px")}),this.element.find(".ym_vertical_dec").click(function(n){var e=t.getEditor().id+"_ifr",r=tinyMCE.DOM.get(e),o=parseInt(tinyMCE.DOM.getStyle(r,"height"),10);tinyMCE.DOM.setStyle(r,"height",o-75+"px")})}},{key:"_getTextDirectionClass",value:function(t){var n="";return t&&(n=t.bodyStyle,f.debug("AnnotationEditor#_getTextDirectionClass class from anno:",n),c.default.directionClasses.includes(n))?n:(n=(0,u.default)().getString("textDirection"),f.debug("AnnotationEditor#_getTextDirectionClass default from state:",n),c.default.directionClasses.includes(n)?n:"horizontal-lr")}}]),t}();n.default=d;var h=Handlebars.compile(['<div class="ym_anno_editor">','  <div class="header">','    <span class="layer_select"></span>',"  </div>","  <textarea></textarea>",'  <input type="text" class="tags-editor" placeholder="{{t "addTagsHere"}}…" {{#if tags}}value="{{tags}}"{{/if}}/>',"  {{#unless miradorDriven}}",'    <div class="bottom_row">','        <button class="ym_save">Save</button>','        <button class="ym_cancel">Cancel</button>','      <div class="ym_float_right">','        <i class="large caret up icon ym_vertical_dec"></i>','        <i class="large caret down icon ym_vertical_inc"></i>',"      </div>","    </div>","  {{/unless}}","</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){return l?Promise.resolve(l):(l=new f).init()};e(1);var o=u(e(29)),i=u(e(30)),a=u(e(0));u(e(3));function u(t){return t&&t.__esModule?t:{default:t}}function s(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var c=(0,a.default)();var l=null,f=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._dbCache=new o.default,this._memCache=new i.default,this._valid=!1,this._inMemoryCache={}}return r(t,[{key:"init",value:function(){var t=s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._dbCache.isValid()){t.next=5;break}return t.next=3,this._dbCache.deleteDb();case 3:return t.next=5,this._dbCache.init();case 5:return t.abrupt("return",this);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getAnnotationsPerCanvas",value:function(){var t=s(regeneratorRuntime.mark(function t(n){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(c.debug("AnnotationCache#getAnnotationsPerCanvas",n),null===(e=this._memCache.getAnnotationsPerCanvas(n))){t.next=7;break}return c.debug("mem cache hit",n,e),t.abrupt("return",Promise.resolve(e));case 7:if(!this._dbCache.isValid()){t.next=15;break}return t.next=10,this._dbCache.getAnnotationsPerCanvas(n);case 10:return null!==(e=t.sent)&&(c.debug("db cache hit",n,e),this._memCache.setAnnotationsPerCanvas(n,e)),t.abrupt("return",Promise.resolve(e));case 15:return t.abrupt("return",Promise.resolve(null));case 16:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"setAnnotationsPerCanvas",value:function(t,n){return c.debug("AnnotationCache#setAnnotationsPerCanvas canvas:",t,"data:",n),this._memCache.setAnnotationsPerCanvas(t,n),this._dbCache.isValid()?this._dbCache.setAnnotationsPerCanvas(t,n):Promise.resolve()}},{key:"invalidateAllCanvases",value:function(){if(c.debug("AnnotationCache#invalidateAllCanvases"),this._memCache.invalidateAllCanvases(),this._dbCache.isValid())return this._dbCache.invalidateAllCanvases()}},{key:"invalidateCanvasId",value:function(t){if(c.debug("AnnotationCache#invalidateCanvasId canvasId:",t),this._memCache.invalidateCanvasId(t),this._dbCache.isValid())return this._dbCache.invalidateCanvasId(t)}}]),t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getEndpoint=n.YaleEndpoint=void 0;var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=(c(e(11)),c(e(4))),i=c(e(31)),a=c(e(0)),u=(c(e(3)),c(e(8))),s=(c(e(10)),c(e(5)));c(e(9));function c(t){return t&&t.__esModule?t:{default:t}}function l(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var f=(0,a.default)(),d=[];var h=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.dfd=n.dfd,this._explorer=n.explorer||(0,o.default)().getAnnotationExplorer(),this._error=n.errorDialog||(0,i.default)(),this.annotationsList=[],d.push(this)}return r(t,[{key:"search",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("YaleEndpoint#search options:",n),e=!1,r=n.uri,t.next=5,this._explorer.getAnnotations({canvasId:r}).catch(function(t){f.error("YaleEndpoint#search",t),e=!0,i.annotationsList=[],403===t.code?i._error.show(t.code,"Failed to retrieve annotations: user doesn't have permission to read"):i._error.show(t.code,"Failed to retrieve annotations",!0)});case 5:if(o=t.sent,f.debug("YaleEndpoint#search got annotations:",this.annotationsList),!e){t.next=10;break}return this.dfd.reject(),t.abrupt("return");case 10:try{this.annotationsList=o,this.dfd.resolve(!0)}catch(t){f.error("YaleEndpoint#search dfd.resolve failed - ",t)}(0,u.default)().hide();case 12:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"create",value:function(){var t=l(regeneratorRuntime.mark(function t(n,e,r){var o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this,o=!1,!this.userAuthorize("create",n)){t.next=12;break}return t.next=5,this._create(n).catch(function(t){o=!0,403===t.code?a._error.show(t.code,"Failed to create annotation: user doesn't have permission to create"):a._error.show(t.code,"Failed to create annotation",!0)});case 5:if(i=t.sent,!o){t.next=9;break}return"function"==typeof r&&r(),t.abrupt("return");case 9:if("function"==typeof e)try{e(i)}catch(t){f.error("ERROR YaleEndpoint#create successCallback failed:",t),"function"==typeof r&&r()}t.next=14;break;case 12:this._error.show(-1,"Not authorized to create"),"function"==typeof r&&r();case 14:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"_create",value:function(){var t=l(regeneratorRuntime.mark(function t(n){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("YaleEndpoint#_create oaAnnotation:",n),e=this,r=this._explorer.createAnnotation(n).catch(function(t){throw f.error("YaleEndpoint#_create createAnnotation failed",t),t}),e.annotationsList.push(r),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"update",value:function(){var t=l(regeneratorRuntime.mark(function t(n,e,r){var o,i,a,u,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this,i=n["@id"],a=!1,!this.userAuthorize("update",n)){t.next=15;break}return t.next=6,this._explorer.updateAnnotation(n).catch(function(t){a=!0,403===t.code?s._error.show(t.code,"Failed to update annotation: user doesn't have permission to update"):s._error.show(t.code,"Failed to update annotation",!0)});case 6:if(u=t.sent,this._attachEndpoint(),!a){t.next=11;break}return"function"==typeof r&&r(),t.abrupt("return");case 11:o.annotationsList.forEach(function(t,e){t["@id"]===i&&(o.annotationsList[e]=n)}),"function"==typeof e&&e(u),t.next=17;break;case 15:this._error.show(-1,"Not authorized to update"),"function"==typeof r&&r();case 17:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"deleteAnnotation",value:function(){var t=l(regeneratorRuntime.mark(function t(n,e,r){var o,i,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f.debug("YaleEndpoint#deleteAnnotation annotationId: "+n),o=this,i=!1,!this.userAuthorize("delete",null)){t.next=13;break}return t.next=6,this._explorer.deleteAnnotation(n).catch(function(t){i=!0,403===t.code?a._error.show(t.code,"Failed to delete annotation: user doesn't have permission to delete"):a._error.show(t.code,"Failed to delete annotation",!0)});case 6:if(!i){t.next=9;break}return"function"==typeof r&&r(),t.abrupt("return");case 9:this.annotationsList=o.annotationsList.filter(function(t){return t["@id"]!==n}),"function"==typeof e&&e(),t.next=16;break;case 13:f.info("YaleEndpoint#delete user not authorized"),this._error.show(-1,"Not authorized to delete"),"function"==typeof r&&r();case 16:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"getLayers",value:function(){var t=l(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("YaleEndpoint#getLayers"),t.abrupt("return",this._explorer.getLayers());case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"updateOrder",value:function(){var t=l(regeneratorRuntime.mark(function t(n,e,r,o,i){var a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f.debug("YaleEndpoint#updateOrder canvasId:",n,"layerId:",e,"annoIds:",r),this,!this.userAuthorize("update",null)){t.next=11;break}return t.next=5,this._explorer.updateAnnotationListOrder(n,e,r).catch(function(t){error=!0,403===t.code?a._error.show(t.code,"Failed to delete annotation: user doesn't have permission to delete"):a._error.show(t.code,"Failed to delete annotation",!0)});case 5:if(!error){t.next=8;break}return"function"==typeof i&&i(),t.abrupt("return");case 8:"function"==typeof o&&o(),t.next=14;break;case 11:f.info("YaleEndpoint#updateOrder user not authorized"),this._error.show(-1,"Not authorized to update"),"function"==typeof i&&i();case 14:case"end":return t.stop()}},t,this)}));return function(n,e,r,o,i){return t.apply(this,arguments)}}()},{key:"userAuthorize",value:function(t,n){return"create"!==t&&"update"!==t&&"delete"!==t||s.default.isEditor()}},{key:"set",value:function(t,n,e){f.debug("YaleEndpoint#set prop:",t,", value:",n,", options:",e),e?this[e.parent][t]=n:this[t]=n}},{key:"_attachEndpoint",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this.annotationsList[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.endpoint=this}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}}}]),t}();n.YaleEndpoint=h,n.getEndpoint=function(){return f.debug("getEndpoint _instances:",d.length,d),d[0]}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=s(e(0)),i=s(e(2)),a=s(e(17)),u=s(e(5));function s(t){return t&&t.__esModule?t:{default:t}}var c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),jQuery.extend(this,{selector:null,parent:null,changeCallback:null,initialLayerId:null},n),this.logger=(0,o.default)(),this.appState=(0,i.default)()}return r(t,[{key:"init",value:function(t){this.logger.debug("LayerSelector#init layers:",t,"initialLayerId:",this.initialLayerId);var n=u.default.isEditor(),e=this.appState.getSetting("ui","annotationWindow","hiddenLayers")||[];return!n&&e.length>0&&(t=t.filter(function(t){return!e.includes(t["@id"])})),this._isLoaded=!1,this.selector=new a.default({appendTo:this.parent}),this.bindEvents(),this.reload(t)}},{key:"reload",value:function(t){this.logger.debug("LayerSelector#reload");var n=this,e=this.appState.getTransient("layerIndexMap");e||this.logger.error("LayerSelector#reload cannot retrieve layerIndexMap"),this.selector.empty();var r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value,c=s["@id"],l=e?e[c]:0,f="number"==typeof l?"layer_"+l%10:void 0;n.selector.addItem({label:s.label,value:c,colorClass:f})}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return new Promise(function(r,o){if(t.length>0){var i=n.initialLayerId||t[0]["@id"],a=e?e[i]:0;n.selector.val(i,!0),n.selector.setColorClass("layer_"+a%10),n._isLoaded=!0}r(n)})}},{key:"val",value:function(t,n){this.logger.debug("LayerSelector#val",t,n);var e=this.selector.val(t,n);return void 0!==t&&(this.logger.debug("val:",t),(0,i.default)().setString("lastSelectedLayer",t)),e}},{key:"isLoaded",value:function(){return this._isLoaded}},{key:"bindEvents",value:function(){var t=this;this.selector.changeCallback=function(n,e){t.logger.debug("LayerSelector#bindEvents changeCallback");var r=t.appState.getTransient("layerIndexMap"),o=r?r[n]:0;t.selector.setColorClass("layer_"+o%10),(0,i.default)().setString("lastSelectedLayer",n),"function"==typeof t.changeCallback&&t.changeCallback(n,e)}}}]),t}();n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);var a=(0,((r=i)&&r.__esModule?r:{default:r}).default)(),u=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),jQuery.extend(this,{appendTo:null,changeCallback:null},n),this.init()}return o(t,[{key:"init",value:function(){var t=this;this.element=jQuery(s()),this.appendTo.append(this.element),this.element.dropdown({direction:"downward",onChange:function(n,e){a.debug("Selector#init onChange ",n,e,t._skipNotify),"function"!=typeof t.changeCallback||t._skipNotify||t.changeCallback(n,e),t._skipNotify=!1},action:function(n,e){t.element.dropdown("set selected",e),t.element.dropdown("hide")}}),this.values=[]}},{key:"setItems",value:function(t){a.debug("Selector#setItems itemsConfig:",t);var n=this.element.find(".menu");n.empty(),this._setItems(t,n)}},{key:"_setItems",value:function(t,n){var e=this;jQuery.each(t,function(t,r){if(r.children.length>0){e.addItem({label:r.label,value:r.value,parent:n});var o=e.addMenuItem(r.label,r.value,n);e._setItems(r.children,o)}else e.addItem({label:r.label,value:r.value,parent:n})})}},{key:"addMenuItem",value:function(t,n,e){var r=jQuery("<div/>").addClass("item").attr("data-text",t).attr("data-value",n).text(t),o=jQuery("<div/>").addClass("menu").css("overflow","hidden");return r.append(jQuery('<i class="dropdown icon"></i>')),r.append(o),e.append(r),o}},{key:"addItem",value:function(t){var n=jQuery(c({label:t.label,colorClass:t.colorClass})).attr("data-text",t.label).attr("data-value",t.value);(t.parent||this.element.find(".menu")).append(n),this.values.push(t.value)}},{key:"empty",value:function(){this.element.find(".menu").empty()}},{key:"val",value:function(t,n){a.debug("Selector#val",t,n);var e=this.element;return this._skipNotify=n||!1,e.dropdown("refresh"),void 0===t?e.dropdown("get value"):e.dropdown("get item",t)?(e.dropdown("set selected",t),t):(e.dropdown("set selected",this.values[0]),this.values[0])}},{key:"setColorClass",value:function(t){this._oldClass&&this.element.removeClass(this._oldClass),this.element.addClass(t),this._oldClass=t}},{key:"destroy",value:function(){this.element.remove()}}]),t}();n.default=u;var s=Handlebars.compile(['<div class="basic tiny ui button ym_button dropdown">','  <input name="selection" type="hidden" />','  <div class="default text"></div>','  <i class="ym dropdown icon"></i>','  <div class="menu">',"  </div>","</div>"].join("")),c=Handlebars.compile(['<div class="item">',"  {{#if colorClass}}",'    <span class="icon_span"><i class="circle icon {{colorClass}}"></i></span>',"  {{/if}}",'  <span class="label">{{label}}</span>',"</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(1);var a={debug:function(){return null},info:function(){return null},warning:function(){return null},error:function(){return null}},u=function(){function t(n,e,r){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({logger:null},r||{}),this.options.logger&&(a=this.options.logger),this.spec=n,this.annotations=e,this._annoMap={};var o=!0,i=!1,u=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;this._annoMap[l["@id"]]=l}}catch(t){i=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw u}}this._root=null,this._unassigned=[],this.annoToNodeMap={},this.init()}return o(t,[{key:"init",value:function(t){a.debug("AnnotationToc#init spec: ",this.spec),this._root=this._newNode(null,null),this.parse(this.annotations)}},{key:"getNode",value:function(){var t=Array.from(arguments),n=this._root,e=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=i.value;if(!n)break;n=n.childNodes[u]}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}return n===this._root?null:n}},{key:"findNodeForAnnotation",value:function(t){return this.getNode.apply(this,t.tocTags)}},{key:"getNodeFromTags",value:function(t){return this.getNode.apply(this,t)}},{key:"getTagsFromAnnotationId",value:function(t){var n=[];return this.walk(function(e){var r=!0,o=!1,i=void 0;try{for(var a,u=e.annotations[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){if(a.value["@id"]===t)return n=e.tags,!0}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}),n}},{key:"matchHierarchy",value:function(t,n){var e=this.getNodeFromTags(n);return!!e&&this.matchNode(t,e)}},{key:"matchNode",value:function(t,n){var e=n.canvasAnnotations.filter(function(n){return n["@id"]===t["@id"]});if(e.length>0)return!0;if((e=n.annotations.filter(function(n){return n["@id"]===t["@id"]})).length>0)return!0;var r=!0,o=!1,i=void 0;try{for(var a,u=Object.values(n.childNodes)[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;if(this.matchNode(t,s))return!0}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return!1}},{key:"unassigned",value:function(){return this._unassigned}},{key:"numUnassigned",value:function(){return this._unassigned.length}},{key:"walk",value:function(t){this._visit(this._root,t,0)}},{key:"_visit",value:function(t,n,e){var r=Object.values(t.childNodes).sort(function(t,n){return t.weight-n.weight}),o=!0,i=!1,a=void 0;try{for(var u,s=r[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;n(c,e)||this._visit(c,n,e+1)}}catch(t){i=!0,a=t}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}},{key:"parse",value:function(){this._buildTocTree(this.annotations),this._setNodeOrders(this._root)}},{key:"_setNodeOrders",value:function(t){if(0!==t.childNodes.length)for(var n=/\d+$/,e=Object.keys(t.childNodes).sort(function(t,e){return Number(t.substring(t.match(n).index))-Number(e.substring(e.match(n).index))}),r=0;r<e.length;++r){var o=e[r],i=t.childNodes[o];i.weight=r,this._setNodeOrders(i)}}},{key:"_buildTocTree",value:function(t){var n=!0,e=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value,s=(0,i.Anno)(u).tags;this._buildChildNodes(u,s,0,this._root)||this._unassigned.push(u)}}catch(t){e=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(e)throw r}}}},{key:"_buildChildNodes",value:function(t,n,e,o){var a=null;if(e>=this.spec.generator.length)return!o.isRoot&&(t.tocTags=o.tags,i.annoUtil.hasTargetOnCanvas(t)&&o.canvasAnnotations.push(t),o.annotations.push(t),this.annoToNodeMap[t["@id"]]=o,!0);var u=this._getTagForLevel(n,e),s=r(u,2),c=s[0],l=s[1];return c?(o.childNodes[c]||(o.childNodes[c]=this._newNode(c,o,l)),a=o.childNodes[c],o.isRoot?a.label=this._extractTagNumber(c):a.label=o.label+"."+this._extractTagNumber(c),this._buildChildNodes(t,n,e+1,a)):!o.isRoot&&(t.tocTags=o.tags,i.annoUtil.hasTargetOnCanvas(t)&&o.canvasAnnotations.push(t),o.annotations.push(t),this.annoToNodeMap[t["@id"]]=o,!0)}},{key:"_getTagForLevel",value:function(t,n){var e=this.spec.generator[n].tag.prefix,r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value,c=s.match("^"+e+"(\\d+)$");if(c)return[s,"0"===c[1]]}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return[null,null]}},{key:"_extractTagNumber",value:function(t){return t.match(/\d+$/)[0]}},{key:"_newNode",value:function(t,n,e){return n?{annotations:[],canvasAnnotations:[],tags:n.isRoot?[t]:n.tags.concat([t]),label:"",childNodes:{},weight:0,isDummy:e}:{isRoot:!0,childNodes:{}}}},{key:"print",value:function(){var t=function(t){for(var n="",e=0;e<t;++e)n+="  ";return n},n=function(t,n,e){return t.length>n&&(t=e?"... "+t.substring(t.length-n+4):t.substring(0,n-4)+" ..."),t},e="";this.walk(function(r,o){e+=t(o)+"- [n] ",e+=String(r.tags),e+="\n";var a=!0,u=!1,s=void 0;try{for(var c,l=r.annotations[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;e+=t(o+1)+"- [a] ";var d=(0,i.Anno)(f).bodyText||"";e+=n(d,60)+"\n";var h=f.layerId||"";e+=t(o+1)+"      "+n(h,60,!0)+"\n"}}catch(t){u=!0,s=t}finally{try{!a&&l.return&&l.return()}finally{if(u)throw s}}}),console.log("TOC:\n"+e)}}]),t}();n.default=u},function(t,n,e){e(20),e(4),t.exports=e(55)},function(t,n,e){(function(t){var n;!function t(e,r,o){function i(u,s){if(!r[u]){if(!e[u]){if(!s&&("function"==typeof n&&n))return n(u,!0);if(a)return a(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[u]={exports:{}};e[u][0].call(l.exports,function(t){var n=e[u][1][t];return i(n||t)},l,l.exports,t,e,r,o)}return r[u].exports}for(var a="function"==typeof n&&n,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(n,e,r){(function(t){"use strict";if(n(327),n(328),n(2),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";function r(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}r(String.prototype,"padLeft","".padStart),r(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&r(Array,t,Function.call.bind([][t]))})}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2,327:327,328:328}],2:[function(t,n,e){t(130),n.exports=t(23).RegExp.escape},{130:130,23:23}],3:[function(t,n,e){n.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],4:[function(t,n,e){var r=t(18);n.exports=function(t,n){if("number"!=typeof t&&"Number"!=r(t))throw TypeError(n);return+t}},{18:18}],5:[function(t,n,e){var r=t(128)("unscopables"),o=Array.prototype;null==o[r]&&t(42)(o,r,{}),n.exports=function(t){o[r][t]=!0}},{128:128,42:42}],6:[function(t,n,e){n.exports=function(t,n,e,r){if(!(t instanceof n)||void 0!==r&&r in t)throw TypeError(e+": incorrect invocation!");return t}},{}],7:[function(t,n,e){var r=t(51);n.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},{51:51}],8:[function(t,n,e){"use strict";var r=t(119),o=t(114),i=t(118);n.exports=[].copyWithin||function(t,n){var e=r(this),a=i(e.length),u=o(t,a),s=o(n,a),c=arguments.length>2?arguments[2]:void 0,l=Math.min((void 0===c?a:o(c,a))-s,a-u),f=1;for(s<u&&u<s+l&&(f=-1,s+=l-1,u+=l-1);l-- >0;)s in e?e[u]=e[s]:delete e[u],u+=f,s+=f;return e}},{114:114,118:118,119:119}],9:[function(t,n,e){"use strict";var r=t(119),o=t(114),i=t(118);n.exports=function(t){for(var n=r(this),e=i(n.length),a=arguments.length,u=o(a>1?arguments[1]:void 0,e),s=a>2?arguments[2]:void 0,c=void 0===s?e:o(s,e);c>u;)n[u++]=t;return n}},{114:114,118:118,119:119}],10:[function(t,n,e){var r=t(39);n.exports=function(t,n){var e=[];return r(t,!1,e.push,e,n),e}},{39:39}],11:[function(t,n,e){var r=t(117),o=t(118),i=t(114);n.exports=function(t){return function(n,e,a){var u,s=r(n),c=o(s.length),l=i(a,c);if(t&&e!=e){for(;c>l;)if((u=s[l++])!=u)return!0}else for(;c>l;l++)if((t||l in s)&&s[l]===e)return t||l||0;return!t&&-1}}},{114:114,117:117,118:118}],12:[function(t,n,e){var r=t(25),o=t(47),i=t(119),a=t(118),u=t(15);n.exports=function(t,n){var e=1==t,s=2==t,c=3==t,l=4==t,f=6==t,d=5==t||f,h=n||u;return function(n,u,v){for(var g,p,y=i(n),m=o(y),_=r(u,v,3),b=a(m.length),w=0,x=e?h(n,b):s?h(n,0):void 0;b>w;w++)if((d||w in m)&&(p=_(g=m[w],w,y),t))if(e)x[w]=p;else if(p)switch(t){case 3:return!0;case 5:return g;case 6:return w;case 2:x.push(g)}else if(l)return!1;return f?-1:c||l?l:x}}},{118:118,119:119,15:15,25:25,47:47}],13:[function(t,n,e){var r=t(3),o=t(119),i=t(47),a=t(118);n.exports=function(t,n,e,u,s){r(n);var c=o(t),l=i(c),f=a(c.length),d=s?f-1:0,h=s?-1:1;if(e<2)for(;;){if(d in l){u=l[d],d+=h;break}if(d+=h,s?d<0:f<=d)throw TypeError("Reduce of empty array with no initial value")}for(;s?d>=0:f>d;d+=h)d in l&&(u=n(u,l[d],d,c));return u}},{118:118,119:119,3:3,47:47}],14:[function(t,n,e){var r=t(51),o=t(49),i=t(128)("species");n.exports=function(t){var n;return o(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!o(n.prototype)||(n=void 0),r(n)&&null===(n=n[i])&&(n=void 0)),void 0===n?Array:n}},{128:128,49:49,51:51}],15:[function(t,n,e){var r=t(14);n.exports=function(t,n){return new(r(t))(n)}},{14:14}],16:[function(t,n,e){"use strict";var r=t(3),o=t(51),i=t(46),a=[].slice,u={};n.exports=Function.bind||function(t){var n=r(this),e=a.call(arguments,1),s=function(){var r=e.concat(a.call(arguments));return this instanceof s?function(t,n,e){if(!(n in u)){for(var r=[],o=0;o<n;o++)r[o]="a["+o+"]";u[n]=Function("F,a","return new F("+r.join(",")+")")}return u[n](t,e)}(n,r.length,r):i(n,r,t)};return o(n.prototype)&&(s.prototype=n.prototype),s}},{3:3,46:46,51:51}],17:[function(t,n,e){var r=t(18),o=t(128)("toStringTag"),i="Arguments"==r(function(){return arguments}());n.exports=function(t){var n,e,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),o))?e:i?r(n):"Object"==(a=r(n))&&"function"==typeof n.callee?"Arguments":a}},{128:128,18:18}],18:[function(t,n,e){var r={}.toString;n.exports=function(t){return r.call(t).slice(8,-1)}},{}],19:[function(t,n,e){"use strict";var r=t(72).f,o=t(71),i=t(93),a=t(25),u=t(6),s=t(39),c=t(55),l=t(57),f=t(100),d=t(29),h=t(66).fastKey,v=t(125),g=d?"_s":"size",p=function(t,n){var e,r=h(n);if("F"!==r)return t._i[r];for(e=t._f;e;e=e.n)if(e.k==n)return e};n.exports={getConstructor:function(t,n,e,c){var l=t(function(t,r){u(t,l,n,"_i"),t._t=n,t._i=o(null),t._f=void 0,t._l=void 0,t[g]=0,null!=r&&s(r,e,t[c],t)});return i(l.prototype,{clear:function(){for(var t=v(this,n),e=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete e[r.i];t._f=t._l=void 0,t[g]=0},delete:function(t){var e=v(this,n),r=p(e,t);if(r){var o=r.n,i=r.p;delete e._i[r.i],r.r=!0,i&&(i.n=o),o&&(o.p=i),e._f==r&&(e._f=o),e._l==r&&(e._l=i),e[g]--}return!!r},forEach:function(t){v(this,n);for(var e,r=a(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(r(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!p(v(this,n),t)}}),d&&r(l.prototype,"size",{get:function(){return v(this,n)[g]}}),l},def:function(t,n,e){var r,o,i=p(t,n);return i?i.v=e:(t._l=i={i:o=h(n,!0),k:n,v:e,p:r=t._l,n:void 0,r:!1},t._f||(t._f=i),r&&(r.n=i),t[g]++,"F"!==o&&(t._i[o]=i)),t},getEntry:p,setStrong:function(t,n,e){c(t,n,function(t,e){this._t=v(t,n),this._k=e,this._l=void 0},function(){for(var t=this._k,n=this._l;n&&n.r;)n=n.p;return this._t&&(this._l=n=n?n.n:this._t._f)?l(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(this._t=void 0,l(1))},e?"entries":"values",!e,!0),f(n)}}},{100:100,125:125,25:25,29:29,39:39,55:55,57:57,6:6,66:66,71:71,72:72,93:93}],20:[function(t,n,e){var r=t(17),o=t(10);n.exports=function(t){return function(){if(r(this)!=t)throw TypeError(t+"#toJSON isn't generic");return o(this)}}},{10:10,17:17}],21:[function(t,n,e){"use strict";var r=t(93),o=t(66).getWeak,i=t(7),a=t(51),u=t(6),s=t(39),c=t(12),l=t(41),f=t(125),d=c(5),h=c(6),v=0,g=function(t){return t._l||(t._l=new p)},p=function(){this.a=[]},y=function(t,n){return d(t.a,function(t){return t[0]===n})};p.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var e=y(this,t);e?e[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},n.exports={getConstructor:function(t,n,e,i){var c=t(function(t,r){u(t,c,n,"_i"),t._t=n,t._i=v++,t._l=void 0,null!=r&&s(r,e,t[i],t)});return r(c.prototype,{delete:function(t){if(!a(t))return!1;var e=o(t);return!0===e?g(f(this,n)).delete(t):e&&l(e,this._i)&&delete e[this._i]},has:function(t){if(!a(t))return!1;var e=o(t);return!0===e?g(f(this,n)).has(t):e&&l(e,this._i)}}),c},def:function(t,n,e){var r=o(i(n),!0);return!0===r?g(t).set(n,e):r[t._i]=e,t},ufstore:g}},{12:12,125:125,39:39,41:41,51:51,6:6,66:66,7:7,93:93}],22:[function(t,n,e){"use strict";var r=t(40),o=t(33),i=t(94),a=t(93),u=t(66),s=t(39),c=t(6),l=t(51),f=t(35),d=t(56),h=t(101),v=t(45);n.exports=function(t,n,e,g,p,y){var m=r[t],_=m,b=p?"set":"add",w=_&&_.prototype,x={},A=function(t){var n=w[t];i(w,t,"delete"==t?function(t){return!(y&&!l(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(y&&!l(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return y&&!l(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,e){return n.call(this,0===t?0:t,e),this})};if("function"==typeof _&&(y||w.forEach&&!f(function(){(new _).entries().next()}))){var k=new _,S=k[b](y?{}:-0,1)!=k,T=f(function(){k.has(1)}),P=d(function(t){new _(t)}),I=!y&&f(function(){for(var t=new _,n=5;n--;)t[b](n,n);return!t.has(-0)});P||((_=n(function(n,e){c(n,_,t);var r=v(new m,n,_);return null!=e&&s(e,p,r[b],r),r})).prototype=w,w.constructor=_),(T||I)&&(A("delete"),A("has"),p&&A("get")),(I||S)&&A(b),y&&w.clear&&delete w.clear}else _=g.getConstructor(n,t,p,b),a(_.prototype,e),u.NEED=!0;return h(_,t),x[t]=_,o(o.G+o.W+o.F*(_!=m),x),y||g.setStrong(_,t,p),_}},{101:101,33:33,35:35,39:39,40:40,45:45,51:51,56:56,6:6,66:66,93:93,94:94}],23:[function(t,n,e){var r=n.exports={version:"2.5.0"};"number"==typeof __e&&(__e=r)},{}],24:[function(t,n,e){"use strict";var r=t(72),o=t(92);n.exports=function(t,n,e){n in t?r.f(t,n,o(0,e)):t[n]=e}},{72:72,92:92}],25:[function(t,n,e){var r=t(3);n.exports=function(t,n,e){if(r(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}}},{3:3}],26:[function(t,n,e){"use strict";var r=t(35),o=Date.prototype.getTime,i=Date.prototype.toISOString,a=function(t){return t>9?t:"0"+t};n.exports=r(function(){return"0385-07-25T07:06:39.999Z"!=i.call(new Date(-5e13-1))})||!r(function(){i.call(new Date(NaN))})?function(){if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),e=t.getUTCMilliseconds(),r=n<0?"-":n>9999?"+":"";return r+("00000"+Math.abs(n)).slice(r?-6:-4)+"-"+a(t.getUTCMonth()+1)+"-"+a(t.getUTCDate())+"T"+a(t.getUTCHours())+":"+a(t.getUTCMinutes())+":"+a(t.getUTCSeconds())+"."+(e>99?e:"0"+a(e))+"Z"}:i},{35:35}],27:[function(t,n,e){"use strict";var r=t(7),o=t(120);n.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return o(r(this),"number"!=t)}},{120:120,7:7}],28:[function(t,n,e){n.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},{}],29:[function(t,n,e){n.exports=!t(35)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{35:35}],30:[function(t,n,e){var r=t(51),o=t(40).document,i=r(o)&&r(o.createElement);n.exports=function(t){return i?o.createElement(t):{}}},{40:40,51:51}],31:[function(t,n,e){n.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],32:[function(t,n,e){var r=t(81),o=t(78),i=t(82);n.exports=function(t){var n=r(t),e=o.f;if(e)for(var a,u=e(t),s=i.f,c=0;u.length>c;)s.call(t,a=u[c++])&&n.push(a);return n}},{78:78,81:81,82:82}],33:[function(t,n,e){var r=t(40),o=t(23),i=t(42),a=t(94),u=t(25),s=function(t,n,e){var c,l,f,d,h=t&s.F,v=t&s.G,g=t&s.S,p=t&s.P,y=t&s.B,m=v?r:g?r[n]||(r[n]={}):(r[n]||{}).prototype,_=v?o:o[n]||(o[n]={}),b=_.prototype||(_.prototype={});for(c in v&&(e=n),e)f=((l=!h&&m&&void 0!==m[c])?m:e)[c],d=y&&l?u(f,r):p&&"function"==typeof f?u(Function.call,f):f,m&&a(m,c,f,t&s.U),_[c]!=f&&i(_,c,d),p&&b[c]!=f&&(b[c]=f)};r.core=o,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,n.exports=s},{23:23,25:25,40:40,42:42,94:94}],34:[function(t,n,e){var r=t(128)("match");n.exports=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[r]=!1,!"/./"[t](n)}catch(t){}}return!0}},{128:128}],35:[function(t,n,e){n.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],36:[function(t,n,e){"use strict";var r=t(42),o=t(94),i=t(35),a=t(28),u=t(128);n.exports=function(t,n,e){var s=u(t),c=e(a,s,""[t]),l=c[0],f=c[1];i(function(){var n={};return n[s]=function(){return 7},7!=""[t](n)})&&(o(String.prototype,t,l),r(RegExp.prototype,s,2==n?function(t,n){return f.call(t,this,n)}:function(t){return f.call(t,this)}))}},{128:128,28:28,35:35,42:42,94:94}],37:[function(t,n,e){"use strict";var r=t(7);n.exports=function(){var t=r(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},{7:7}],38:[function(t,n,e){"use strict";var r=t(49),o=t(51),i=t(118),a=t(25),u=t(128)("isConcatSpreadable");n.exports=function t(n,e,s,c,l,f,d,h){for(var v,g,p=l,y=0,m=!!d&&a(d,h,3);y<c;){if(y in s){if(v=m?m(s[y],y,e):s[y],g=!1,o(v)&&(g=void 0!==(g=v[u])?!!g:r(v)),g&&f>0)p=t(n,e,v,i(v.length),p,f-1)-1;else{if(p>=9007199254740991)throw TypeError();n[p]=v}p++}y++}return p}},{118:118,128:128,25:25,49:49,51:51}],39:[function(t,n,e){var r=t(25),o=t(53),i=t(48),a=t(7),u=t(118),s=t(129),c={},l={};(e=n.exports=function(t,n,e,f,d){var h,v,g,p,y=d?function(){return t}:s(t),m=r(e,f,n?2:1),_=0;if("function"!=typeof y)throw TypeError(t+" is not iterable!");if(i(y)){for(h=u(t.length);h>_;_++)if((p=n?m(a(v=t[_])[0],v[1]):m(t[_]))===c||p===l)return p}else for(g=y.call(t);!(v=g.next()).done;)if((p=o(g,m,v.value,n))===c||p===l)return p}).BREAK=c,e.RETURN=l},{118:118,129:129,25:25,48:48,53:53,7:7}],40:[function(t,n,e){var r=n.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],41:[function(t,n,e){var r={}.hasOwnProperty;n.exports=function(t,n){return r.call(t,n)}},{}],42:[function(t,n,e){var r=t(72),o=t(92);n.exports=t(29)?function(t,n,e){return r.f(t,n,o(1,e))}:function(t,n,e){return t[n]=e,t}},{29:29,72:72,92:92}],43:[function(t,n,e){var r=t(40).document;n.exports=r&&r.documentElement},{40:40}],44:[function(t,n,e){n.exports=!t(29)&&!t(35)(function(){return 7!=Object.defineProperty(t(30)("div"),"a",{get:function(){return 7}}).a})},{29:29,30:30,35:35}],45:[function(t,n,e){var r=t(51),o=t(99).set;n.exports=function(t,n,e){var i,a=n.constructor;return a!==e&&"function"==typeof a&&(i=a.prototype)!==e.prototype&&r(i)&&o&&o(t,i),t}},{51:51,99:99}],46:[function(t,n,e){n.exports=function(t,n,e){var r=void 0===e;switch(n.length){case 0:return r?t():t.call(e);case 1:return r?t(n[0]):t.call(e,n[0]);case 2:return r?t(n[0],n[1]):t.call(e,n[0],n[1]);case 3:return r?t(n[0],n[1],n[2]):t.call(e,n[0],n[1],n[2]);case 4:return r?t(n[0],n[1],n[2],n[3]):t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)}},{}],47:[function(t,n,e){var r=t(18);n.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},{18:18}],48:[function(t,n,e){var r=t(58),o=t(128)("iterator"),i=Array.prototype;n.exports=function(t){return void 0!==t&&(r.Array===t||i[o]===t)}},{128:128,58:58}],49:[function(t,n,e){var r=t(18);n.exports=Array.isArray||function(t){return"Array"==r(t)}},{18:18}],50:[function(t,n,e){var r=t(51),o=Math.floor;n.exports=function(t){return!r(t)&&isFinite(t)&&o(t)===t}},{51:51}],51:[function(t,n,e){n.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],52:[function(t,n,e){var r=t(51),o=t(18),i=t(128)("match");n.exports=function(t){var n;return r(t)&&(void 0!==(n=t[i])?!!n:"RegExp"==o(t))}},{128:128,18:18,51:51}],53:[function(t,n,e){var r=t(7);n.exports=function(t,n,e,o){try{return o?n(r(e)[0],e[1]):n(e)}catch(n){var i=t.return;throw void 0!==i&&r(i.call(t)),n}}},{7:7}],54:[function(t,n,e){"use strict";var r=t(71),o=t(92),i=t(101),a={};t(42)(a,t(128)("iterator"),function(){return this}),n.exports=function(t,n,e){t.prototype=r(a,{next:o(1,e)}),i(t,n+" Iterator")}},{101:101,128:128,42:42,71:71,92:92}],55:[function(t,n,e){"use strict";var r=t(60),o=t(33),i=t(94),a=t(42),u=t(41),s=t(58),c=t(54),l=t(101),f=t(79),d=t(128)("iterator"),h=!([].keys&&"next"in[].keys()),v=function(){return this};n.exports=function(t,n,e,g,p,y,m){c(e,n,g);var _,b,w,x=function(t){if(!h&&t in T)return T[t];switch(t){case"keys":case"values":return function(){return new e(this,t)}}return function(){return new e(this,t)}},A=n+" Iterator",k="values"==p,S=!1,T=t.prototype,P=T[d]||T["@@iterator"]||p&&T[p],I=P||x(p),C=p?k?x("entries"):I:void 0,E="Array"==n&&T.entries||P;if(E&&(w=f(E.call(new t)))!==Object.prototype&&w.next&&(l(w,A,!0),r||u(w,d)||a(w,d,v)),k&&P&&"values"!==P.name&&(S=!0,I=function(){return P.call(this)}),r&&!m||!h&&!S&&T[d]||a(T,d,I),s[n]=I,s[A]=v,p)if(_={values:k?I:x("values"),keys:y?I:x("keys"),entries:C},m)for(b in _)b in T||i(T,b,_[b]);else o(o.P+o.F*(h||S),n,_);return _}},{101:101,128:128,33:33,41:41,42:42,54:54,58:58,60:60,79:79,94:94}],56:[function(t,n,e){var r=t(128)("iterator"),o=!1;try{var i=[7][r]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(t){}n.exports=function(t,n){if(!n&&!o)return!1;var e=!1;try{var i=[7],a=i[r]();a.next=function(){return{done:e=!0}},i[r]=function(){return a},t(i)}catch(t){}return e}},{128:128}],57:[function(t,n,e){n.exports=function(t,n){return{value:n,done:!!t}}},{}],58:[function(t,n,e){n.exports={}},{}],59:[function(t,n,e){var r=t(81),o=t(117);n.exports=function(t,n){for(var e,i=o(t),a=r(i),u=a.length,s=0;u>s;)if(i[e=a[s++]]===n)return e}},{117:117,81:81}],60:[function(t,n,e){n.exports=!1},{}],61:[function(t,n,e){var r=Math.expm1;n.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},{}],62:[function(t,n,e){var r=t(65),o=Math.pow,i=o(2,-52),a=o(2,-23),u=o(2,127)*(2-a),s=o(2,-126);n.exports=Math.fround||function(t){var n,e,o=Math.abs(t),c=r(t);return o<s?c*(o/s/a+1/i-1/i)*s*a:(e=(n=(1+a/i)*o)-(n-o))>u||e!=e?c*(1/0):c*e}},{65:65}],63:[function(t,n,e){n.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},{}],64:[function(t,n,e){n.exports=Math.scale||function(t,n,e,r,o){return 0===arguments.length||t!=t||n!=n||e!=e||r!=r||o!=o?NaN:t===1/0||t===-1/0?t:(t-n)*(o-r)/(e-n)+r}},{}],65:[function(t,n,e){n.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},{}],66:[function(t,n,e){var r=t(124)("meta"),o=t(51),i=t(41),a=t(72).f,u=0,s=Object.isExtensible||function(){return!0},c=!t(35)(function(){return s(Object.preventExtensions({}))}),l=function(t){a(t,r,{value:{i:"O"+ ++u,w:{}}})},f=n.exports={KEY:r,NEED:!1,fastKey:function(t,n){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,r)){if(!s(t))return"F";if(!n)return"E";l(t)}return t[r].i},getWeak:function(t,n){if(!i(t,r)){if(!s(t))return!0;if(!n)return!1;l(t)}return t[r].w},onFreeze:function(t){return c&&f.NEED&&s(t)&&!i(t,r)&&l(t),t}}},{124:124,35:35,41:41,51:51,72:72}],67:[function(t,n,e){var r=t(160),o=t(33),i=t(103)("metadata"),a=i.store||(i.store=new(t(266))),u=function(t,n,e){var o=a.get(t);if(!o){if(!e)return;a.set(t,o=new r)}var i=o.get(n);if(!i){if(!e)return;o.set(n,i=new r)}return i};n.exports={store:a,map:u,has:function(t,n,e){var r=u(n,e,!1);return void 0!==r&&r.has(t)},get:function(t,n,e){var r=u(n,e,!1);return void 0===r?void 0:r.get(t)},set:function(t,n,e,r){u(e,r,!0).set(t,n)},keys:function(t,n){var e=u(t,n,!1),r=[];return e&&e.forEach(function(t,n){r.push(n)}),r},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){o(o.S,"Reflect",t)}}},{103:103,160:160,266:266,33:33}],68:[function(t,n,e){var r=t(40),o=t(113).set,i=r.MutationObserver||r.WebKitMutationObserver,a=r.process,u=r.Promise,s="process"==t(18)(a);n.exports=function(){var t,n,e,c=function(){var r,o;for(s&&(r=a.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?e():n=void 0,r}}n=void 0,r&&r.enter()};if(s)e=function(){a.nextTick(c)};else if(i){var l=!0,f=document.createTextNode("");new i(c).observe(f,{characterData:!0}),e=function(){f.data=l=!l}}else if(u&&u.resolve){var d=u.resolve();e=function(){d.then(c)}}else e=function(){o.call(r,c)};return function(r){var o={fn:r,next:void 0};n&&(n.next=o),t||(t=o,e()),n=o}}},{113:113,18:18,40:40}],69:[function(t,n,e){"use strict";var r=t(3);function o(t){var n,e;this.promise=new t(function(t,r){if(void 0!==n||void 0!==e)throw TypeError("Bad Promise constructor");n=t,e=r}),this.resolve=r(n),this.reject=r(e)}n.exports.f=function(t){return new o(t)}},{3:3}],70:[function(t,n,e){"use strict";var r=t(81),o=t(78),i=t(82),a=t(119),u=t(47),s=Object.assign;n.exports=!s||t(35)(function(){var t={},n={},e=Symbol(),r="abcdefghijklmnopqrst";return t[e]=7,r.split("").forEach(function(t){n[t]=t}),7!=s({},t)[e]||Object.keys(s({},n)).join("")!=r})?function(t,n){for(var e=a(t),s=arguments.length,c=1,l=o.f,f=i.f;s>c;)for(var d,h=u(arguments[c++]),v=l?r(h).concat(l(h)):r(h),g=v.length,p=0;g>p;)f.call(h,d=v[p++])&&(e[d]=h[d]);return e}:s},{119:119,35:35,47:47,78:78,81:81,82:82}],71:[function(t,n,e){var r=t(7),o=t(73),i=t(31),a=t(102)("IE_PROTO"),u=function(){},s=function(){var n,e=t(30)("iframe"),r=i.length;for(e.style.display="none",t(43).appendChild(e),e.src="javascript:",(n=e.contentWindow.document).open(),n.write("<script>document.F=Object<\/script>"),n.close(),s=n.F;r--;)delete s.prototype[i[r]];return s()};n.exports=Object.create||function(t,n){var e;return null!==t?(u.prototype=r(t),e=new u,u.prototype=null,e[a]=t):e=s(),void 0===n?e:o(e,n)}},{102:102,30:30,31:31,43:43,7:7,73:73}],72:[function(t,n,e){var r=t(7),o=t(44),i=t(120),a=Object.defineProperty;e.f=t(29)?Object.defineProperty:function(t,n,e){if(r(t),n=i(n,!0),r(e),o)try{return a(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},{120:120,29:29,44:44,7:7}],73:[function(t,n,e){var r=t(72),o=t(7),i=t(81);n.exports=t(29)?Object.defineProperties:function(t,n){o(t);for(var e,a=i(n),u=a.length,s=0;u>s;)r.f(t,e=a[s++],n[e]);return t}},{29:29,7:7,72:72,81:81}],74:[function(t,n,e){"use strict";n.exports=t(60)||!t(35)(function(){var n=Math.random();__defineSetter__.call(null,n,function(){}),delete t(40)[n]})},{35:35,40:40,60:60}],75:[function(t,n,e){var r=t(82),o=t(92),i=t(117),a=t(120),u=t(41),s=t(44),c=Object.getOwnPropertyDescriptor;e.f=t(29)?c:function(t,n){if(t=i(t),n=a(n,!0),s)try{return c(t,n)}catch(t){}if(u(t,n))return o(!r.f.call(t,n),t[n])}},{117:117,120:120,29:29,41:41,44:44,82:82,92:92}],76:[function(t,n,e){var r=t(117),o=t(77).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(t){return a&&"[object Window]"==i.call(t)?function(t){try{return o(t)}catch(t){return a.slice()}}(t):o(r(t))}},{117:117,77:77}],77:[function(t,n,e){var r=t(80),o=t(31).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},{31:31,80:80}],78:[function(t,n,e){e.f=Object.getOwnPropertySymbols},{}],79:[function(t,n,e){var r=t(41),o=t(119),i=t(102)("IE_PROTO"),a=Object.prototype;n.exports=Object.getPrototypeOf||function(t){return t=o(t),r(t,i)?t[i]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},{102:102,119:119,41:41}],80:[function(t,n,e){var r=t(41),o=t(117),i=t(11)(!1),a=t(102)("IE_PROTO");n.exports=function(t,n){var e,u=o(t),s=0,c=[];for(e in u)e!=a&&r(u,e)&&c.push(e);for(;n.length>s;)r(u,e=n[s++])&&(~i(c,e)||c.push(e));return c}},{102:102,11:11,117:117,41:41}],81:[function(t,n,e){var r=t(80),o=t(31);n.exports=Object.keys||function(t){return r(t,o)}},{31:31,80:80}],82:[function(t,n,e){e.f={}.propertyIsEnumerable},{}],83:[function(t,n,e){var r=t(33),o=t(23),i=t(35);n.exports=function(t,n){var e=(o.Object||{})[t]||Object[t],a={};a[t]=n(e),r(r.S+r.F*i(function(){e(1)}),"Object",a)}},{23:23,33:33,35:35}],84:[function(t,n,e){var r=t(81),o=t(117),i=t(82).f;n.exports=function(t){return function(n){for(var e,a=o(n),u=r(a),s=u.length,c=0,l=[];s>c;)i.call(a,e=u[c++])&&l.push(t?[e,a[e]]:a[e]);return l}}},{117:117,81:81,82:82}],85:[function(t,n,e){var r=t(77),o=t(78),i=t(7),a=t(40).Reflect;n.exports=a&&a.ownKeys||function(t){var n=r.f(i(t)),e=o.f;return e?n.concat(e(t)):n}},{40:40,7:7,77:77,78:78}],86:[function(t,n,e){var r=t(40).parseFloat,o=t(111).trim;n.exports=1/r(t(112)+"-0")!=-1/0?function(t){var n=o(String(t),3),e=r(n);return 0===e&&"-"==n.charAt(0)?-0:e}:r},{111:111,112:112,40:40}],87:[function(t,n,e){var r=t(40).parseInt,o=t(111).trim,i=t(112),a=/^[-+]?0[xX]/;n.exports=8!==r(i+"08")||22!==r(i+"0x16")?function(t,n){var e=o(String(t),3);return r(e,n>>>0||(a.test(e)?16:10))}:r},{111:111,112:112,40:40}],88:[function(t,n,e){"use strict";var r=t(89),o=t(46),i=t(3);n.exports=function(){for(var t=i(this),n=arguments.length,e=Array(n),a=0,u=r._,s=!1;n>a;)(e[a]=arguments[a++])===u&&(s=!0);return function(){var r,i=arguments.length,a=0,c=0;if(!s&&!i)return o(t,e,this);if(r=e.slice(),s)for(;n>a;a++)r[a]===u&&(r[a]=arguments[c++]);for(;i>c;)r.push(arguments[c++]);return o(t,r,this)}}},{3:3,46:46,89:89}],89:[function(t,n,e){n.exports=t(40)},{40:40}],90:[function(t,n,e){n.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},{}],91:[function(t,n,e){var r=t(69);n.exports=function(t,n){var e=r.f(t);return(0,e.resolve)(n),e.promise}},{69:69}],92:[function(t,n,e){n.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},{}],93:[function(t,n,e){var r=t(94);n.exports=function(t,n,e){for(var o in n)r(t,o,n[o],e);return t}},{94:94}],94:[function(t,n,e){var r=t(40),o=t(42),i=t(41),a=t(124)("src"),u=Function.toString,s=(""+u).split("toString");t(23).inspectSource=function(t){return u.call(t)},(n.exports=function(t,n,e,u){var c="function"==typeof e;c&&(i(e,"name")||o(e,"name",n)),t[n]!==e&&(c&&(i(e,a)||o(e,a,t[n]?""+t[n]:s.join(String(n)))),t===r?t[n]=e:u?t[n]?t[n]=e:o(t,n,e):(delete t[n],o(t,n,e)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[a]||u.call(this)})},{124:124,23:23,40:40,41:41,42:42}],95:[function(t,n,e){n.exports=function(t,n){var e=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,e)}}},{}],96:[function(t,n,e){n.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},{}],97:[function(t,n,e){"use strict";var r=t(33),o=t(3),i=t(25),a=t(39);n.exports=function(t){r(r.S,t,{from:function(t){var n,e,r,u,s=arguments[1];return o(this),(n=void 0!==s)&&o(s),null==t?new this:(e=[],n?(r=0,u=i(s,arguments[2],2),a(t,!1,function(t){e.push(u(t,r++))})):a(t,!1,e.push,e),new this(e))}})}},{25:25,3:3,33:33,39:39}],98:[function(t,n,e){"use strict";var r=t(33);n.exports=function(t){r(r.S,t,{of:function(){for(var t=arguments.length,n=Array(t);t--;)n[t]=arguments[t];return new this(n)}})}},{33:33}],99:[function(t,n,e){var r=t(51),o=t(7),i=function(t,n){if(o(t),!r(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};n.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(n,e,r){try{(r=t(25)(Function.call,t(75).f(Object.prototype,"__proto__").set,2))(n,[]),e=!(n instanceof Array)}catch(t){e=!0}return function(t,n){return i(t,n),e?t.__proto__=n:r(t,n),t}}({},!1):void 0),check:i}},{25:25,51:51,7:7,75:75}],100:[function(t,n,e){"use strict";var r=t(40),o=t(72),i=t(29),a=t(128)("species");n.exports=function(t){var n=r[t];i&&n&&!n[a]&&o.f(n,a,{configurable:!0,get:function(){return this}})}},{128:128,29:29,40:40,72:72}],101:[function(t,n,e){var r=t(72).f,o=t(41),i=t(128)("toStringTag");n.exports=function(t,n,e){t&&!o(t=e?t:t.prototype,i)&&r(t,i,{configurable:!0,value:n})}},{128:128,41:41,72:72}],102:[function(t,n,e){var r=t(103)("keys"),o=t(124);n.exports=function(t){return r[t]||(r[t]=o(t))}},{103:103,124:124}],103:[function(t,n,e){var r=t(40),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});n.exports=function(t){return o[t]||(o[t]={})}},{40:40}],104:[function(t,n,e){var r=t(7),o=t(3),i=t(128)("species");n.exports=function(t,n){var e,a=r(t).constructor;return void 0===a||null==(e=r(a)[i])?n:o(e)}},{128:128,3:3,7:7}],105:[function(t,n,e){"use strict";var r=t(35);n.exports=function(t,n){return!!t&&r(function(){n?t.call(null,function(){},1):t.call(null)})}},{35:35}],106:[function(t,n,e){var r=t(116),o=t(28);n.exports=function(t){return function(n,e){var i,a,u=String(o(n)),s=r(e),c=u.length;return s<0||s>=c?t?"":void 0:(i=u.charCodeAt(s))<55296||i>56319||s+1===c||(a=u.charCodeAt(s+1))<56320||a>57343?t?u.charAt(s):i:t?u.slice(s,s+2):a-56320+(i-55296<<10)+65536}}},{116:116,28:28}],107:[function(t,n,e){var r=t(52),o=t(28);n.exports=function(t,n,e){if(r(n))throw TypeError("String#"+e+" doesn't accept regex!");return String(o(t))}},{28:28,52:52}],108:[function(t,n,e){var r=t(33),o=t(35),i=t(28),a=/"/g,u=function(t,n,e,r){var o=String(i(t)),u="<"+n;return""!==e&&(u+=" "+e+'="'+String(r).replace(a,"&quot;")+'"'),u+">"+o+"</"+n+">"};n.exports=function(t,n){var e={};e[t]=n(u),r(r.P+r.F*o(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",e)}},{28:28,33:33,35:35}],109:[function(t,n,e){var r=t(118),o=t(110),i=t(28);n.exports=function(t,n,e,a){var u=String(i(t)),s=u.length,c=void 0===e?" ":String(e),l=r(n);if(l<=s||""==c)return u;var f=l-s,d=o.call(c,Math.ceil(f/c.length));return d.length>f&&(d=d.slice(0,f)),a?d+u:u+d}},{110:110,118:118,28:28}],110:[function(t,n,e){"use strict";var r=t(116),o=t(28);n.exports=function(t){var n=String(o(this)),e="",i=r(t);if(i<0||i==1/0)throw RangeError("Count can't be negative");for(;i>0;(i>>>=1)&&(n+=n))1&i&&(e+=n);return e}},{116:116,28:28}],111:[function(t,n,e){var r=t(33),o=t(28),i=t(35),a=t(112),u="["+a+"]",s=RegExp("^"+u+u+"*"),c=RegExp(u+u+"*$"),l=function(t,n,e){var o={},u=i(function(){return!!a[t]()||"​"!="​"[t]()}),s=o[t]=u?n(f):a[t];e&&(o[e]=s),r(r.P+r.F*u,"String",o)},f=l.trim=function(t,n){return t=String(o(t)),1&n&&(t=t.replace(s,"")),2&n&&(t=t.replace(c,"")),t};n.exports=l},{112:112,28:28,33:33,35:35}],112:[function(t,n,e){n.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},{}],113:[function(t,n,e){var r,o,i,a=t(25),u=t(46),s=t(43),c=t(30),l=t(40),f=l.process,d=l.setImmediate,h=l.clearImmediate,v=l.MessageChannel,g=l.Dispatch,p=0,y={},m=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},_=function(t){m.call(t.data)};d&&h||(d=function(t){for(var n=[],e=1;arguments.length>e;)n.push(arguments[e++]);return y[++p]=function(){u("function"==typeof t?t:Function(t),n)},r(p),p},h=function(t){delete y[t]},"process"==t(18)(f)?r=function(t){f.nextTick(a(m,t,1))}:g&&g.now?r=function(t){g.now(a(m,t,1))}:v?(i=(o=new v).port2,o.port1.onmessage=_,r=a(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(t){l.postMessage(t+"","*")},l.addEventListener("message",_,!1)):r="onreadystatechange"in c("script")?function(t){s.appendChild(c("script")).onreadystatechange=function(){s.removeChild(this),m.call(t)}}:function(t){setTimeout(a(m,t,1),0)}),n.exports={set:d,clear:h}},{18:18,25:25,30:30,40:40,43:43,46:46}],114:[function(t,n,e){var r=t(116),o=Math.max,i=Math.min;n.exports=function(t,n){return(t=r(t))<0?o(t+n,0):i(t,n)}},{116:116}],115:[function(t,n,e){var r=t(116),o=t(118);n.exports=function(t){if(void 0===t)return 0;var n=r(t),e=o(n);if(n!==e)throw RangeError("Wrong length!");return e}},{116:116,118:118}],116:[function(t,n,e){var r=Math.ceil,o=Math.floor;n.exports=function(t){return isNaN(t=+t)?0:(t>0?o:r)(t)}},{}],117:[function(t,n,e){var r=t(47),o=t(28);n.exports=function(t){return r(o(t))}},{28:28,47:47}],118:[function(t,n,e){var r=t(116),o=Math.min;n.exports=function(t){return t>0?o(r(t),9007199254740991):0}},{116:116}],119:[function(t,n,e){var r=t(28);n.exports=function(t){return Object(r(t))}},{28:28}],120:[function(t,n,e){var r=t(51);n.exports=function(t,n){if(!r(t))return t;var e,o;if(n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;if("function"==typeof(e=t.valueOf)&&!r(o=e.call(t)))return o;if(!n&&"function"==typeof(e=t.toString)&&!r(o=e.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},{51:51}],121:[function(t,n,e){"use strict";if(t(29)){var r=t(60),o=t(40),i=t(35),a=t(33),u=t(123),s=t(122),c=t(25),l=t(6),f=t(92),d=t(42),h=t(93),v=t(116),g=t(118),p=t(115),y=t(114),m=t(120),_=t(41),b=t(17),w=t(51),x=t(119),A=t(48),k=t(71),S=t(79),T=t(77).f,P=t(129),I=t(124),C=t(128),E=t(12),O=t(11),M=t(104),j=t(141),N=t(58),L=t(56),W=t(100),R=t(9),D=t(8),F=t(72),B=t(75),U=F.f,H=B.f,Q=o.RangeError,z=o.TypeError,G=o.Uint8Array,V=Array.prototype,Y=s.ArrayBuffer,q=s.DataView,K=E(0),J=E(2),$=E(3),X=E(4),Z=E(5),tt=E(6),nt=O(!0),et=O(!1),rt=j.values,ot=j.keys,it=j.entries,at=V.lastIndexOf,ut=V.reduce,st=V.reduceRight,ct=V.join,lt=V.sort,ft=V.slice,dt=V.toString,ht=V.toLocaleString,vt=C("iterator"),gt=C("toStringTag"),pt=I("typed_constructor"),yt=I("def_constructor"),mt=u.CONSTR,_t=u.TYPED,bt=u.VIEW,wt=E(1,function(t,n){return Tt(M(t,t[yt]),n)}),xt=i(function(){return 1===new G(new Uint16Array([1]).buffer)[0]}),At=!!G&&!!G.prototype.set&&i(function(){new G(1).set({})}),kt=function(t,n){var e=v(t);if(e<0||e%n)throw Q("Wrong offset!");return e},St=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&pt in t))throw z("It is not a typed array constructor!");return new t(n)},Pt=function(t,n){return It(M(t,t[yt]),n)},It=function(t,n){for(var e=0,r=n.length,o=Tt(t,r);r>e;)o[e]=n[e++];return o},Ct=function(t,n,e){U(t,n,{get:function(){return this._d[e]}})},Et=function(t){var n,e,r,o,i,a,u=x(t),s=arguments.length,l=s>1?arguments[1]:void 0,f=void 0!==l,d=P(u);if(null!=d&&!A(d)){for(a=d.call(u),r=[],n=0;!(i=a.next()).done;n++)r.push(i.value);u=r}for(f&&s>2&&(l=c(l,arguments[2],2)),n=0,e=g(u.length),o=Tt(this,e);e>n;n++)o[n]=f?l(u[n],n):u[n];return o},Ot=function(){for(var t=0,n=arguments.length,e=Tt(this,n);n>t;)e[t]=arguments[t++];return e},Mt=!!G&&i(function(){ht.call(new G(1))}),jt=function(){return ht.apply(Mt?ft.call(St(this)):St(this),arguments)},Nt={copyWithin:function(t,n){return D.call(St(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return X(St(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return R.apply(St(this),arguments)},filter:function(t){return Pt(this,J(St(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return Z(St(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return tt(St(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){K(St(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return et(St(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return nt(St(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ct.apply(St(this),arguments)},lastIndexOf:function(t){return at.apply(St(this),arguments)},map:function(t){return wt(St(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return ut.apply(St(this),arguments)},reduceRight:function(t){return st.apply(St(this),arguments)},reverse:function(){for(var t,n=St(this).length,e=Math.floor(n/2),r=0;r<e;)t=this[r],this[r++]=this[--n],this[n]=t;return this},some:function(t){return $(St(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return lt.call(St(this),t)},subarray:function(t,n){var e=St(this),r=e.length,o=y(t,r);return new(M(e,e[yt]))(e.buffer,e.byteOffset+o*e.BYTES_PER_ELEMENT,g((void 0===n?r:y(n,r))-o))}},Lt=function(t,n){return Pt(this,ft.call(St(this),t,n))},Wt=function(t){St(this);var n=kt(arguments[1],1),e=this.length,r=x(t),o=g(r.length),i=0;if(o+n>e)throw Q("Wrong length!");for(;i<o;)this[n+i]=r[i++]},Rt={entries:function(){return it.call(St(this))},keys:function(){return ot.call(St(this))},values:function(){return rt.call(St(this))}},Dt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},Ft=function(t,n){return Dt(t,n=m(n,!0))?f(2,t[n]):H(t,n)},Bt=function(t,n,e){return!(Dt(t,n=m(n,!0))&&w(e)&&_(e,"value"))||_(e,"get")||_(e,"set")||e.configurable||_(e,"writable")&&!e.writable||_(e,"enumerable")&&!e.enumerable?U(t,n,e):(t[n]=e.value,t)};mt||(B.f=Ft,F.f=Bt),a(a.S+a.F*!mt,"Object",{getOwnPropertyDescriptor:Ft,defineProperty:Bt}),i(function(){dt.call({})})&&(dt=ht=function(){return ct.call(this)});var Ut=h({},Nt);h(Ut,Rt),d(Ut,vt,Rt.values),h(Ut,{slice:Lt,set:Wt,constructor:function(){},toString:dt,toLocaleString:jt}),Ct(Ut,"buffer","b"),Ct(Ut,"byteOffset","o"),Ct(Ut,"byteLength","l"),Ct(Ut,"length","e"),U(Ut,gt,{get:function(){return this[_t]}}),n.exports=function(t,n,e,s){var c=t+((s=!!s)?"Clamped":"")+"Array",f="get"+t,h="set"+t,v=o[c],y=v||{},m=v&&S(v),_=!v||!u.ABV,x={},A=v&&v.prototype,P=function(t,e){U(t,e,{get:function(){return function(t,e){var r=t._d;return r.v[f](e*n+r.o,xt)}(this,e)},set:function(t){return function(t,e,r){var o=t._d;s&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),o.v[h](e*n+o.o,r,xt)}(this,e,t)},enumerable:!0})};_?(v=e(function(t,e,r,o){l(t,v,c,"_d");var i,a,u,s,f=0,h=0;if(w(e)){if(!(e instanceof Y||"ArrayBuffer"==(s=b(e))||"SharedArrayBuffer"==s))return _t in e?It(v,e):Et.call(v,e);i=e,h=kt(r,n);var y=e.byteLength;if(void 0===o){if(y%n)throw Q("Wrong length!");if((a=y-h)<0)throw Q("Wrong length!")}else if((a=g(o)*n)+h>y)throw Q("Wrong length!");u=a/n}else u=p(e),i=new Y(a=u*n);for(d(t,"_d",{b:i,o:h,l:a,e:u,v:new q(i)});f<u;)P(t,f++)}),A=v.prototype=k(Ut),d(A,"constructor",v)):i(function(){v(1)})&&i(function(){new v(-1)})&&L(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=e(function(t,e,r,o){var i;return l(t,v,c),w(e)?e instanceof Y||"ArrayBuffer"==(i=b(e))||"SharedArrayBuffer"==i?void 0!==o?new y(e,kt(r,n),o):void 0!==r?new y(e,kt(r,n)):new y(e):_t in e?It(v,e):Et.call(v,e):new y(p(e))}),K(m!==Function.prototype?T(y).concat(T(m)):T(y),function(t){t in v||d(v,t,y[t])}),v.prototype=A,r||(A.constructor=v));var I=A[vt],C=!!I&&("values"==I.name||null==I.name),E=Rt.values;d(v,pt,!0),d(A,_t,c),d(A,bt,!0),d(A,yt,v),(s?new v(1)[gt]==c:gt in A)||U(A,gt,{get:function(){return c}}),x[c]=v,a(a.G+a.W+a.F*(v!=y),x),a(a.S,c,{BYTES_PER_ELEMENT:n}),a(a.S+a.F*i(function(){y.of.call(v,1)}),c,{from:Et,of:Ot}),"BYTES_PER_ELEMENT"in A||d(A,"BYTES_PER_ELEMENT",n),a(a.P,c,Nt),W(c),a(a.P+a.F*At,c,{set:Wt}),a(a.P+a.F*!C,c,Rt),r||A.toString==dt||(A.toString=dt),a(a.P+a.F*i(function(){new v(1).slice()}),c,{slice:Lt}),a(a.P+a.F*(i(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!i(function(){A.toLocaleString.call([1,2])})),c,{toLocaleString:jt}),N[c]=C?I:E,r||C||d(A,vt,E)}}else n.exports=function(){}},{100:100,104:104,11:11,114:114,115:115,116:116,118:118,119:119,12:12,120:120,122:122,123:123,124:124,128:128,129:129,141:141,17:17,25:25,29:29,33:33,35:35,40:40,41:41,42:42,48:48,51:51,56:56,58:58,6:6,60:60,71:71,72:72,75:75,77:77,79:79,8:8,9:9,92:92,93:93}],122:[function(t,n,e){"use strict";var r=t(40),o=t(29),i=t(60),a=t(123),u=t(42),s=t(93),c=t(35),l=t(6),f=t(116),d=t(118),h=t(115),v=t(77).f,g=t(72).f,p=t(9),y=t(101),m="prototype",_="Wrong index!",b=r.ArrayBuffer,w=r.DataView,x=r.Math,A=r.RangeError,k=r.Infinity,S=b,T=x.abs,P=x.pow,I=x.floor,C=x.log,E=x.LN2,O=o?"_b":"buffer",M=o?"_l":"byteLength",j=o?"_o":"byteOffset";function N(t,n,e){var r,o,i,a=Array(e),u=8*e-n-1,s=(1<<u)-1,c=s>>1,l=23===n?P(2,-24)-P(2,-77):0,f=0,d=t<0||0===t&&1/t<0?1:0;for((t=T(t))!=t||t===k?(o=t!=t?1:0,r=s):(r=I(C(t)/E),t*(i=P(2,-r))<1&&(r--,i*=2),(t+=r+c>=1?l/i:l*P(2,1-c))*i>=2&&(r++,i/=2),r+c>=s?(o=0,r=s):r+c>=1?(o=(t*i-1)*P(2,n),r+=c):(o=t*P(2,c-1)*P(2,n),r=0));n>=8;a[f++]=255&o,o/=256,n-=8);for(r=r<<n|o,u+=n;u>0;a[f++]=255&r,r/=256,u-=8);return a[--f]|=128*d,a}function L(t,n,e){var r,o=8*e-n-1,i=(1<<o)-1,a=i>>1,u=o-7,s=e-1,c=t[s--],l=127&c;for(c>>=7;u>0;l=256*l+t[s],s--,u-=8);for(r=l&(1<<-u)-1,l>>=-u,u+=n;u>0;r=256*r+t[s],s--,u-=8);if(0===l)l=1-a;else{if(l===i)return r?NaN:c?-k:k;r+=P(2,n),l-=a}return(c?-1:1)*r*P(2,l-n)}function W(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function R(t){return[255&t]}function D(t){return[255&t,t>>8&255]}function F(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function B(t){return N(t,52,8)}function U(t){return N(t,23,4)}function H(t,n,e){g(t[m],n,{get:function(){return this[e]}})}function Q(t,n,e,r){var o=h(+e);if(o+n>t[M])throw A(_);var i=t[O]._b,a=o+t[j],u=i.slice(a,a+n);return r?u:u.reverse()}function z(t,n,e,r,o,i){var a=h(+e);if(a+n>t[M])throw A(_);for(var u=t[O]._b,s=a+t[j],c=r(+o),l=0;l<n;l++)u[s+l]=c[i?l:n-l-1]}if(a.ABV){if(!c(function(){b(1)})||!c(function(){new b(-1)})||c(function(){return new b,new b(1.5),new b(NaN),"ArrayBuffer"!=b.name})){for(var G,V=(b=function(t){return l(this,b),new S(h(t))})[m]=S[m],Y=v(S),q=0;Y.length>q;)(G=Y[q++])in b||u(b,G,S[G]);i||(V.constructor=b)}var K=new w(new b(2)),J=w[m].setInt8;K.setInt8(0,2147483648),K.setInt8(1,2147483649),!K.getInt8(0)&&K.getInt8(1)||s(w[m],{setInt8:function(t,n){J.call(this,t,n<<24>>24)},setUint8:function(t,n){J.call(this,t,n<<24>>24)}},!0)}else b=function(t){l(this,b,"ArrayBuffer");var n=h(t);this._b=p.call(Array(n),0),this[M]=n},w=function(t,n,e){l(this,w,"DataView"),l(t,b,"DataView");var r=t[M],o=f(n);if(o<0||o>r)throw A("Wrong offset!");if(o+(e=void 0===e?r-o:d(e))>r)throw A("Wrong length!");this[O]=t,this[j]=o,this[M]=e},o&&(H(b,"byteLength","_l"),H(w,"buffer","_b"),H(w,"byteLength","_l"),H(w,"byteOffset","_o")),s(w[m],{getInt8:function(t){return Q(this,1,t)[0]<<24>>24},getUint8:function(t){return Q(this,1,t)[0]},getInt16:function(t){var n=Q(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Q(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return W(Q(this,4,t,arguments[1]))},getUint32:function(t){return W(Q(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return L(Q(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return L(Q(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){z(this,1,t,R,n)},setUint8:function(t,n){z(this,1,t,R,n)},setInt16:function(t,n){z(this,2,t,D,n,arguments[2])},setUint16:function(t,n){z(this,2,t,D,n,arguments[2])},setInt32:function(t,n){z(this,4,t,F,n,arguments[2])},setUint32:function(t,n){z(this,4,t,F,n,arguments[2])},setFloat32:function(t,n){z(this,4,t,U,n,arguments[2])},setFloat64:function(t,n){z(this,8,t,B,n,arguments[2])}});y(b,"ArrayBuffer"),y(w,"DataView"),u(w[m],a.VIEW,!0),e.ArrayBuffer=b,e.DataView=w},{101:101,115:115,116:116,118:118,123:123,29:29,35:35,40:40,42:42,6:6,60:60,72:72,77:77,9:9,93:93}],123:[function(t,n,e){for(var r,o=t(40),i=t(42),a=t(124),u=a("typed_array"),s=a("view"),c=!(!o.ArrayBuffer||!o.DataView),l=c,f=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<9;)(r=o[d[f++]])?(i(r.prototype,u,!0),i(r.prototype,s,!0)):l=!1;n.exports={ABV:c,CONSTR:l,TYPED:u,VIEW:s}},{124:124,40:40,42:42}],124:[function(t,n,e){var r=0,o=Math.random();n.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+o).toString(36))}},{}],125:[function(t,n,e){var r=t(51);n.exports=function(t,n){if(!r(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},{51:51}],126:[function(t,n,e){var r=t(40),o=t(23),i=t(60),a=t(127),u=t(72).f;n.exports=function(t){var n=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==t.charAt(0)||t in n||u(n,t,{value:a.f(t)})}},{127:127,23:23,40:40,60:60,72:72}],127:[function(t,n,e){e.f=t(128)},{128:128}],128:[function(t,n,e){var r=t(103)("wks"),o=t(124),i=t(40).Symbol,a="function"==typeof i;(n.exports=function(t){return r[t]||(r[t]=a&&i[t]||(a?i:o)("Symbol."+t))}).store=r},{103:103,124:124,40:40}],129:[function(t,n,e){var r=t(17),o=t(128)("iterator"),i=t(58);n.exports=t(23).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||i[r(t)]}},{128:128,17:17,23:23,58:58}],130:[function(t,n,e){var r=t(33),o=t(95)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(t){return o(t)}})},{33:33,95:95}],131:[function(t,n,e){var r=t(33);r(r.P,"Array",{copyWithin:t(8)}),t(5)("copyWithin")},{33:33,5:5,8:8}],132:[function(t,n,e){"use strict";var r=t(33),o=t(12)(4);r(r.P+r.F*!t(105)([].every,!0),"Array",{every:function(t){return o(this,t,arguments[1])}})},{105:105,12:12,33:33}],133:[function(t,n,e){var r=t(33);r(r.P,"Array",{fill:t(9)}),t(5)("fill")},{33:33,5:5,9:9}],134:[function(t,n,e){"use strict";var r=t(33),o=t(12)(2);r(r.P+r.F*!t(105)([].filter,!0),"Array",{filter:function(t){return o(this,t,arguments[1])}})},{105:105,12:12,33:33}],135:[function(t,n,e){"use strict";var r=t(33),o=t(12)(6),i="findIndex",a=!0;i in[]&&Array(1)[i](function(){a=!1}),r(r.P+r.F*a,"Array",{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(5)(i)},{12:12,33:33,5:5}],136:[function(t,n,e){"use strict";var r=t(33),o=t(12)(5),i=!0;"find"in[]&&Array(1).find(function(){i=!1}),r(r.P+r.F*i,"Array",{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(5)("find")},{12:12,33:33,5:5}],137:[function(t,n,e){"use strict";var r=t(33),o=t(12)(0),i=t(105)([].forEach,!0);r(r.P+r.F*!i,"Array",{forEach:function(t){return o(this,t,arguments[1])}})},{105:105,12:12,33:33}],138:[function(t,n,e){"use strict";var r=t(25),o=t(33),i=t(119),a=t(53),u=t(48),s=t(118),c=t(24),l=t(129);o(o.S+o.F*!t(56)(function(t){Array.from(t)}),"Array",{from:function(t){var n,e,o,f,d=i(t),h="function"==typeof this?this:Array,v=arguments.length,g=v>1?arguments[1]:void 0,p=void 0!==g,y=0,m=l(d);if(p&&(g=r(g,v>2?arguments[2]:void 0,2)),null==m||h==Array&&u(m))for(e=new h(n=s(d.length));n>y;y++)c(e,y,p?g(d[y],y):d[y]);else for(f=m.call(d),e=new h;!(o=f.next()).done;y++)c(e,y,p?a(f,g,[o.value,y],!0):o.value);return e.length=y,e}})},{118:118,119:119,129:129,24:24,25:25,33:33,48:48,53:53,56:56}],139:[function(t,n,e){"use strict";var r=t(33),o=t(11)(!1),i=[].indexOf,a=!!i&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(a||!t(105)(i)),"Array",{indexOf:function(t){return a?i.apply(this,arguments)||0:o(this,t,arguments[1])}})},{105:105,11:11,33:33}],140:[function(t,n,e){var r=t(33);r(r.S,"Array",{isArray:t(49)})},{33:33,49:49}],141:[function(t,n,e){"use strict";var r=t(5),o=t(57),i=t(58),a=t(117);n.exports=t(55)(Array,"Array",function(t,n){this._t=a(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,o(1)):o(0,"keys"==n?e:"values"==n?t[e]:[e,t[e]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},{117:117,5:5,55:55,57:57,58:58}],142:[function(t,n,e){"use strict";var r=t(33),o=t(117),i=[].join;r(r.P+r.F*(t(47)!=Object||!t(105)(i)),"Array",{join:function(t){return i.call(o(this),void 0===t?",":t)}})},{105:105,117:117,33:33,47:47}],143:[function(t,n,e){"use strict";var r=t(33),o=t(117),i=t(116),a=t(118),u=[].lastIndexOf,s=!!u&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(s||!t(105)(u)),"Array",{lastIndexOf:function(t){if(s)return u.apply(this,arguments)||0;var n=o(this),e=a(n.length),r=e-1;for(arguments.length>1&&(r=Math.min(r,i(arguments[1]))),r<0&&(r=e+r);r>=0;r--)if(r in n&&n[r]===t)return r||0;return-1}})},{105:105,116:116,117:117,118:118,33:33}],144:[function(t,n,e){"use strict";var r=t(33),o=t(12)(1);r(r.P+r.F*!t(105)([].map,!0),"Array",{map:function(t){return o(this,t,arguments[1])}})},{105:105,12:12,33:33}],145:[function(t,n,e){"use strict";var r=t(33),o=t(24);r(r.S+r.F*t(35)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,e=new("function"==typeof this?this:Array)(n);n>t;)o(e,t,arguments[t++]);return e.length=n,e}})},{24:24,33:33,35:35}],146:[function(t,n,e){"use strict";var r=t(33),o=t(13);r(r.P+r.F*!t(105)([].reduceRight,!0),"Array",{reduceRight:function(t){return o(this,t,arguments.length,arguments[1],!0)}})},{105:105,13:13,33:33}],147:[function(t,n,e){"use strict";var r=t(33),o=t(13);r(r.P+r.F*!t(105)([].reduce,!0),"Array",{reduce:function(t){return o(this,t,arguments.length,arguments[1],!1)}})},{105:105,13:13,33:33}],148:[function(t,n,e){"use strict";var r=t(33),o=t(43),i=t(18),a=t(114),u=t(118),s=[].slice;r(r.P+r.F*t(35)(function(){o&&s.call(o)}),"Array",{slice:function(t,n){var e=u(this.length),r=i(this);if(n=void 0===n?e:n,"Array"==r)return s.call(this,t,n);for(var o=a(t,e),c=a(n,e),l=u(c-o),f=Array(l),d=0;d<l;d++)f[d]="String"==r?this.charAt(o+d):this[o+d];return f}})},{114:114,118:118,18:18,33:33,35:35,43:43}],149:[function(t,n,e){"use strict";var r=t(33),o=t(12)(3);r(r.P+r.F*!t(105)([].some,!0),"Array",{some:function(t){return o(this,t,arguments[1])}})},{105:105,12:12,33:33}],150:[function(t,n,e){"use strict";var r=t(33),o=t(3),i=t(119),a=t(35),u=[].sort,s=[1,2,3];r(r.P+r.F*(a(function(){s.sort(void 0)})||!a(function(){s.sort(null)})||!t(105)(u)),"Array",{sort:function(t){return void 0===t?u.call(i(this)):u.call(i(this),o(t))}})},{105:105,119:119,3:3,33:33,35:35}],151:[function(t,n,e){t(100)("Array")},{100:100}],152:[function(t,n,e){var r=t(33);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},{33:33}],153:[function(t,n,e){var r=t(33),o=t(26);r(r.P+r.F*(Date.prototype.toISOString!==o),"Date",{toISOString:o})},{26:26,33:33}],154:[function(t,n,e){"use strict";var r=t(33),o=t(119),i=t(120);r(r.P+r.F*t(35)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=o(this),e=i(n);return"number"!=typeof e||isFinite(e)?n.toISOString():null}})},{119:119,120:120,33:33,35:35}],155:[function(t,n,e){var r=t(128)("toPrimitive"),o=Date.prototype;r in o||t(42)(o,r,t(27))},{128:128,27:27,42:42}],156:[function(t,n,e){var r=Date.prototype,o=r.toString,i=r.getTime;new Date(NaN)+""!="Invalid Date"&&t(94)(r,"toString",function(){var t=i.call(this);return t==t?o.call(this):"Invalid Date"})},{94:94}],157:[function(t,n,e){var r=t(33);r(r.P,"Function",{bind:t(16)})},{16:16,33:33}],158:[function(t,n,e){"use strict";var r=t(51),o=t(79),i=t(128)("hasInstance"),a=Function.prototype;i in a||t(72).f(a,i,{value:function(t){if("function"!=typeof this||!r(t))return!1;if(!r(this.prototype))return t instanceof this;for(;t=o(t);)if(this.prototype===t)return!0;return!1}})},{128:128,51:51,72:72,79:79}],159:[function(t,n,e){var r=t(72).f,o=Function.prototype,i=/^\s*function ([^ (]*)/;"name"in o||t(29)&&r(o,"name",{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},{29:29,72:72}],160:[function(t,n,e){"use strict";var r=t(19),o=t(125);n.exports=t(22)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=r.getEntry(o(this,"Map"),t);return n&&n.v},set:function(t,n){return r.def(o(this,"Map"),0===t?0:t,n)}},r,!0)},{125:125,19:19,22:22}],161:[function(t,n,e){var r=t(33),o=t(63),i=Math.sqrt,a=Math.acosh;r(r.S+r.F*!(a&&710==Math.floor(a(Number.MAX_VALUE))&&a(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:o(t-1+i(t-1)*i(t+1))}})},{33:33,63:63}],162:[function(t,n,e){var r=t(33),o=Math.asinh;r(r.S+r.F*!(o&&1/o(0)>0),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},{33:33}],163:[function(t,n,e){var r=t(33),o=Math.atanh;r(r.S+r.F*!(o&&1/o(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},{33:33}],164:[function(t,n,e){var r=t(33),o=t(65);r(r.S,"Math",{cbrt:function(t){return o(t=+t)*Math.pow(Math.abs(t),1/3)}})},{33:33,65:65}],165:[function(t,n,e){var r=t(33);r(r.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},{33:33}],166:[function(t,n,e){var r=t(33),o=Math.exp;r(r.S,"Math",{cosh:function(t){return(o(t=+t)+o(-t))/2}})},{33:33}],167:[function(t,n,e){var r=t(33),o=t(61);r(r.S+r.F*(o!=Math.expm1),"Math",{expm1:o})},{33:33,61:61}],168:[function(t,n,e){var r=t(33);r(r.S,"Math",{fround:t(62)})},{33:33,62:62}],169:[function(t,n,e){var r=t(33),o=Math.abs;r(r.S,"Math",{hypot:function(t,n){for(var e,r,i=0,a=0,u=arguments.length,s=0;a<u;)s<(e=o(arguments[a++]))?(i=i*(r=s/e)*r+1,s=e):i+=e>0?(r=e/s)*r:e;return s===1/0?1/0:s*Math.sqrt(i)}})},{33:33}],170:[function(t,n,e){var r=t(33),o=Math.imul;r(r.S+r.F*t(35)(function(){return-5!=o(4294967295,5)||2!=o.length}),"Math",{imul:function(t,n){var e=+t,r=+n,o=65535&e,i=65535&r;return 0|o*i+((65535&e>>>16)*i+o*(65535&r>>>16)<<16>>>0)}})},{33:33,35:35}],171:[function(t,n,e){var r=t(33);r(r.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},{33:33}],172:[function(t,n,e){var r=t(33);r(r.S,"Math",{log1p:t(63)})},{33:33,63:63}],173:[function(t,n,e){var r=t(33);r(r.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},{33:33}],174:[function(t,n,e){var r=t(33);r(r.S,"Math",{sign:t(65)})},{33:33,65:65}],175:[function(t,n,e){var r=t(33),o=t(61),i=Math.exp;r(r.S+r.F*t(35)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(o(t)-o(-t))/2:(i(t-1)-i(-t-1))*(Math.E/2)}})},{33:33,35:35,61:61}],176:[function(t,n,e){var r=t(33),o=t(61),i=Math.exp;r(r.S,"Math",{tanh:function(t){var n=o(t=+t),e=o(-t);return n==1/0?1:e==1/0?-1:(n-e)/(i(t)+i(-t))}})},{33:33,61:61}],177:[function(t,n,e){var r=t(33);r(r.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},{33:33}],178:[function(t,n,e){"use strict";var r=t(40),o=t(41),i=t(18),a=t(45),u=t(120),s=t(35),c=t(77).f,l=t(75).f,f=t(72).f,d=t(111).trim,h=r.Number,v=h,g=h.prototype,p="Number"==i(t(71)(g)),y="trim"in String.prototype,m=function(t){var n=u(t,!1);if("string"==typeof n&&n.length>2){var e,r,o,i=(n=y?n.trim():d(n,3)).charCodeAt(0);if(43===i||45===i){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===i){switch(n.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+n}for(var a,s=n.slice(2),c=0,l=s.length;c<l;c++)if((a=s.charCodeAt(c))<48||a>o)return NaN;return parseInt(s,r)}}return+n};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(t){var n=arguments.length<1?0:t,e=this;return e instanceof h&&(p?s(function(){g.valueOf.call(e)}):"Number"!=i(e))?a(new v(m(n)),e,h):m(n)};for(var _,b=t(29)?c(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;b.length>w;w++)o(v,_=b[w])&&!o(h,_)&&f(h,_,l(v,_));h.prototype=g,g.constructor=h,t(94)(r,"Number",h)}},{111:111,120:120,18:18,29:29,35:35,40:40,41:41,45:45,71:71,72:72,75:75,77:77,94:94}],179:[function(t,n,e){var r=t(33);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},{33:33}],180:[function(t,n,e){var r=t(33),o=t(40).isFinite;r(r.S,"Number",{isFinite:function(t){return"number"==typeof t&&o(t)}})},{33:33,40:40}],181:[function(t,n,e){var r=t(33);r(r.S,"Number",{isInteger:t(50)})},{33:33,50:50}],182:[function(t,n,e){var r=t(33);r(r.S,"Number",{isNaN:function(t){return t!=t}})},{33:33}],183:[function(t,n,e){var r=t(33),o=t(50),i=Math.abs;r(r.S,"Number",{isSafeInteger:function(t){return o(t)&&i(t)<=9007199254740991}})},{33:33,50:50}],184:[function(t,n,e){var r=t(33);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{33:33}],185:[function(t,n,e){var r=t(33);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{33:33}],186:[function(t,n,e){var r=t(33),o=t(86);r(r.S+r.F*(Number.parseFloat!=o),"Number",{parseFloat:o})},{33:33,86:86}],187:[function(t,n,e){var r=t(33),o=t(87);r(r.S+r.F*(Number.parseInt!=o),"Number",{parseInt:o})},{33:33,87:87}],188:[function(t,n,e){"use strict";var r=t(33),o=t(116),i=t(4),a=t(110),u=1..toFixed,s=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",f=function(t,n){for(var e=-1,r=n;++e<6;)r+=t*c[e],c[e]=r%1e7,r=s(r/1e7)},d=function(t){for(var n=6,e=0;--n>=0;)e+=c[n],c[n]=s(e/t),e=e%t*1e7},h=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==c[t]){var e=String(c[t]);n=""===n?e:n+a.call("0",7-e.length)+e}return n},v=function(t,n,e){return 0===n?e:n%2==1?v(t,n-1,e*t):v(t*t,n/2,e)};r(r.P+r.F*(!!u&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!t(35)(function(){u.call({})})),"Number",{toFixed:function(t){var n,e,r,u,s=i(this,l),c=o(t),g="",p="0";if(c<0||c>20)throw RangeError(l);if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return String(s);if(s<0&&(g="-",s=-s),s>1e-21)if(e=(n=function(t){for(var n=0,e=t;e>=4096;)n+=12,e/=4096;for(;e>=2;)n+=1,e/=2;return n}(s*v(2,69,1))-69)<0?s*v(2,-n,1):s/v(2,n,1),e*=4503599627370496,(n=52-n)>0){for(f(0,e),r=c;r>=7;)f(1e7,0),r-=7;for(f(v(10,r,1),0),r=n-1;r>=23;)d(1<<23),r-=23;d(1<<r),f(1,1),d(2),p=h()}else f(0,e),f(1<<-n,0),p=h()+a.call("0",c);return p=c>0?g+((u=p.length)<=c?"0."+a.call("0",c-u)+p:p.slice(0,u-c)+"."+p.slice(u-c)):g+p}})},{110:110,116:116,33:33,35:35,4:4}],189:[function(t,n,e){"use strict";var r=t(33),o=t(35),i=t(4),a=1..toPrecision;r(r.P+r.F*(o(function(){return"1"!==a.call(1,void 0)})||!o(function(){a.call({})})),"Number",{toPrecision:function(t){var n=i(this,"Number#toPrecision: incorrect invocation!");return void 0===t?a.call(n):a.call(n,t)}})},{33:33,35:35,4:4}],190:[function(t,n,e){var r=t(33);r(r.S+r.F,"Object",{assign:t(70)})},{33:33,70:70}],191:[function(t,n,e){var r=t(33);r(r.S,"Object",{create:t(71)})},{33:33,71:71}],192:[function(t,n,e){var r=t(33);r(r.S+r.F*!t(29),"Object",{defineProperties:t(73)})},{29:29,33:33,73:73}],193:[function(t,n,e){var r=t(33);r(r.S+r.F*!t(29),"Object",{defineProperty:t(72).f})},{29:29,33:33,72:72}],194:[function(t,n,e){var r=t(51),o=t(66).onFreeze;t(83)("freeze",function(t){return function(n){return t&&r(n)?t(o(n)):n}})},{51:51,66:66,83:83}],195:[function(t,n,e){var r=t(117),o=t(75).f;t(83)("getOwnPropertyDescriptor",function(){return function(t,n){return o(r(t),n)}})},{117:117,75:75,83:83}],196:[function(t,n,e){t(83)("getOwnPropertyNames",function(){return t(76).f})},{76:76,83:83}],197:[function(t,n,e){var r=t(119),o=t(79);t(83)("getPrototypeOf",function(){return function(t){return o(r(t))}})},{119:119,79:79,83:83}],198:[function(t,n,e){var r=t(51);t(83)("isExtensible",function(t){return function(n){return!!r(n)&&(!t||t(n))}})},{51:51,83:83}],199:[function(t,n,e){var r=t(51);t(83)("isFrozen",function(t){return function(n){return!r(n)||!!t&&t(n)}})},{51:51,83:83}],200:[function(t,n,e){var r=t(51);t(83)("isSealed",function(t){return function(n){return!r(n)||!!t&&t(n)}})},{51:51,83:83}],201:[function(t,n,e){var r=t(33);r(r.S,"Object",{is:t(96)})},{33:33,96:96}],202:[function(t,n,e){var r=t(119),o=t(81);t(83)("keys",function(){return function(t){return o(r(t))}})},{119:119,81:81,83:83}],203:[function(t,n,e){var r=t(51),o=t(66).onFreeze;t(83)("preventExtensions",function(t){return function(n){return t&&r(n)?t(o(n)):n}})},{51:51,66:66,83:83}],204:[function(t,n,e){var r=t(51),o=t(66).onFreeze;t(83)("seal",function(t){return function(n){return t&&r(n)?t(o(n)):n}})},{51:51,66:66,83:83}],205:[function(t,n,e){var r=t(33);r(r.S,"Object",{setPrototypeOf:t(99).set})},{33:33,99:99}],206:[function(t,n,e){"use strict";var r=t(17),o={};o[t(128)("toStringTag")]="z",o+""!="[object z]"&&t(94)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},{128:128,17:17,94:94}],207:[function(t,n,e){var r=t(33),o=t(86);r(r.G+r.F*(parseFloat!=o),{parseFloat:o})},{33:33,86:86}],208:[function(t,n,e){var r=t(33),o=t(87);r(r.G+r.F*(parseInt!=o),{parseInt:o})},{33:33,87:87}],209:[function(t,n,e){"use strict";var r,o,i,a,u=t(60),s=t(40),c=t(25),l=t(17),f=t(33),d=t(51),h=t(3),v=t(6),g=t(39),p=t(104),y=t(113).set,m=t(68)(),_=t(69),b=t(90),w=t(91),x=s.TypeError,A=s.process,k=s.Promise,S="process"==l(A),T=function(){},P=o=_.f,I=!!function(){try{var n=k.resolve(1),e=(n.constructor={})[t(128)("species")]=function(t){t(T,T)};return(S||"function"==typeof PromiseRejectionEvent)&&n.then(T)instanceof e}catch(t){}}(),C=u?function(t,n){return t===n||t===k&&n===a}:function(t,n){return t===n},E=function(t){var n;return!(!d(t)||"function"!=typeof(n=t.then))&&n},O=function(t,n){if(!t._n){t._n=!0;var e=t._c;m(function(){for(var r=t._v,o=1==t._s,i=0,a=function(n){var e,i,a=o?n.ok:n.fail,u=n.resolve,s=n.reject,c=n.domain;try{a?(o||(2==t._h&&N(t),t._h=1),!0===a?e=r:(c&&c.enter(),e=a(r),c&&c.exit()),e===n.promise?s(x("Promise-chain cycle")):(i=E(e))?i.call(e,u,s):u(e)):s(r)}catch(t){s(t)}};e.length>i;)a(e[i++]);t._c=[],t._n=!1,n&&!t._h&&M(t)})}},M=function(t){y.call(s,function(){var n,e,r,o=t._v,i=j(t);if(i&&(n=b(function(){S?A.emit("unhandledRejection",o,t):(e=s.onunhandledrejection)?e({promise:t,reason:o}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=S||j(t)?2:1),t._a=void 0,i&&n.e)throw n.v})},j=function(t){if(1==t._h)return!1;for(var n,e=t._a||t._c,r=0;e.length>r;)if((n=e[r++]).fail||!j(n.promise))return!1;return!0},N=function(t){y.call(s,function(){var n;S?A.emit("rejectionHandled",t):(n=s.onrejectionhandled)&&n({promise:t,reason:t._v})})},L=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),O(n,!0))},W=function(t){var n,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw x("Promise can't be resolved itself");(n=E(t))?m(function(){var r={_w:e,_d:!1};try{n.call(t,c(W,r,1),c(L,r,1))}catch(t){L.call(r,t)}}):(e._v=t,e._s=1,O(e,!1))}catch(t){L.call({_w:e,_d:!1},t)}}};I||(k=function(t){v(this,k,"Promise","_h"),h(t),r.call(this);try{t(c(W,this,1),c(L,this,1))}catch(t){L.call(this,t)}},(r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=t(93)(k.prototype,{then:function(t,n){var e=P(p(this,k));return e.ok="function"!=typeof t||t,e.fail="function"==typeof n&&n,e.domain=S?A.domain:void 0,this._c.push(e),this._a&&this._a.push(e),this._s&&O(this,!1),e.promise},catch:function(t){return this.then(void 0,t)}}),i=function(){var t=new r;this.promise=t,this.resolve=c(W,t,1),this.reject=c(L,t,1)},_.f=P=function(t){return C(k,t)?new i(t):o(t)}),f(f.G+f.W+f.F*!I,{Promise:k}),t(101)(k,"Promise"),t(100)("Promise"),a=t(23).Promise,f(f.S+f.F*!I,"Promise",{reject:function(t){var n=P(this);return(0,n.reject)(t),n.promise}}),f(f.S+f.F*(u||!I),"Promise",{resolve:function(t){return t instanceof k&&C(t.constructor,this)?t:w(this,t)}}),f(f.S+f.F*!(I&&t(56)(function(t){k.all(t).catch(T)})),"Promise",{all:function(t){var n=this,e=P(n),r=e.resolve,o=e.reject,i=b(function(){var e=[],i=0,a=1;g(t,!1,function(t){var u=i++,s=!1;e.push(void 0),a++,n.resolve(t).then(function(t){s||(s=!0,e[u]=t,--a||r(e))},o)}),--a||r(e)});return i.e&&o(i.v),e.promise},race:function(t){var n=this,e=P(n),r=e.reject,o=b(function(){g(t,!1,function(t){n.resolve(t).then(e.resolve,r)})});return o.e&&r(o.v),e.promise}})},{100:100,101:101,104:104,113:113,128:128,17:17,23:23,25:25,3:3,33:33,39:39,40:40,51:51,56:56,6:6,60:60,68:68,69:69,90:90,91:91,93:93}],210:[function(t,n,e){var r=t(33),o=t(3),i=t(7),a=(t(40).Reflect||{}).apply,u=Function.apply;r(r.S+r.F*!t(35)(function(){a(function(){})}),"Reflect",{apply:function(t,n,e){var r=o(t),s=i(e);return a?a(r,n,s):u.call(r,n,s)}})},{3:3,33:33,35:35,40:40,7:7}],211:[function(t,n,e){var r=t(33),o=t(71),i=t(3),a=t(7),u=t(51),s=t(35),c=t(16),l=(t(40).Reflect||{}).construct,f=s(function(){function t(){}return!(l(function(){},[],t)instanceof t)}),d=!s(function(){l(function(){})});r(r.S+r.F*(f||d),"Reflect",{construct:function(t,n){i(t),a(n);var e=arguments.length<3?t:i(arguments[2]);if(d&&!f)return l(t,n,e);if(t==e){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var r=[null];return r.push.apply(r,n),new(c.apply(t,r))}var s=e.prototype,h=o(u(s)?s:Object.prototype),v=Function.apply.call(t,h,n);return u(v)?v:h}})},{16:16,3:3,33:33,35:35,40:40,51:51,7:7,71:71}],212:[function(t,n,e){var r=t(72),o=t(33),i=t(7),a=t(120);o(o.S+o.F*t(35)(function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,e){i(t),n=a(n,!0),i(e);try{return r.f(t,n,e),!0}catch(t){return!1}}})},{120:120,33:33,35:35,7:7,72:72}],213:[function(t,n,e){var r=t(33),o=t(75).f,i=t(7);r(r.S,"Reflect",{deleteProperty:function(t,n){var e=o(i(t),n);return!(e&&!e.configurable)&&delete t[n]}})},{33:33,7:7,75:75}],214:[function(t,n,e){"use strict";var r=t(33),o=t(7),i=function(t){this._t=o(t),this._i=0;var n,e=this._k=[];for(n in t)e.push(n)};t(54)(i,"Object",function(){var t,n=this._k;do{if(this._i>=n.length)return{value:void 0,done:!0}}while(!((t=n[this._i++])in this._t));return{value:t,done:!1}}),r(r.S,"Reflect",{enumerate:function(t){return new i(t)}})},{33:33,54:54,7:7}],215:[function(t,n,e){var r=t(75),o=t(33),i=t(7);o(o.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return r.f(i(t),n)}})},{33:33,7:7,75:75}],216:[function(t,n,e){var r=t(33),o=t(79),i=t(7);r(r.S,"Reflect",{getPrototypeOf:function(t){return o(i(t))}})},{33:33,7:7,79:79}],217:[function(t,n,e){var r=t(75),o=t(79),i=t(41),a=t(33),u=t(51),s=t(7);a(a.S,"Reflect",{get:function t(n,e){var a,c,l=arguments.length<3?n:arguments[2];return s(n)===l?n[e]:(a=r.f(n,e))?i(a,"value")?a.value:void 0!==a.get?a.get.call(l):void 0:u(c=o(n))?t(c,e,l):void 0}})},{33:33,41:41,51:51,7:7,75:75,79:79}],218:[function(t,n,e){var r=t(33);r(r.S,"Reflect",{has:function(t,n){return n in t}})},{33:33}],219:[function(t,n,e){var r=t(33),o=t(7),i=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(t){return o(t),!i||i(t)}})},{33:33,7:7}],220:[function(t,n,e){var r=t(33);r(r.S,"Reflect",{ownKeys:t(85)})},{33:33,85:85}],221:[function(t,n,e){var r=t(33),o=t(7),i=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(t){o(t);try{return i&&i(t),!0}catch(t){return!1}}})},{33:33,7:7}],222:[function(t,n,e){var r=t(33),o=t(99);o&&r(r.S,"Reflect",{setPrototypeOf:function(t,n){o.check(t,n);try{return o.set(t,n),!0}catch(t){return!1}}})},{33:33,99:99}],223:[function(t,n,e){var r=t(72),o=t(75),i=t(79),a=t(41),u=t(33),s=t(92),c=t(7),l=t(51);u(u.S,"Reflect",{set:function t(n,e,u){var f,d,h=arguments.length<4?n:arguments[3],v=o.f(c(n),e);if(!v){if(l(d=i(n)))return t(d,e,u,h);v=s(0)}return a(v,"value")?!(!1===v.writable||!l(h)||((f=o.f(h,e)||s(0)).value=u,r.f(h,e,f),0)):void 0!==v.set&&(v.set.call(h,u),!0)}})},{33:33,41:41,51:51,7:7,72:72,75:75,79:79,92:92}],224:[function(t,n,e){var r=t(40),o=t(45),i=t(72).f,a=t(77).f,u=t(52),s=t(37),c=r.RegExp,l=c,f=c.prototype,d=/a/g,h=/a/g,v=new c(d)!==d;if(t(29)&&(!v||t(35)(function(){return h[t(128)("match")]=!1,c(d)!=d||c(h)==h||"/a/i"!=c(d,"i")}))){c=function(t,n){var e=this instanceof c,r=u(t),i=void 0===n;return!e&&r&&t.constructor===c&&i?t:o(v?new l(r&&!i?t.source:t,n):l((r=t instanceof c)?t.source:t,r&&i?s.call(t):n),e?this:f,c)};for(var g=function(t){t in c||i(c,t,{configurable:!0,get:function(){return l[t]},set:function(n){l[t]=n}})},p=a(l),y=0;p.length>y;)g(p[y++]);f.constructor=c,c.prototype=f,t(94)(r,"RegExp",c)}t(100)("RegExp")},{100:100,128:128,29:29,35:35,37:37,40:40,45:45,52:52,72:72,77:77,94:94}],225:[function(t,n,e){t(29)&&"g"!=/./g.flags&&t(72).f(RegExp.prototype,"flags",{configurable:!0,get:t(37)})},{29:29,37:37,72:72}],226:[function(t,n,e){t(36)("match",1,function(t,n,e){return[function(e){"use strict";var r=t(this),o=null==e?void 0:e[n];return void 0!==o?o.call(e,r):new RegExp(e)[n](String(r))},e]})},{36:36}],227:[function(t,n,e){t(36)("replace",2,function(t,n,e){return[function(r,o){"use strict";var i=t(this),a=null==r?void 0:r[n];return void 0!==a?a.call(r,i,o):e.call(String(i),r,o)},e]})},{36:36}],228:[function(t,n,e){t(36)("search",1,function(t,n,e){return[function(e){"use strict";var r=t(this),o=null==e?void 0:e[n];return void 0!==o?o.call(e,r):new RegExp(e)[n](String(r))},e]})},{36:36}],229:[function(t,n,e){t(36)("split",2,function(n,e,r){"use strict";var o=t(52),i=r,a=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var u=void 0===/()??/.exec("")[1];r=function(t,n){var e=String(this);if(void 0===t&&0===n)return[];if(!o(t))return i.call(e,t,n);var r,s,c,l,f,d=[],h=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),v=0,g=void 0===n?4294967295:n>>>0,p=new RegExp(t.source,h+"g");for(u||(r=new RegExp("^"+p.source+"$(?!\\s)",h));(s=p.exec(e))&&!((c=s.index+s[0].length)>v&&(d.push(e.slice(v,s.index)),!u&&s.length>1&&s[0].replace(r,function(){for(f=1;f<arguments.length-2;f++)void 0===arguments[f]&&(s[f]=void 0)}),s.length>1&&s.index<e.length&&a.apply(d,s.slice(1)),l=s[0].length,v=c,d.length>=g));)p.lastIndex===s.index&&p.lastIndex++;return v===e.length?!l&&p.test("")||d.push(""):d.push(e.slice(v)),d.length>g?d.slice(0,g):d}}else"0".split(void 0,0).length&&(r=function(t,n){return void 0===t&&0===n?[]:i.call(this,t,n)});return[function(t,o){var i=n(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,o):r.call(String(i),t,o)},r]})},{36:36,52:52}],230:[function(t,n,e){"use strict";t(225);var r=t(7),o=t(37),i=t(29),a=/./.toString,u=function(n){t(94)(RegExp.prototype,"toString",n,!0)};t(35)(function(){return"/a/b"!=a.call({source:"a",flags:"b"})})?u(function(){var t=r(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?o.call(t):void 0)}):"toString"!=a.name&&u(function(){return a.call(this)})},{225:225,29:29,35:35,37:37,7:7,94:94}],231:[function(t,n,e){"use strict";var r=t(19),o=t(125);n.exports=t(22)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return r.def(o(this,"Set"),t=0===t?0:t,t)}},r)},{125:125,19:19,22:22}],232:[function(t,n,e){"use strict";t(108)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},{108:108}],233:[function(t,n,e){"use strict";t(108)("big",function(t){return function(){return t(this,"big","","")}})},{108:108}],234:[function(t,n,e){"use strict";t(108)("blink",function(t){return function(){return t(this,"blink","","")}})},{108:108}],235:[function(t,n,e){"use strict";t(108)("bold",function(t){return function(){return t(this,"b","","")}})},{108:108}],236:[function(t,n,e){"use strict";var r=t(33),o=t(106)(!1);r(r.P,"String",{codePointAt:function(t){return o(this,t)}})},{106:106,33:33}],237:[function(t,n,e){"use strict";var r=t(33),o=t(118),i=t(107),a="".endsWith;r(r.P+r.F*t(34)("endsWith"),"String",{endsWith:function(t){var n=i(this,t,"endsWith"),e=arguments.length>1?arguments[1]:void 0,r=o(n.length),u=void 0===e?r:Math.min(o(e),r),s=String(t);return a?a.call(n,s,u):n.slice(u-s.length,u)===s}})},{107:107,118:118,33:33,34:34}],238:[function(t,n,e){"use strict";t(108)("fixed",function(t){return function(){return t(this,"tt","","")}})},{108:108}],239:[function(t,n,e){"use strict";t(108)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},{108:108}],240:[function(t,n,e){"use strict";t(108)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},{108:108}],241:[function(t,n,e){var r=t(33),o=t(114),i=String.fromCharCode,a=String.fromCodePoint;r(r.S+r.F*(!!a&&1!=a.length),"String",{fromCodePoint:function(t){for(var n,e=[],r=arguments.length,a=0;r>a;){if(n=+arguments[a++],o(n,1114111)!==n)throw RangeError(n+" is not a valid code point");e.push(n<65536?i(n):i(55296+((n-=65536)>>10),n%1024+56320))}return e.join("")}})},{114:114,33:33}],242:[function(t,n,e){"use strict";var r=t(33),o=t(107);r(r.P+r.F*t(34)("includes"),"String",{includes:function(t){return!!~o(this,t,"includes").indexOf(t,arguments.length>1?arguments[1]:void 0)}})},{107:107,33:33,34:34}],243:[function(t,n,e){"use strict";t(108)("italics",function(t){return function(){return t(this,"i","","")}})},{108:108}],244:[function(t,n,e){"use strict";var r=t(106)(!0);t(55)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=r(n,e),this._i+=t.length,{value:t,done:!1})})},{106:106,55:55}],245:[function(t,n,e){"use strict";t(108)("link",function(t){return function(n){return t(this,"a","href",n)}})},{108:108}],246:[function(t,n,e){var r=t(33),o=t(117),i=t(118);r(r.S,"String",{raw:function(t){for(var n=o(t.raw),e=i(n.length),r=arguments.length,a=[],u=0;e>u;)a.push(String(n[u++])),u<r&&a.push(String(arguments[u]));return a.join("")}})},{117:117,118:118,33:33}],247:[function(t,n,e){var r=t(33);r(r.P,"String",{repeat:t(110)})},{110:110,33:33}],248:[function(t,n,e){"use strict";t(108)("small",function(t){return function(){return t(this,"small","","")}})},{108:108}],249:[function(t,n,e){"use strict";var r=t(33),o=t(118),i=t(107),a="".startsWith;r(r.P+r.F*t(34)("startsWith"),"String",{startsWith:function(t){var n=i(this,t,"startsWith"),e=o(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),r=String(t);return a?a.call(n,r,e):n.slice(e,e+r.length)===r}})},{107:107,118:118,33:33,34:34}],250:[function(t,n,e){"use strict";t(108)("strike",function(t){return function(){return t(this,"strike","","")}})},{108:108}],251:[function(t,n,e){"use strict";t(108)("sub",function(t){return function(){return t(this,"sub","","")}})},{108:108}],252:[function(t,n,e){"use strict";t(108)("sup",function(t){return function(){return t(this,"sup","","")}})},{108:108}],253:[function(t,n,e){"use strict";t(111)("trim",function(t){return function(){return t(this,3)}})},{111:111}],254:[function(t,n,e){"use strict";var r=t(40),o=t(41),i=t(29),a=t(33),u=t(94),s=t(66).KEY,c=t(35),l=t(103),f=t(101),d=t(124),h=t(128),v=t(127),g=t(126),p=t(59),y=t(32),m=t(49),_=t(7),b=t(117),w=t(120),x=t(92),A=t(71),k=t(76),S=t(75),T=t(72),P=t(81),I=S.f,C=T.f,E=k.f,O=r.Symbol,M=r.JSON,j=M&&M.stringify,N=h("_hidden"),L=h("toPrimitive"),W={}.propertyIsEnumerable,R=l("symbol-registry"),D=l("symbols"),F=l("op-symbols"),B=Object.prototype,U="function"==typeof O,H=r.QObject,Q=!H||!H.prototype||!H.prototype.findChild,z=i&&c(function(){return 7!=A(C({},"a",{get:function(){return C(this,"a",{value:7}).a}})).a})?function(t,n,e){var r=I(B,n);r&&delete B[n],C(t,n,e),r&&t!==B&&C(B,n,r)}:C,G=function(t){var n=D[t]=A(O.prototype);return n._k=t,n},V=U&&"symbol"==typeof O.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof O},Y=function(t,n,e){return t===B&&Y(F,n,e),_(t),n=w(n,!0),_(e),o(D,n)?(e.enumerable?(o(t,N)&&t[N][n]&&(t[N][n]=!1),e=A(e,{enumerable:x(0,!1)})):(o(t,N)||C(t,N,x(1,{})),t[N][n]=!0),z(t,n,e)):C(t,n,e)},q=function(t,n){_(t);for(var e,r=y(n=b(n)),o=0,i=r.length;i>o;)Y(t,e=r[o++],n[e]);return t},K=function(t){var n=W.call(this,t=w(t,!0));return!(this===B&&o(D,t)&&!o(F,t))&&(!(n||!o(this,t)||!o(D,t)||o(this,N)&&this[N][t])||n)},J=function(t,n){if(t=b(t),n=w(n,!0),t!==B||!o(D,n)||o(F,n)){var e=I(t,n);return!e||!o(D,n)||o(t,N)&&t[N][n]||(e.enumerable=!0),e}},$=function(t){for(var n,e=E(b(t)),r=[],i=0;e.length>i;)o(D,n=e[i++])||n==N||n==s||r.push(n);return r},X=function(t){for(var n,e=t===B,r=E(e?F:b(t)),i=[],a=0;r.length>a;)!o(D,n=r[a++])||e&&!o(B,n)||i.push(D[n]);return i};U||(u((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),n=function(e){this===B&&n.call(F,e),o(this,N)&&o(this[N],t)&&(this[N][t]=!1),z(this,t,x(1,e))};return i&&Q&&z(B,t,{configurable:!0,set:n}),G(t)}).prototype,"toString",function(){return this._k}),S.f=J,T.f=Y,t(77).f=k.f=$,t(82).f=K,t(78).f=X,i&&!t(60)&&u(B,"propertyIsEnumerable",K,!0),v.f=function(t){return G(h(t))}),a(a.G+a.W+a.F*!U,{Symbol:O});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),tt=0;Z.length>tt;)h(Z[tt++]);for(var nt=P(h.store),et=0;nt.length>et;)g(nt[et++]);a(a.S+a.F*!U,"Symbol",{for:function(t){return o(R,t+="")?R[t]:R[t]=O(t)},keyFor:function(t){if(V(t))return p(R,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),a(a.S+a.F*!U,"Object",{create:function(t,n){return void 0===n?A(t):q(A(t),n)},defineProperty:Y,defineProperties:q,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:X}),M&&a(a.S+a.F*(!U||c(function(){var t=O();return"[null]"!=j([t])||"{}"!=j({a:t})||"{}"!=j(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!V(t)){for(var n,e,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);return"function"==typeof(n=r[1])&&(e=n),!e&&m(n)||(n=function(t,n){if(e&&(n=e.call(this,t,n)),!V(n))return n}),r[1]=n,j.apply(M,r)}}}),O.prototype[L]||t(42)(O.prototype,L,O.prototype.valueOf),f(O,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},{101:101,103:103,117:117,120:120,124:124,126:126,127:127,128:128,29:29,32:32,33:33,35:35,40:40,41:41,42:42,49:49,59:59,60:60,66:66,7:7,71:71,72:72,75:75,76:76,77:77,78:78,81:81,82:82,92:92,94:94}],255:[function(t,n,e){"use strict";var r=t(33),o=t(123),i=t(122),a=t(7),u=t(114),s=t(118),c=t(51),l=t(40).ArrayBuffer,f=t(104),d=i.ArrayBuffer,h=i.DataView,v=o.ABV&&l.isView,g=d.prototype.slice,p=o.VIEW;r(r.G+r.W+r.F*(l!==d),{ArrayBuffer:d}),r(r.S+r.F*!o.CONSTR,"ArrayBuffer",{isView:function(t){return v&&v(t)||c(t)&&p in t}}),r(r.P+r.U+r.F*t(35)(function(){return!new d(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(t,n){if(void 0!==g&&void 0===n)return g.call(a(this),t);for(var e=a(this).byteLength,r=u(t,e),o=u(void 0===n?e:n,e),i=new(f(this,d))(s(o-r)),c=new h(this),l=new h(i),v=0;r<o;)l.setUint8(v++,c.getUint8(r++));return i}}),t(100)("ArrayBuffer")},{100:100,104:104,114:114,118:118,122:122,123:123,33:33,35:35,40:40,51:51,7:7}],256:[function(t,n,e){var r=t(33);r(r.G+r.W+r.F*!t(123).ABV,{DataView:t(122).DataView})},{122:122,123:123,33:33}],257:[function(t,n,e){t(121)("Float32",4,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],258:[function(t,n,e){t(121)("Float64",8,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],259:[function(t,n,e){t(121)("Int16",2,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],260:[function(t,n,e){t(121)("Int32",4,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],261:[function(t,n,e){t(121)("Int8",1,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],262:[function(t,n,e){t(121)("Uint16",2,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],263:[function(t,n,e){t(121)("Uint32",4,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],264:[function(t,n,e){t(121)("Uint8",1,function(t){return function(n,e,r){return t(this,n,e,r)}})},{121:121}],265:[function(t,n,e){t(121)("Uint8",1,function(t){return function(n,e,r){return t(this,n,e,r)}},!0)},{121:121}],266:[function(t,n,e){"use strict";var r,o=t(12)(0),i=t(94),a=t(66),u=t(70),s=t(21),c=t(51),l=t(35),f=t(125),d=a.getWeak,h=Object.isExtensible,v=s.ufstore,g={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},y={get:function(t){if(c(t)){var n=d(t);return!0===n?v(f(this,"WeakMap")).get(t):n?n[this._i]:void 0}},set:function(t,n){return s.def(f(this,"WeakMap"),t,n)}},m=n.exports=t(22)("WeakMap",p,y,s,!0,!0);l(function(){return 7!=(new m).set((Object.freeze||Object)(g),7).get(g)})&&(u((r=s.getConstructor(p,"WeakMap")).prototype,y),a.NEED=!0,o(["delete","has","get","set"],function(t){var n=m.prototype,e=n[t];i(n,t,function(n,o){if(c(n)&&!h(n)){this._f||(this._f=new r);var i=this._f[t](n,o);return"set"==t?this:i}return e.call(this,n,o)})}))},{12:12,125:125,21:21,22:22,35:35,51:51,66:66,70:70,94:94}],267:[function(t,n,e){"use strict";var r=t(21),o=t(125);t(22)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return r.def(o(this,"WeakSet"),t,!0)}},r,!1,!0)},{125:125,21:21,22:22}],268:[function(t,n,e){"use strict";var r=t(33),o=t(38),i=t(119),a=t(118),u=t(3),s=t(15);r(r.P,"Array",{flatMap:function(t){var n,e,r=i(this);return u(t),n=a(r.length),e=s(r,0),o(e,r,r,n,0,1,t,arguments[1]),e}}),t(5)("flatMap")},{118:118,119:119,15:15,3:3,33:33,38:38,5:5}],269:[function(t,n,e){"use strict";var r=t(33),o=t(38),i=t(119),a=t(118),u=t(116),s=t(15);r(r.P,"Array",{flatten:function(){var t=arguments[0],n=i(this),e=a(n.length),r=s(n,0);return o(r,n,n,e,0,void 0===t?1:u(t)),r}}),t(5)("flatten")},{116:116,118:118,119:119,15:15,33:33,38:38,5:5}],270:[function(t,n,e){"use strict";var r=t(33),o=t(11)(!0);r(r.P,"Array",{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),t(5)("includes")},{11:11,33:33,5:5}],271:[function(t,n,e){var r=t(33),o=t(68)(),i=t(40).process,a="process"==t(18)(i);r(r.G,{asap:function(t){var n=a&&i.domain;o(n?n.bind(t):t)}})},{18:18,33:33,40:40,68:68}],272:[function(t,n,e){var r=t(33),o=t(18);r(r.S,"Error",{isError:function(t){return"Error"===o(t)}})},{18:18,33:33}],273:[function(t,n,e){var r=t(33);r(r.G,{global:t(40)})},{33:33,40:40}],274:[function(t,n,e){t(97)("Map")},{97:97}],275:[function(t,n,e){t(98)("Map")},{98:98}],276:[function(t,n,e){var r=t(33);r(r.P+r.R,"Map",{toJSON:t(20)("Map")})},{20:20,33:33}],277:[function(t,n,e){var r=t(33);r(r.S,"Math",{clamp:function(t,n,e){return Math.min(e,Math.max(n,t))}})},{33:33}],278:[function(t,n,e){var r=t(33);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},{33:33}],279:[function(t,n,e){var r=t(33),o=180/Math.PI;r(r.S,"Math",{degrees:function(t){return t*o}})},{33:33}],280:[function(t,n,e){var r=t(33),o=t(64),i=t(62);r(r.S,"Math",{fscale:function(t,n,e,r,a){return i(o(t,n,e,r,a))}})},{33:33,62:62,64:64}],281:[function(t,n,e){var r=t(33);r(r.S,"Math",{iaddh:function(t,n,e,r){var o=t>>>0,i=e>>>0;return(n>>>0)+(r>>>0)+((o&i|(o|i)&~(o+i>>>0))>>>31)|0}})},{33:33}],282:[function(t,n,e){var r=t(33);r(r.S,"Math",{imulh:function(t,n){var e=+t,r=+n,o=65535&e,i=65535&r,a=e>>16,u=r>>16,s=(a*i>>>0)+(o*i>>>16);return a*u+(s>>16)+((o*u>>>0)+(65535&s)>>16)}})},{33:33}],283:[function(t,n,e){var r=t(33);r(r.S,"Math",{isubh:function(t,n,e,r){var o=t>>>0,i=e>>>0;return(n>>>0)-(r>>>0)-((~o&i|~(o^i)&o-i>>>0)>>>31)|0}})},{33:33}],284:[function(t,n,e){var r=t(33);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},{33:33}],285:[function(t,n,e){var r=t(33),o=Math.PI/180;r(r.S,"Math",{radians:function(t){return t*o}})},{33:33}],286:[function(t,n,e){var r=t(33);r(r.S,"Math",{scale:t(64)})},{33:33,64:64}],287:[function(t,n,e){var r=t(33);r(r.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:t>0}})},{33:33}],288:[function(t,n,e){var r=t(33);r(r.S,"Math",{umulh:function(t,n){var e=+t,r=+n,o=65535&e,i=65535&r,a=e>>>16,u=r>>>16,s=(a*i>>>0)+(o*i>>>16);return a*u+(s>>>16)+((o*u>>>0)+(65535&s)>>>16)}})},{33:33}],289:[function(t,n,e){"use strict";var r=t(33),o=t(119),i=t(3),a=t(72);t(29)&&r(r.P+t(74),"Object",{__defineGetter__:function(t,n){a.f(o(this),t,{get:i(n),enumerable:!0,configurable:!0})}})},{119:119,29:29,3:3,33:33,72:72,74:74}],290:[function(t,n,e){"use strict";var r=t(33),o=t(119),i=t(3),a=t(72);t(29)&&r(r.P+t(74),"Object",{__defineSetter__:function(t,n){a.f(o(this),t,{set:i(n),enumerable:!0,configurable:!0})}})},{119:119,29:29,3:3,33:33,72:72,74:74}],291:[function(t,n,e){var r=t(33),o=t(84)(!0);r(r.S,"Object",{entries:function(t){return o(t)}})},{33:33,84:84}],292:[function(t,n,e){var r=t(33),o=t(85),i=t(117),a=t(75),u=t(24);r(r.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,e,r=i(t),s=a.f,c=o(r),l={},f=0;c.length>f;)void 0!==(e=s(r,n=c[f++]))&&u(l,n,e);return l}})},{117:117,24:24,33:33,75:75,85:85}],293:[function(t,n,e){"use strict";var r=t(33),o=t(119),i=t(120),a=t(79),u=t(75).f;t(29)&&r(r.P+t(74),"Object",{__lookupGetter__:function(t){var n,e=o(this),r=i(t,!0);do{if(n=u(e,r))return n.get}while(e=a(e))}})},{119:119,120:120,29:29,33:33,74:74,75:75,79:79}],294:[function(t,n,e){"use strict";var r=t(33),o=t(119),i=t(120),a=t(79),u=t(75).f;t(29)&&r(r.P+t(74),"Object",{__lookupSetter__:function(t){var n,e=o(this),r=i(t,!0);do{if(n=u(e,r))return n.set}while(e=a(e))}})},{119:119,120:120,29:29,33:33,74:74,75:75,79:79}],295:[function(t,n,e){var r=t(33),o=t(84)(!1);r(r.S,"Object",{values:function(t){return o(t)}})},{33:33,84:84}],296:[function(t,n,e){"use strict";var r=t(33),o=t(40),i=t(23),a=t(68)(),u=t(128)("observable"),s=t(3),c=t(7),l=t(6),f=t(93),d=t(42),h=t(39),v=h.RETURN,g=function(t){return null==t?void 0:s(t)},p=function(t){var n=t._c;n&&(t._c=void 0,n())},y=function(t){return void 0===t._o},m=function(t){y(t)||(t._o=void 0,p(t))},_=function(t,n){c(t),this._c=void 0,this._o=t,t=new b(this);try{var e=n(t),r=e;null!=e&&("function"==typeof e.unsubscribe?e=function(){r.unsubscribe()}:s(e),this._c=e)}catch(n){return void t.error(n)}y(this)&&p(this)};_.prototype=f({},{unsubscribe:function(){m(this)}});var b=function(t){this._s=t};b.prototype=f({},{next:function(t){var n=this._s;if(!y(n)){var e=n._o;try{var r=g(e.next);if(r)return r.call(e,t)}catch(t){try{m(n)}finally{throw t}}}},error:function(t){var n=this._s;if(y(n))throw t;var e=n._o;n._o=void 0;try{var r=g(e.error);if(!r)throw t;t=r.call(e,t)}catch(t){try{p(n)}finally{throw t}}return p(n),t},complete:function(t){var n=this._s;if(!y(n)){var e=n._o;n._o=void 0;try{var r=g(e.complete);t=r?r.call(e,t):void 0}catch(t){try{p(n)}finally{throw t}}return p(n),t}}});var w=function(t){l(this,w,"Observable","_f")._f=s(t)};f(w.prototype,{subscribe:function(t){return new _(t,this._f)},forEach:function(t){var n=this;return new(i.Promise||o.Promise)(function(e,r){s(t);var o=n.subscribe({next:function(n){try{return t(n)}catch(t){r(t),o.unsubscribe()}},error:r,complete:e})})}}),f(w,{from:function(t){var n="function"==typeof this?this:w,e=g(c(t)[u]);if(e){var r=c(e.call(t));return r.constructor===n?r:new n(function(t){return r.subscribe(t)})}return new n(function(n){var e=!1;return a(function(){if(!e){try{if(h(t,!1,function(t){if(n.next(t),e)return v})===v)return}catch(t){if(e)throw t;return void n.error(t)}n.complete()}}),function(){e=!0}})},of:function(){for(var t=0,n=arguments.length,e=Array(n);t<n;)e[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return a(function(){if(!n){for(var r=0;r<e.length;++r)if(t.next(e[r]),n)return;t.complete()}}),function(){n=!0}})}}),d(w.prototype,u,function(){return this}),r(r.G,{Observable:w}),t(100)("Observable")},{100:100,128:128,23:23,3:3,33:33,39:39,40:40,42:42,6:6,68:68,7:7,93:93}],297:[function(t,n,e){"use strict";var r=t(33),o=t(23),i=t(40),a=t(104),u=t(91);r(r.P+r.R,"Promise",{finally:function(t){var n=a(this,o.Promise||i.Promise),e="function"==typeof t;return this.then(e?function(e){return u(n,t()).then(function(){return e})}:t,e?function(e){return u(n,t()).then(function(){throw e})}:t)}})},{104:104,23:23,33:33,40:40,91:91}],298:[function(t,n,e){"use strict";var r=t(33),o=t(69),i=t(90);r(r.S,"Promise",{try:function(t){var n=o.f(this),e=i(t);return(e.e?n.reject:n.resolve)(e.v),n.promise}})},{33:33,69:69,90:90}],299:[function(t,n,e){var r=t(67),o=t(7),i=r.key,a=r.set;r.exp({defineMetadata:function(t,n,e,r){a(t,n,o(e),i(r))}})},{67:67,7:7}],300:[function(t,n,e){var r=t(67),o=t(7),i=r.key,a=r.map,u=r.store;r.exp({deleteMetadata:function(t,n){var e=arguments.length<3?void 0:i(arguments[2]),r=a(o(n),e,!1);if(void 0===r||!r.delete(t))return!1;if(r.size)return!0;var s=u.get(n);return s.delete(e),!!s.size||u.delete(n)}})},{67:67,7:7}],301:[function(t,n,e){var r=t(231),o=t(10),i=t(67),a=t(7),u=t(79),s=i.keys,c=i.key,l=function(t,n){var e=s(t,n),i=u(t);if(null===i)return e;var a=l(i,n);return a.length?e.length?o(new r(e.concat(a))):a:e};i.exp({getMetadataKeys:function(t){return l(a(t),arguments.length<2?void 0:c(arguments[1]))}})},{10:10,231:231,67:67,7:7,79:79}],302:[function(t,n,e){var r=t(67),o=t(7),i=t(79),a=r.has,u=r.get,s=r.key,c=function(t,n,e){if(a(t,n,e))return u(t,n,e);var r=i(n);return null!==r?c(t,r,e):void 0};r.exp({getMetadata:function(t,n){return c(t,o(n),arguments.length<3?void 0:s(arguments[2]))}})},{67:67,7:7,79:79}],303:[function(t,n,e){var r=t(67),o=t(7),i=r.keys,a=r.key;r.exp({getOwnMetadataKeys:function(t){return i(o(t),arguments.length<2?void 0:a(arguments[1]))}})},{67:67,7:7}],304:[function(t,n,e){var r=t(67),o=t(7),i=r.get,a=r.key;r.exp({getOwnMetadata:function(t,n){return i(t,o(n),arguments.length<3?void 0:a(arguments[2]))}})},{67:67,7:7}],305:[function(t,n,e){var r=t(67),o=t(7),i=t(79),a=r.has,u=r.key,s=function(t,n,e){if(a(t,n,e))return!0;var r=i(n);return null!==r&&s(t,r,e)};r.exp({hasMetadata:function(t,n){return s(t,o(n),arguments.length<3?void 0:u(arguments[2]))}})},{67:67,7:7,79:79}],306:[function(t,n,e){var r=t(67),o=t(7),i=r.has,a=r.key;r.exp({hasOwnMetadata:function(t,n){return i(t,o(n),arguments.length<3?void 0:a(arguments[2]))}})},{67:67,7:7}],307:[function(t,n,e){var r=t(67),o=t(7),i=t(3),a=r.key,u=r.set;r.exp({metadata:function(t,n){return function(e,r){u(t,n,(void 0!==r?o:i)(e),a(r))}}})},{3:3,67:67,7:7}],308:[function(t,n,e){t(97)("Set")},{97:97}],309:[function(t,n,e){t(98)("Set")},{98:98}],310:[function(t,n,e){var r=t(33);r(r.P+r.R,"Set",{toJSON:t(20)("Set")})},{20:20,33:33}],311:[function(t,n,e){"use strict";var r=t(33),o=t(106)(!0);r(r.P,"String",{at:function(t){return o(this,t)}})},{106:106,33:33}],312:[function(t,n,e){"use strict";var r=t(33),o=t(28),i=t(118),a=t(52),u=t(37),s=RegExp.prototype,c=function(t,n){this._r=t,this._s=n};t(54)(c,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),r(r.P,"String",{matchAll:function(t){if(o(this),!a(t))throw TypeError(t+" is not a regexp!");var n=String(this),e="flags"in s?String(t.flags):u.call(t),r=new RegExp(t.source,~e.indexOf("g")?e:"g"+e);return r.lastIndex=i(t.lastIndex),new c(r,n)}})},{118:118,28:28,33:33,37:37,52:52,54:54}],313:[function(t,n,e){"use strict";var r=t(33),o=t(109);r(r.P,"String",{padEnd:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},{109:109,33:33}],314:[function(t,n,e){"use strict";var r=t(33),o=t(109);r(r.P,"String",{padStart:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},{109:109,33:33}],315:[function(t,n,e){"use strict";t(111)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},{111:111}],316:[function(t,n,e){"use strict";t(111)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},{111:111}],317:[function(t,n,e){t(126)("asyncIterator")},{126:126}],318:[function(t,n,e){t(126)("observable")},{126:126}],319:[function(t,n,e){var r=t(33);r(r.S,"System",{global:t(40)})},{33:33,40:40}],320:[function(t,n,e){t(97)("WeakMap")},{97:97}],321:[function(t,n,e){t(98)("WeakMap")},{98:98}],322:[function(t,n,e){t(97)("WeakSet")},{97:97}],323:[function(t,n,e){t(98)("WeakSet")},{98:98}],324:[function(t,n,e){for(var r=t(141),o=t(81),i=t(94),a=t(40),u=t(42),s=t(58),c=t(128),l=c("iterator"),f=c("toStringTag"),d=s.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},v=o(h),g=0;g<v.length;g++){var p,y=v[g],m=h[y],_=a[y],b=_&&_.prototype;if(b&&(b[l]||u(b,l,d),b[f]||u(b,f,y),s[y]=d,m))for(p in r)b[p]||i(b,p,r[p],!0)}},{128:128,141:141,40:40,42:42,58:58,81:81,94:94}],325:[function(t,n,e){var r=t(33),o=t(113);r(r.G+r.B,{setImmediate:o.set,clearImmediate:o.clear})},{113:113,33:33}],326:[function(t,n,e){var r=t(40),o=t(33),i=t(46),a=t(88),u=r.navigator,s=!!u&&/MSIE .\./.test(u.userAgent),c=function(t){return s?function(n,e){return t(i(a,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),e)}:t};o(o.G+o.B+o.F*s,{setTimeout:c(r.setTimeout),setInterval:c(r.setInterval)})},{33:33,40:40,46:46,88:88}],327:[function(t,n,e){t(254),t(191),t(193),t(192),t(195),t(197),t(202),t(196),t(194),t(204),t(203),t(199),t(200),t(198),t(190),t(201),t(205),t(206),t(157),t(159),t(158),t(208),t(207),t(178),t(188),t(189),t(179),t(180),t(181),t(182),t(183),t(184),t(185),t(186),t(187),t(161),t(162),t(163),t(164),t(165),t(166),t(167),t(168),t(169),t(170),t(171),t(172),t(173),t(174),t(175),t(176),t(177),t(241),t(246),t(253),t(244),t(236),t(237),t(242),t(247),t(249),t(232),t(233),t(234),t(235),t(238),t(239),t(240),t(243),t(245),t(248),t(250),t(251),t(252),t(152),t(154),t(153),t(156),t(155),t(140),t(138),t(145),t(142),t(148),t(150),t(137),t(144),t(134),t(149),t(132),t(147),t(146),t(139),t(143),t(131),t(133),t(136),t(135),t(151),t(141),t(224),t(230),t(225),t(226),t(227),t(228),t(229),t(209),t(160),t(231),t(266),t(267),t(255),t(256),t(261),t(264),t(265),t(259),t(262),t(260),t(263),t(257),t(258),t(210),t(211),t(212),t(213),t(214),t(217),t(215),t(216),t(218),t(219),t(220),t(221),t(223),t(222),t(270),t(268),t(269),t(311),t(314),t(313),t(315),t(316),t(312),t(317),t(318),t(292),t(295),t(291),t(289),t(290),t(293),t(294),t(276),t(310),t(275),t(309),t(321),t(323),t(274),t(308),t(320),t(322),t(273),t(319),t(272),t(277),t(278),t(279),t(280),t(281),t(283),t(282),t(284),t(285),t(286),t(288),t(287),t(297),t(298),t(299),t(300),t(302),t(301),t(304),t(303),t(305),t(306),t(307),t(271),t(296),t(326),t(325),t(324),n.exports=t(23)},{131:131,132:132,133:133,134:134,135:135,136:136,137:137,138:138,139:139,140:140,141:141,142:142,143:143,144:144,145:145,146:146,147:147,148:148,149:149,150:150,151:151,152:152,153:153,154:154,155:155,156:156,157:157,158:158,159:159,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,23:23,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:256,257:257,258:258,259:259,260:260,261:261,262:262,263:263,264:264,265:265,266:266,267:267,268:268,269:269,270:270,271:271,272:272,273:273,274:274,275:275,276:276,277:277,278:278,279:279,280:280,281:281,282:282,283:283,284:284,285:285,286:286,287:287,288:288,289:289,290:290,291:291,292:292,293:293,294:294,295:295,296:296,297:297,298:298,299:299,300:300,301:301,302:302,303:303,304:304,305:305,306:306,307:307,308:308,309:309,310:310,311:311,312:312,313:313,314:314,315:315,316:316,317:317,318:318,319:319,320:320,321:321,322:322,323:323,324:324,325:325,326:326}],328:[function(n,e,r){(function(t){!function(t){"use strict";var n,r=Object.prototype,o=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=b;var f="suspendedStart",d="suspendedYield",h="executing",v="completed",g={},p={};p[a]=function(){return this};var y=Object.getPrototypeOf,m=y&&y(y(O([])));m&&m!==r&&o.call(m,a)&&(p=m);var _=k.prototype=x.prototype=Object.create(p);A.prototype=_.constructor=k,k.constructor=A,k[s]=A.displayName="GeneratorFunction",l.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===A||"GeneratorFunction"===(n.displayName||n.name))},l.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(_),t},l.awrap=function(t){return{__await:t}},S(T.prototype),T.prototype[u]=function(){return this},l.AsyncIterator=T,l.async=function(t,n,e,r){var o=new T(b(t,n,e,r));return l.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(_),_[s]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},l.keys=function(t){var n=[];for(var e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},l.values=O,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,o){return u.type="throw",u.arg=t,e.next=r,o&&(e.method="next",e.arg=n),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=n,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),g},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),C(e),g}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var o=r.arg;C(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:O(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),g}}}function b(t,n,e,r){var o=n&&n.prototype instanceof x?n:x,i=Object.create(o.prototype),a=new E(r||[]);return i._invoke=function(t,n,e){var r=f;return function(o,i){if(r===h)throw new Error("Generator is already running");if(r===v){if("throw"===o)throw i;return M()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var u=P(a,e);if(u){if(u===g)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(r===f)throw r=v,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r=h;var s=w(t,n,e);if("normal"===s.type){if(r=e.done?v:d,s.arg===g)continue;return{value:s.arg,done:e.done}}"throw"===s.type&&(r=v,e.method="throw",e.arg=s.arg)}}}(t,e,a),i}function w(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}function x(){}function A(){}function k(){}function S(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function T(n){function e(t,r,i,a){var u=w(n[t],n,r);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,i,a)},function(t){e("throw",t,i,a)}):Promise.resolve(c).then(function(t){s.value=t,i(s)},a)}a(u.arg)}var r;"object"==typeof t.process&&t.process.domain&&(e=t.process.domain.bind(e)),this._invoke=function(t,n){function o(){return new Promise(function(r,o){e(t,n,r,o)})}return r=r?r.then(o,o):o()}}function P(t,e){var r=t.iterator[e.method];if(r===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=n,P(t,e),"throw"===e.method))return g;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=w(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,g;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,g):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function I(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function C(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function O(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(o.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return i.next=i}}return{next:M}}function M(){return{value:n,done:!0}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])}).call(this,e(21))},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){"use strict";var r,o=u(e(13)),i=u(e(35)),a=e(15);function u(t){return t&&t.__esModule?t:{default:t}}e(36),e(37),e(38),e(39),e(40),e(41),(r=Mirador).AnnotationEditor=o.default,r.AnnotationTableOfContents=i.default,r.YaleEndpoint=a.YaleEndpoint},function(t,n,e){"use strict";e.r(n);var r=e(6);n.default={logger:{debug:()=>{},info:()=>{},warning:()=>{},error:()=>{}},setLogger:function(t){this.logger=t},targetIsAnnotationOnCanvas:function(t){return"oa:Annotation"!==t["@type"]},hasTargetOnCanvas:function(t){for(let n of Object(r.default)(t).targets)if(this.targetIsAnnotationOnCanvas(n))return!0;return!1},findAnnotationFromListById(t,n){const e=n.filter(n=>n&&"object"==typeof n?n["@id"]===t:(logger.error("AnnotationUtil#findAnnotationFromListById invalid annotation",n),!1));return e.length>1&&logger.error("AnnotationUtil#findAnnotationFromListById duplicate IDs",e),e[0]},findTransitiveTargetAnnotations:function(t,n){const e=Object(r.default)(t).targets.map(t=>{const e=t.full;return n[e]}).filter(t=>null!=t);if(0===e.length)return[];let o=e;for(let t of e){let e=this.findTransitiveTargetAnnotations(t,n);o=o.concat(e)}return o},findTransitiveTargetingAnnotations:function(t,n){let e=Object(r.default)(t).targetedBy;if(0===(e=e.filter(t=>{const e=n[t["@id"]];return null!=e})).length)return[];let o=e;for(let t of e){let e=this.findTransitiveTargetingAnnotations(t,n);o=o.concat(e)}return o},findTargetAnnotationsOnCanvas:function(t,n){return this.findTransitiveTargetAnnotations(t,n).filter(t=>{for(let n of Object(r.default)(t).targets)if(this.targetIsAnnotationOnCanvas(n))return!0;return!1})},mergeTargetsOld:function(t,n){const e=t.on;let r=e.full;const o=n.full;if(e instanceof Array){const r=e.filter(function(t){return t.full===o});if(1===r.length){const t=r[0];t.selector.value=svgUtil.mergeSvgs(t.selector.value,n.selector.value)}else{if(0!==r.length)throw"multiple targets on same canvas";t.on.push(n)}}else{e.full;r===o?e.selector.value=svgUtil.mergeSvgs(e.selector.value,n.selector.value):t.on=[e,n]}}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=u(e(0)),i=u(e(25)),a=u(e(7));function u(t){return t&&t.__esModule?t:{default:t}}(0,o.default)();var s=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._mirador=n,this._workspaceProxy=null,this._id=e,this._ignoredEvents=new Set}return r(t,[{key:"getId",value:function(){return this._id}},{key:"getWorkspaceProxy",value:function(){return this._workspaceProxy||(this._workspaceProxy=new i.default(this._mirador.viewer.workspace)),this._workspaceProxy}},{key:"getWindowProxies",value:function(){return this.getWorkspaceProxy().getWindowProxies()}},{key:"getWindowProxyById",value:function(t){return new a.default(this.getWindowById(t))}},{key:"getWindowById",value:function(t){return this.getWorkspaceProxy().getWindowById(t)}},{key:"publish",value:function(){var t=this._mirador.eventEmitter,n=Array.from(arguments);t.publish.apply(t,n)}},{key:"subscribe",value:function(t,n){this._mirador.eventEmitter.subscribe(t,n)}},{key:"unsubscribe",value:function(t,n){this._mirador.eventEmitter.unsubscribe(t,n)}},{key:"shouldIgnoreEvent",value:function(t){return this._ignoredEvents.has(t)}},{key:"markEventToBeIgnored",value:function(t){this._ignoredEvents.add(t)}},{key:"unmarkEventToBeIgnored",value:function(t){this._ignoredEvents.delete(t)}}]),t}();n.default=s},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=a(e(0)),i=a(e(7));function a(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=(0,o.default)(),this.workspace=n}return r(t,[{key:"getWorkspace",value:function(){return this.workspace}},{key:"getWindowProxies",value:function(){return this.workspace.windows.map(function(t){return new i.default(t)})}},{key:"getWindowById",value:function(t){var n=this.workspace.windows.filter(function(n){return n.id===t}),e=n.length;return e>1&&this.logger.error("MiradorProxy#getWindowById: more than one ("+e+") found for id: "+t),e>0?n[0]:null}}]),t}();n.default=u},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=a(e(0)),i=a(e(3));function a(t){return t&&t.__esModule?t:{default:t}}var u=(0,o.default)(),s=(0,i.default)(),c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({imageWindowId:null,layerIds:[],toc:null,tocTags:[]},n)}return r(t,[{key:"getWindowsConfig",value:function(){var t=this.options.annotationId,n=this.options.layerIds,e=this.options.tocTags;if(t){var r=this._findAnnotation(t);if(!r)return u.error("LayoutConfigParser#getWindowsConfig cannot find annotation",t),null;n=[r.layerId],this.options.toc&&(e=this.options.toc.getTagsFromAnnotationId(t)).length<1&&u.error("LayoutConfigParser#getWindowsConfig no toc tags for annotation",t)}var o={windows:[]};if(n instanceof Array&&n.length>0){var i=!0,a=!1,s=void 0;try{for(var c,l=n[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var f=c.value;o.windows.push({type:"ANNOTATION_WINDOW",miradorId:this.options.miradorId,imageWindowId:this.options.imageWindowId,layerId:f||null,annotationId:t||null,tocTags:e||[]})}}catch(t){a=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}return o.windows.length>0?o:null}},{key:"_findAnnotation",value:function(t){var n=s.getWindowProxyById(this.options.imageWindowId).getAnnotationsList().filter(function(n){return n["@id"]===t});return n.length>0?n[0]:null}}]),t}();n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=l(e(4)),i=l(e(0)),a=l(e(8)),u=l(e(3)),s=l(e(28)),c=e(34);l(e(7));function l(t){return t&&t.__esModule?t:{default:t}}function f(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var d=(0,i.default)(),h=(0,u.default)(),v=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),d.debug("MiradorWrapper#constructor options:",n),this.options=Object.assign({grid:null,miradorOptions:null},n),this._miradorId=n.miradorOptions.miradorId,this._miradorConfig=this._buildMiradorConfig(n.miradorOptions),d.debug("MiradorWrapper#constructor miradorConfig:",this._miradorConfig),this._mirador=Mirador(this._miradorConfig),this._miradorProxy=this._addToMiradorProxy(this._miradorId,this._mirador),this._bindEvents(n.miradorOptions)}return r(t,[{key:"getMirador",value:function(){return this._mirador}},{key:"getMiradorProxy",value:function(){return this._miradorProxy}},{key:"getConfig",value:function(){return this._miradorConfig}},{key:"_buildMiradorConfig",value:function(t){return new s.default(t).buildConfig()}},{key:"_addToMiradorProxy",value:function(t,n){var e=h.addMirador(t,n);return e.subscribe("OPEN_ANNOTATION_SELECTOR",function(t,n,e){(0,c.openAnnotationSelector)(n).then(function(t){e.loadAnnotation(t)})}),e}},{key:"zoomToTags",value:function(){var t=f(regeneratorRuntime.mark(function t(n,e,r){var i,a,u,s,c,l,f,h=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d.debug("MiradorWrapper#zoomToTags windowId:",n,"canvasId:",e,"tags:",r),i=(0,o.default)().getAnnotationTocCache(),t.next=4,i.getToc(e);case 4:return a=t.sent,u=this._miradorProxy.getWindowProxyById(n),s=u.getImageView(),c=a.getNodeFromTags(r),d.debug("tocNode:",c),l=c.canvasAnnotations[0],f=function(t){s.zoomToAnnotation(l),s.panToAnnotation(l),u.getDrawTool().updateHighlights(l)},t.abrupt("return",new Promise(function(t,r){e===u.getCurrentCanvasId()?(f(),t()):(h._miradorProxy.subscribe("annotationsRendered."+n,function e(r){d.debug("MiradorWrapper#zoomToTags:SUB:annotationsRendered"),f(),h._miradorProxy.unsubscribe("annotationsRendered."+n,e),t()}),u.setCurrentCanvasId(e))}));case 12:case"end":return t.stop()}},t,this)}));return function(n,e,r){return t.apply(this,arguments)}}()},{key:"_bindEvents",value:function(t){var n=this;d.debug("MiradorWrapper#_bindEvents options:",t);var e,r=h.getMiradorProxy(this._miradorId);r.subscribe("YM_CLICKED_OPEN_ANNO_WINDOW",(e=f(regeneratorRuntime.mark(function t(e,o){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d.debug("MiradorWrappe:SUB:YM_CLICKED_OPEN_ANNO_WINDOW imageWindowId:",o),t.next=3,(0,a.default)().show("Opening an annotation window...");case 3:return r.publish("YM_DISPLAY_ON"),t.next=6,n.options.grid.addAnnotationWindow({miradorId:n._miradorId,imageWindowId:o});case 6:t.sent,(0,a.default)().hide();case 8:case"end":return t.stop()}},t,n)})),function(t,n){return e.apply(this,arguments)})),jQuery.subscribe("ANNOWIN_ANNOTATION_FOCUSED",function(t,e){d.debug("MiradorWrapper:SUB:ANNOWIN_ANNOTATION_FOCUSED, params:",e);var r=h.getMiradorProxy(n._miradorId).getWindowProxyById(e.imageWindowId).getSidePanelTabContentElement("ym-annotation-toc").data("AnnotationTableOfContent");r&&r.scrollToTags(e.annotation.tocTags)})}}]),t}();n.default=v},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=c(e(11)),i=c(e(0)),a=c(e(2)),u=c(e(32)),s=c(e(5));function c(t){return t&&t.__esModule?t:{default:t}}var l=(0,i.default)(),f=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),l.debug("MiradorConfigBuilder#constructor options:",n),this._options=n,this._state=(0,a.default)();var e=this._state.getSetting("initialLayout","windows")[0];this._manifestUri=e.manifest,this._canvasId=e.canvas}return r(t,[{key:"buildConfig",value:function(){var t=jQuery.extend(!0,{},this._options.defaultSettings),n=this._state.getSetting("annotations","tocSpec");jQuery.extend(t,{id:this._options.miradorId,buildPath:this._options.mirador.buildPath||"/",i18nPath:"/locales/",imagesPath:"/images/",logosPath:"/images/logos/",mainMenuSettings:{show:!1},data:[{manifestUri:this._manifestUri}],windowObjects:[this.windowObject()],autoHideControls:!1,annotationEndpoint:this.endPointConfig(),annotationBodyEditor:{module:"AnnotationEditor",options:{miradorDriven:!0,mode:"create"}},i18nAdditions:(new u.default).getLocalesConfig(this._options)});var e=t.windowSettings;e.displayLayout=!1,n&&(e.sidePanelOptions.annotationTocTabAvailable=!0,e.sidePanelOptions.tocTabAvailable=!1),s.default.isEditor()||(e.canvasControls.annotations.annotationCreation=!1),this._state.getSetting("mirador","annotationsOverlay","showByDefault")&&(e.canvasControls.annotations.annotationState="on"),e.externalAnnotationWindowButton=this._options.mirador.externalAnnotationWindowButton;var r=this._state.getSetting("mirador","annotationsOverlay","hoverColor"),o=this._state.getSetting("mirador","annotationsOverlay","hoverWidthFactor");return r&&(t.drawingToolsSettings.hoverColor=r),o&&(t.drawingToolsSettings.hoverWidthFactor=o),l.debug("MiradorConfigBuilder#buildConfig config:",t),t}},{key:"windowObject",value:function(){var t={loadedManifest:this._manifestUri,bottomPanelVisible:!1};return this._canvasId&&(t.canvasID=this._canvasId),t}},{key:"endPointConfig",value:function(){return{name:"Yale Annotations",module:"YaleEndpoint",dataSource:o.default,options:{prefix:this._options.endpointUrl}}}}]),t}();n.default=f},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=(e(1),i(e(0)));i(e(3));function i(t){return t&&t.__esModule?t:{default:t}}var a=(0,o.default)(),u=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._valid=!1}return r(t,[{key:"init",value:function(){var t=this;return a.debug("AnnotationCacheINdexeddb#_init"),this._db=new Dexie(this._dbName),this._db.version(1).stores({layers:"id,jsonData,timestamp",annosPerCanvas:"canvasId,jsonData,timestamp"}),this._db.open().catch(function(n){t._valid=!1,a.error("AnnotationCache#setupIndexDb open failed:",n)})}},{key:"isValid",value:function(){return this._valid}},{key:"deleteDb",value:function(){return a.debug("AnnotationCache#deleteDb"),Dexie.delete(this._dbName)}},{key:"getLayers",value:function(){return a.debug("AnnotationCache#getLayers"),this._db.layers.where("id").equals(1).first(function(t){var n=void 0!==t?t.jsonData:null;return n instanceof Array?n:[]})}},{key:"setLayers",value:function(t){a.debug("AnnotationCache#setLayers",t);var n=this;return this._emptyTable("layers").then(function(){return n._db.layers.add({id:1,jsonData:t}).catch(function(t){throw a.error("AnnotatinCache#setLayers update failed: "+t),t})})}},{key:"getAnnotationsPerCanvas",value:function(t){a.debug("AnnotationCache#getAnnotationsPerCanvas",t);var n=this;return this._db.annosPerCanvas.where("canvasId").equals(t).and(function(t){var e=(new Date).valueOf();return a.debug("AnnotationCache#getAnnotationsPerCanvas expiration test: "+(e<t.timestamp+n._expiresInMS)),e<t.timestamp+n._expiresInMS}).first(function(t){return t?t.jsonData:null})}},{key:"setAnnotationsPerCanvas",value:function(t,n){var e=this;a.debug("AnnotationCache#setAnnotationsPerCanvas canvas:",t,"data:",n);var r=this._db.annosPerCanvas,o=(this._db.annosPerCanvas.where("canvasId").equals(t),{canvasId:t,jsonData:n,timestamp:(new Date).valueOf()});return r.put(o).catch(function(t){a.error("AnnotationCache#setAnnotationsPerCanvas put failed for",o,": "+t),e._valid=!1})}},{key:"invalidateAllCanvases",value:function(){return a.debug("AnnotationCache#invalidateAllCanvases"),this._emptyTable("annosPerCanvas")}},{key:"invalidateCanvasId",value:function(t){return a.debug("AnnotationCache#invalidateCanvasId canvasId:",t),this._deleteAnnotationsPerCanvas(t)}},{key:"_emptyTable",value:function(t){a.debug("AnnotationCache#emptyTable",t);var n=this._db.table(t);return this._db.transaction("rw",n,function(){n.each(function(e,r){a.debug("AnnotationCache#emptyTable deleting",r.key),n.delete(r.key).catch(function(n){a.error("AnnotationCache#emptyTable deleting from table "+t+": "+n)})})})}},{key:"_deleteAnnotationsPerCanvas",value:function(t){a.debug("AnnotationCache#deleteAnnotationsPerCanvas canvasId:",t);return this._db.annosPerCanvas.where("canvasId").equals(t).delete().catch(function(n){a.error("AnnotationCache#deleteAnnotationsPerCanvas failed to delete canvasId: "+t)})}}]),t}();n.default=u},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);var a=(0,((r=i)&&r.__esModule?r:{default:r}).default)(),u=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._cache={annosPerCanvas:{}},this._queues={annosPerCanvas:[]},this._maxCanvases=5}return o(t,[{key:"getAnnotationsPerCanvas",value:function(t){return a.debug("AnnotationCacheInMemory#getAnnotationsPerCanvas",t),this._logState("get"),this._cache.annosPerCanvas[t]||null}},{key:"setAnnotationsPerCanvas",value:function(t,n){a.debug("AnnotationCacheInMemory#setAnnotationsPerCanvas canvasId:",t,"annotations:",n);var e=this._cache.annosPerCanvas,r=this._queues.annosPerCanvas;if(this._logState("set before"),!e[t]){if(e[t]=n,r.push(t),r.length>this._maxCanvases)delete e[r.shift()];this._logState("set after")}}},{key:"invalidateAllCanvases",value:function(){a.debug("AnnotationCacheInMemory#invalidateAllCanvases"),this._cache.annosPerCanvas={},this._queues.annosPerCanvas=[]}},{key:"invalidateCanvasId",value:function(t){a.debug("AnnotationCacheInMemory#invalidateCanvasId canvasId:",t);var n=this._queues.annosPerCanvas;delete this._cache.annosPerCanvas[t],n.splice(n.indexOf(t),1)}},{key:"_logState",value:function(t){a.debug("Mem cache "+t),a.debug("cache:",this._cache),a.debug("queues:",this._queues)}}]),t}();n.default=u},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){if(!f){var t="ym_error_dialog",n=jQuery("#"+t);0===n.length&&(n=jQuery("<div/>").attr("id",t).addClass("ui modal ym_modal").appendTo(jQuery("body"))),f=new l(n)}return f};var o,i=e(8),a=(o=i)&&o.__esModule?o:{default:o};var u=Handlebars.compile(["<p>{{message}} ({{code}})<p>","{{#if tryAgain}}","  <p>Please try again by reloading the page. If problem persists, contact the site administrator.</p>","{{/if}}"].join("")),s=Handlebars.compile(['<div class="header">Error</div>','<div class="content">','  <div class="description">',"    {{{message}}}","  </div>","</div>",'<div class="actions">','  <div class="ui cancel button">Dismiss</div>',"</div>"].join("")),c="<p>Please try again by reloading the page, or if problem persists, contact the site administrator.</p>",l=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.elem=n,n.modal({onHidden:function(){n.modal("hide dimmer")}}),this.messageMap={layers:"<p>Sorry, there was a problem retrieving the annotation layers.</p>"+c,annotations:"<p>Sorry, there was a problem retrieving the annotations.</p>"+c,anno_read:"<p>Failed to retrieve annotations</p>",authz_read:"<p>Failed to retrieve annotations: user doesn't have permission to read",authz_create:"<p>Sorry, you are not authorized to create annotations.</p>",authz_update:"<p>Sorry, you are not authorized to update data.</p>",authz_delete:"<p>Sorry, you are not authorized to delete data.</p>"},this._alert=e||(0,a.default)()}return r(t,[{key:"show",value:function(t,n,e){this._alert.hide(),console.log("yyy code:",t,n,e);var r=u({code:t,message:n,tryAgain:e});console.log("yyy msg:",r),this.elem.html(s({message:r})),this.elem.modal("show")}},{key:"hide",value:function(){this.elem.modal("hide")}}]),t}(),f=null},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),u=e(33),s=(r=u)&&r.__esModule?r:{default:r};var c=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}return a(t,[{key:"getLocalesConfig",value:function(t){var n=s.default,e=t.ui.i18nOverrides;if("object"===(void 0===e?"undefined":i(e))){var r=!0,a=!1,u=void 0;try{for(var c,l=Object.entries(e)[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var f=o(c.value,2),d=f[0],h=f[1];n[d]||(n[d]={});var v=!0,g=!1,p=void 0;try{for(var y,m=Object.entries(h)[Symbol.iterator]();!(v=(y=m.next()).done);v=!0){var _=o(y.value,2),b=_[0],w=_[1];n[d][b]=w}}catch(t){g=!0,p=t}finally{try{!v&&m.return&&m.return()}finally{if(g)throw p}}}}catch(t){a=!0,u=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw u}}}return n}}]),t}();n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={en:{nextCanvas:"Next Canvas",previousCanvas:"Previous Canvas",showBottomPanel:"Show Canvas List",hideBottomPanel:"Hide Canvas List"},ko:{nextCanvas:"다음 캔버스",previousCanvas:"이전 캔버스",showBottomPanel:"캔버스 리스트",hideBottomPanel:"캔버스 리스트 감추기"}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.openAnnotationSelector=void 0;var r,o,i=(r=regeneratorRuntime.mark(function t(n){var e,r,o,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,c.default)().getWindowProxyById(n),(r=e.getSvgOverlay()).removeMouseTool(),e.getEndPoint(),o=(0,u.default)().getAnnotationSource(),i=new a.AnnotationExplorer({dataSource:o}),t.next=8,i.getLayers();case 8:return s=t.sent,t.abrupt("return",new Promise(function(t,n){new a.AnnotationExplorerDialog({appendTo:jQuery("body"),annotationExplorer:i,canvases:e.getCanvases(),defaultCanvasId:e.getCurrentCanvasId(),layers:s,onSelect:function(n){t(n)},logger:f}).open()}).then(function(t){return r.setMouseTool(),t}).catch(function(t){r.setMouseTool(),f.error("openAnnotationExplorer returned with error",t)}));case 10:case"end":return t.stop()}},t,this)}),o=function(){var t=r.apply(this,arguments);return new Promise(function(n,e){return function r(o,i){try{var a=t[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});n(u)}("next")})},function(t){return o.apply(this,arguments)}),a=e(1),u=(l(e(11)),l(e(4))),s=l(e(0)),c=l(e(3));function l(t){return t&&t.__esModule?t:{default:t}}var f=(0,s.default)();n.openAnnotationSelector=i},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=a(e(0)),i=a(e(2));function a(t){return t&&t.__esModule?t:{default:t}}var u=(0,o.default)(),s=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({element:null,appendTo:null,windowId:null,structures:[],manifestVersion:null,previousSelectedElements:[],selectedElements:[],previousOpenElements:[],openElements:[],hoveredElement:[],selectContext:null,tocData:{},active:null,eventEmitter:null},n),this.init()}return r(t,[{key:"init",value:function(){var t=this,n=(0,i.default)().getSetting("annotations","tocSpec");if(n){this.element=jQuery(c()).appendTo(this.options.appendTo);for(var e=n.generator[0],r=0;r<e.max;++r){var o=this._createItem(r,n);this.element.append(o)}}else this.element=jQuery(l()).appendTo(this.options.appendTo);this._selectedElem=null,this.element.data("AnnotationTableOfContent",this),this.element.mousemove(function(t){t.stopPropagation()}),this.element.mouseenter(function(n){t._unselect()})}},{key:"scrollToTags",value:function(t){u.debug("AnnotationTableOfContents#scrollToTags tags:",t);var n="."+t[0],e=this.element.find(n);this._select(e),this.element.scrollTo(e,500)}},{key:"_select",value:function(t){this._unselect(),this._selectedElem=t,t.addClass("selected")}},{key:"_unselect",value:function(){this._selectedElem&&this._selectedElem.removeClass("selected")}},{key:"_createItem",value:function(t,n){var e=this,r=n.generator[0],o=r.tag.prefix+(t+1),i=jQuery(f({tag:o,content:r.descriptions[t]})),a=n.canvasMap[o];return i.click(function(t){var n=e.options.windowId;e._savedScrollTop=e.element.scrollTop(),t.preventDefault(),jQuery(this).focus(),jQuery.publish("YM_ANNOTATION_TOC_TAGS_SELECTED",[n,a[0],[o]]),setTimeout(function(){e.element.scrollTo(e._savedScrollTop)},0)}),i}}]),t}();n.default=s;var c=Handlebars.compile(['<div class="ym-annotation-toc">',"<h1>Table of Contents</h1>","</div>"].join("")),l=Handlebars.compile(['<div class="ym-annotation-toc">',"Table of contents is empty","</div>"].join("")),f=Handlebars.compile(['<div class="ym-annotation-toc-item {{tag}}" tabindex="-1">','<a href="#">{{{content}}}</a>',"</div>"].join(""))},function(t,n,e){"use strict";var r,o,i,a=e(0),u=(r=a)&&r.__esModule?r:{default:r};o=Mirador,i=Handlebars.compile(['<div class="header"></div>','<div class="content">','  <div class="description">',"    <p>{{message}}</p>","  </div>","</div>",'<div class="actions">','  <div class="ui ok button">{{yesLabel}}</div>','  <div class="ui cancel button">{{noLabel}}</div>',"</div>"].join("")),o.DialogBuilder=function(t){this.logger=(0,u.default)();var n="ym_dialog",e=jQuery("#"+n);0===e.length&&(e=jQuery("<div/>").attr("id",n).addClass("ui modal ym_modal").appendTo(jQuery("body"))),this.elem=e},o.DialogBuilder.prototype={confirm:function(t,n){n(window.confirm(t))},dialog:function(t){this.logger.debug("DialogBuilder#dialog opts:",t);var n=t.buttons.yes,e=t.buttons.no;this.elem.html(i({message:t.message,yesLabel:n.label,noLabel:e.label})),this.elem.modal({onApprove:function(t){"function"==typeof n.callback&&n.callback()},onDeny:function(t){"function"==typeof e.callback&&e.callback()}}),this.elem.modal("show")}}},function(t,n,e){"use strict";e(1);var r=i(e(0)),o=i(e(2));i(e(9));function i(t){return t&&t.__esModule?t:{default:t}}!function(t){t.yaleExt=t.yaleExt||{};var n=(0,r.default)();jQuery.extend(t.yaleExt,{getCombinedBounds:function(t){n.debug("yaleExt.getCombinedBounds shapes:",t);var e=null;return jQuery.each(t,function(t,r){e=e?e.unite(r.strokeBounds):r.strokeBounds,n.debug("index: "+t+", bounds: "+e)}),e},updateTooltipStyles:function(){var t=jQuery(".qtip-default, .qtip-content"),n=(0,o.default)().getSetting("mirador","tooltipStyles");n&&(t.css("color",n.color),t.css("background-color",n.backgroundColor),t.css("border",n.border))},truncate:function(t,n){var e=t.replace(/<(?:.|\n)*?>/gm,"");return(e=e.replace(/&.*?;/gm,"")).length>n?e.slice(0,n-3)+"...":e}})}(Mirador)},function(t,n,e){"use strict";var r,o=e(0),i=(r=o)&&r.__esModule?r:{default:r};!function(t){(0,i.default)();t.Hud.prototype.qtipExtra=function(t){this.element.find(".mirador-osd-previous").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"bottom left",at:"top left"},style:{classes:"qtip-dark qtip-shadow qtip-rounded",tip:!1}})}),this.element.find(".mirador-osd-next").each(function(){jQuery(this).qtip({content:{text:jQuery(this).attr("title")},position:{my:"bottom right",at:"top right"},style:{classes:"qtip-dark qtip-shadow qtip-rounded",tip:!1}})})},t.Hud.prototype.toggleBottomPanelQtip=function(t){var n=t?i18next.t("hideBottomPanel"):i18next.t("showBottomPanel"),e=this.element.find(".mirador-osd-toggle-bottom-panel");this._bottomPanelQtipInitialized?e.qtip("option","content.text",n):(e.each(function(){jQuery(this).qtip({content:{text:n},position:{my:"bottom center",at:"top center",adjust:{method:"shift",y:10}},style:{classes:"qtip-dark qtip-shadow qtip-rounded"}})}),this._bottomPanelQtipInitialized=!0)}}(Mirador)},function(t,n,e){"use strict";var r=e(1),o=a(e(0)),i=a(e(3));function a(t){return t&&t.__esModule?t:{default:t}}!function(t){t.yaleExt=t.yaleExt||{};var n=(0,o.default)();t.ImageView.prototype.enableAnnotationLayer=function(){this.annotationState="on"},t.ImageView.prototype.zoomToAnnotation=function(e){n.debug("ImageView(ext)#zoomToAnnotation annotation:",e);var r=void 0,o=void 0,i=void 0,a=void 0;try{var u=this.osd.viewport;r=u.getZoom(),o=this.annotationsLayer.drawTool.getShapesForAnnotation(e),i=t.yaleExt.getCombinedBounds(o);var s=u.imageToViewportCoordinates(i.width,i.height),c=u.getBounds(),l=s.x/c.width,f=s.y/c.height;if("number"!=typeof(a=1/Math.max(l,f)*.75)||isNaN(a)){var d="ImageView(ext)#zoomToAnnotation invalid zoomFactor "+a;throw n.error(d,e),d}u.zoomBy(a)}catch(t){n.error("ImageView(ext)#zoomToAnnotation failed for annotation",e,"-",t),n.error("oldZoom:",r,"shapes:",o,"shapeBounds:",i,"zoomFactor:",a)}},t.ImageView.prototype.panToAnnotation=function(e){n.debug("ImageView(ext)#panToAnnotation anno:",e);var r=this.osd.viewport,o=this.annotationsLayer.drawTool.getShapesForAnnotation(e),i=t.yaleExt.getCombinedBounds(o),a=i.x+i.width/2,u=i.y+i.height/2,s=(new OpenSeadragon.Point(a,u),r.imageToViewportCoordinates(i.x,i.y)),c=r.imageToViewportCoordinates(i.width,i.height),l=s.x,f=s.x+c.x,d=s.y,h=s.y+c.y,v=r.getBounds(),g=(r.getHomeBounds().height,v.x),p=v.x+v.width,y=v.y,m=v.y+v.height,_=.08/r.getZoom(),b=0,w=0;if(f+_>p?l-_<g?b=l-_-g:l-(b=f+_-p)-_<g&&(b-=g-(l-b-_)):l-_<g&&(b=l-_-g),h+_>m?d-_<y?w=d-_-y:d-(w=h+_-m)-_<y&&(w-=y-(d-w-_)):d-_<y&&(w=d-_-y),"number"!=typeof b||isNaN(b)||"number"!=typeof w||isNaN(w)){var x="ImageView(ext)#panToAnnotation invalid value(s) panX: "+b+", panY: "+w;throw n.error(x,e),x}r.panBy(new OpenSeadragon.Point(b,w))};var e=t.ImageView.prototype.listenForActions;t.ImageView.prototype.listenForActions=function(){var t=this;e.call(this),this.eventEmitter.subscribe("ANNOTATIONS_LIST_UPDATED",function(e){n.debug("ImageView(ext):SUB:ANNOTATIONS_LIST_UPDATED window:",t.windowId,"annotationToBeFocused:",t._annotationToBeFocused),t._annotationToBeFocused&&setTimeout(function(){var e=(0,i.default)().getWindowProxyById(t.windowId),o=t._annotationToBeFocused;if(!r.annoUtil.hasTargetOnCanvas(o)){var a={},u=!0,s=!1,c=void 0;try{for(var l,f=e.getAnnotationsList()[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var d=l.value;a[d["@id"]]=d}}catch(t){s=!0,c=t}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}o=r.annoUtil.findTransitiveTargetAnnotations(o,a).filter(function(t){var n=!0,o=!1,i=void 0;try{for(var a,u=(0,r.Anno)(t).targets[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){if(a.value.full===e.getCurrentCanvasId())return!0}}catch(t){o=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return!1})[0]}t._annotationToBeFocused=null,o?(t.zoomToAnnotation(o),t.panToAnnotation(o),t.annotationsLayer.drawTool.updateHighlights(o)):n.error("ImageWindow(ext):SUB:ANNOTATIONS_LIST_UPDATED annotation not found")},500)}),this.eventEmitter.subscribe("YM_DISPLAY_ON",function(e){n.debug("ExtImageView:SUB:YM_DISPLAY_ON"),"off"===t.hud.annoState.current&&t.hud.annoState.displayOn(t.element.find(".mirador-osd-annotations-layer"))})}}(Mirador)},function(t,n,e){"use strict";var r=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=a(e(0)),i=a(e(2));function a(t){return t&&t.__esModule?t:{default:t}}!function(t){var n=(0,o.default)(),e="",a=1,u=1;function s(t){var n=t.canvases,e=!0,r=!1,o=void 0;try{for(var i,a=n[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){c(i.value)}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}}function c(t){var n=t.images;t.width=a,t.height=u;var e=!0,r=!1,o=void 0;try{for(var i,s=n[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){l(i.value)}}catch(t){r=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw o}}}function l(t){var n=t.resource;n["@id"]=e+"/full/"+a+","+u+"/0/default.jpg",n.service["@id"]=e,n.width=String(a),n.height=String(u)}t.Manifest.prototype.processCopyright=function(t){if(n.debug("Manifest#processCopyright jsonLd in:",t),(0,i.default)().getSetting("auth","images","copyrighted")){e=(0,i.default)().getSetting("auth","images","altImageService");var o=function(t){var n=0,e=0,r=!0,o=!1,i=void 0;try{for(var a,u=t.sequences[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value,c=!0,l=!1,f=void 0;try{for(var d,h=s.canvases[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var v=d.value;v.width>n&&(n=v.width),v.height>e&&(e=v.height)}}catch(t){l=!0,f=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}var g=Math.min(Math.max(n,e),4096);return[g,g]}(t),c=r(o,2);a=c[0],u=c[1];var l=t.sequences,f=!0,d=!1,h=void 0;try{for(var v,g=l[Symbol.iterator]();!(f=(v=g.next()).done);f=!0){s(v.value)}}catch(t){d=!0,h=t}finally{try{!f&&g.return&&g.return()}finally{if(d)throw h}}}return n.debug("Manifest#processCopyright jsonLd out:",t),t}}(Mirador)},function(t,n,e){"use strict";var r,o,i=u(e(0)),a=u(e(2));function u(t){return t&&t.__esModule?t:{default:t}}r=Mirador,o=(0,i.default)(),r.OsdRegionDrawTool.prototype.getShapesForAnnotation=function(t){o.debug("OsdRegionDrawTool(ext)#getShapesForAnnotation this.annotationsToShapesMap:",this.annotationsToShapesMap);var n=[];return jQuery.each(this.annotationsToShapesMap,function(e,r){e===t["@id"]&&jQuery.each(r,function(t,e){n.push(e)})}),n},r.OsdRegionDrawTool.prototype.saveStrokeColor=function(t){t.data._ym_defaultStrokeColor||(t.data._ym_defaultStrokeColor=t.strokeColor)},r.OsdRegionDrawTool.prototype.saveStrokeWidth=function(t){t.data._ym_defaultStrokeWidth||(t.data._ym_defaultStrokeWidth=t.data.strokeWidth)},r.OsdRegionDrawTool.prototype.getDefaultStrokeWidth=function(t){return"number"==typeof t.data._ym_defaultStrokeWidth?t.data._ym_defaultStrokeWidth:t.data.strokeWidth},r.OsdRegionDrawTool.prototype.updateHighlights=function(t){o.debug("OsdRegionDrawTool(ext)#updateHighlights annotation:",t);var n=this;jQuery.each(this.annotationsToShapesMap,function(e,r){jQuery.each(r,function(e,r){r.data.annotation["@id"]===t["@id"]?(n.highlightShape(r),r.bringToFront()):(n.deHighlightShape(r),r.sendToBack())})}),this.osdViewer.forceRedraw()},r.OsdRegionDrawTool.prototype.updateShapesVisibility=function(t){var n=!0,e=!1,r=void 0;try{for(var o,i=Object.values(this.annotationsToShapesMap)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var u=o.value,s=!0,c=!1,l=void 0;try{for(var f,d=u[Symbol.iterator]();!(s=(f=d.next()).done);s=!0){var h=f.value,v=!0,g=!1,p=void 0;try{for(var y,m=t[Symbol.iterator]();!(v=(y=m.next()).done);v=!0){var _=y.value;if(h.data.annotation["@id"]===_["@id"])h.bringToFront(),h.opacity=1;else{h.sendToBack();var b=(0,a.default)().getSetting("mirador","annotationsOverlay","hideUnfocused");h.opacity=b?0:1}}}catch(t){g=!0,p=t}finally{try{!v&&m.return&&m.return()}finally{if(g)throw p}}}}catch(t){c=!0,l=t}finally{try{!s&&d.return&&d.return()}finally{if(c)throw l}}}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}},r.OsdRegionDrawTool.prototype.highlightShape=function(t){this.saveStrokeColor(t),this.saveStrokeWidth(t);var n=(0,a.default)(),e=n.getSetting("mirador","annotationsOverlay","hoverColor"),r=n.getSetting("mirador","annotationsOverlay","hoverWidthFactor");if(e&&(t.strokeColor=e),r){var o=t.data._ym_defaultStrokeWidth;t.data.strokeWidth=r*("number"==typeof o?o:t.data.strokeWidth)}t.set({opacity:1})},r.OsdRegionDrawTool.prototype.deHighlightShape=function(t){t.data._ym_defaultStrokeColor&&(t.strokeColor=t.data._ym_defaultStrokeColor),t._ym_defaultStrokeWidth&&(t.data.strokeWidth=t._ym_defaultStrokeWidth);var n=(0,a.default)().getSetting("mirador","annotationsOverlay","hideUnfocused");t.opacity=n?0:1}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(1),a=e(18),u=(r=a)&&r.__esModule?r:{default:r};var s=null,c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=jQuery.extend({dataSource:null,tocSpec:null,logger:{debug:function(){return null},info:function(){return null},error:function(){return null}}},n),(s=this.options.logger).debug("AnnotationExplorer#constructor options:",n),this.AnnotationToc=null}return o(t,[{key:"getLayers",value:function(){return this.options.dataSource.getLayers()}},{key:"getAnnotations",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.canvasId){t.next=4;break}throw e="AnnotationExplorer#getAnnotations missing options.canvasId",s.error(e),{code:0,message:e};case 4:return t.next=6,this.options.dataSource.getAnnotations(n).catch(function(t){throw{code:t.code,message:"ERROR AnnotationExplorer#getAnnotations dataSource.getAnnotations failed: \n"+t.message}});case 6:return r=t.sent,this._generateInverseTargets(r),t.abrupt("return",r);case 9:case"end":return t.stop()}},t,this)}),function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})});return function(t){return n.apply(this,arguments)}}()},{key:"createAnnotation",value:function(t){return this.options.dataSource.createAnnotation(t)}},{key:"updateAnnotation",value:function(t){return this.options.dataSource.updateAnnotation(t)}},{key:"deleteAnnotation",value:function(t){return this.options.dataSource.deleteAnnotation(t)}},{key:"updateAnnotationListOrder",value:function(t,n,e){return s.debug("AnnotationExplorer#updateAnnotationListOrder"),this.options.dataSource.updateAnnotationListOrder(t,n,e)}},{key:"getAnnotationToc",value:function(){return this.annotationToc}},{key:"reloadAnnotationToc",value:function(t,n){this.annotationToc=new u.default(t,n),s.debug("AnnotationExplorer#reloadAnnotationToc toc:",this.annotationToc.annoHierarchy)}},{key:"_generateInverseTargets",value:function(t){var n={},e=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(e=(a=u.next()).done);e=!0){var s=a.value;n[s["@id"]]=(0,i.Anno)(s)}}catch(t){r=!0,o=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw o}}var c=!0,l=!1,f=void 0;try{for(var d,h=t[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var v=d.value,g=!0,p=!1,y=void 0;try{for(var m,_=(0,i.Anno)(v).targets[Symbol.iterator]();!(g=(m=_.next()).done);g=!0){var b=m.value.full;n[b]&&n[b].addInverseTarget(v)}}catch(t){p=!0,y=t}finally{try{!g&&_.return&&_.return()}finally{if(p)throw y}}}}catch(t){l=!0,f=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}}}]),t}();n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=i(e(18));function i(t){return t&&t.__esModule?t:{default:t}}function a(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var u=(0,i(e(0)).default)(),s=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({tocSpec:null,annotationExplorer:null},n),this._cache={}}return r(t,[{key:"getToc",value:function(){var t=a(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u.debug("AnnotationTocCache#getToc canvasId:",n),this._cache[n]){t.next=7;break}return t.next=4,this.createToc(n);case 4:this._cache[n]=t.sent,t.next=8;break;case 7:u.debug("AnnotationTocCache#getToc hit cache",n);case 8:return u.debug("AnnotationTocCache getToc toc:",this._cache[n]),t.abrupt("return",this._cache[n]);case 10:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"createToc",value:function(){var t=a(regeneratorRuntime.mark(function t(n){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.options.annotationExplorer.getAnnotations({canvasId:n});case 2:return e=t.sent,r=new o.default(this.options.tocSpec,e,{logger:u}),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"invalidate",value:function(t){delete this._cache[t]}}]),t}();n.default=s},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();n.default=function(){u||(u=new s);return u};var o,i=e(0),a=(o=i)&&o.__esModule?o:{default:o};var u=null,s=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.logger=(0,a.default)()}return r(t,[{key:"fetchSettingsFromHtml",value:function(t){var n={},e=t.attr("data-toc-tags")||"",r=t.attr("data-layer-ids")||"";return n.apiUrl=t.attr("data-settings-url"),n.roomId=t.attr("data-room-id"),n.manifestUri=t.attr("data-manifest-url"),n.projectId=t.attr("data-room-id"),n.canvasId=t.attr("data-canvas-id")||"",n.tocTags=e?e.split(","):[],n.layerIds=r?r.split(","):[],n.annotationId=t.attr("data-annotation-id")||null,n}},{key:"fetchSettingsFromApi",value:function(t,n){var e=t+"?room_id="+n;return this.logger.debug("ConfigFetcher#fetchSettingsFromApi url:",e),new Promise(function(t,n){jQuery.Deferred();jQuery.ajax({url:e,success:function(n){t(n)},error:function(){n("Failed to fetch server settings from "+e)}})})}}]),t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=l(e(4)),i=l(e(0)),a=l(e(3)),u=l(e(8)),s=l(e(2)),c=l(e(46));function l(t){return t&&t.__esModule?t:{default:t}}var f=(0,i.default)(),d=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.init(n)}return r(t,[{key:"init",value:function(t){f.debug("Grid#init"),this.element=jQuery("#"+t),this._state=(0,s.default)(),this.miradorProxyManager=(0,a.default)(),this._annotationExplorer=(0,o.default)().getAnnotationExplorer(),this._annotationWindows={},this.initLayout(),this.bindEvents()}},{key:"initLayout",value:function(){var t=this;f.debug("Grid#initLayout");this._layout=new GoldenLayout({settings:{hasHeaders:!0,showPopoutIcon:!1,selectionEnabled:!1},dimensions:{minItemWidth:200,minItemHeight:200},content:[{type:"row",isClosable:!1,content:[]}]},this.element),this._layout.registerComponent("Mirador",function(t,n){f.debug("Registering component container:",t,"componentState:",n);var e=jQuery("<div/>").attr("id",n.miradorId);t.getElement().append(e)}),this._layout.registerComponent("Annotations",function(t,n){var e=n.windowId,r=jQuery("<div/>").attr("id",e)[0];t.getElement().html(r.outerHTML)}),this._layout.on("stateChanged",function(n){f.debug("GoldenLayout stateChanged event:",n);var e=!0,r=!1,o=void 0;try{for(var i,a=t.miradorProxyManager.getMiradorProxies()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.publish("resizeMirador")}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}return!0}),this._layout.on("itemDestroyed",function(n){if(f.debug("GoldenLayout itemDestroyed item:",n),"Annotations"==n.componentName){var e=n.config.componentState.windowId;f.debug("Annotation window destroyed:",e),t._annotationWindows[e].destroy(),delete t._annotationWindows[e],t._resizeWindows()}}),this._layout.init()}},{key:"resize",value:function(){f.debug("Grid#resize"),this.element.css("bottom",0),this._layout.updateSize()}},{key:"addMiradorWindow",value:function(t){f.debug("Grid#addMiradorWindow miradorId:",t);var n={type:"component",componentName:"Mirador",componentState:{miradorId:t},isClosable:!1};this._layout.root.contentItems[0].addChild(n)}},{key:"addAnnotationWindows",value:function(t){f.debug("Grid#addAnnotationWindows config:",t);var n=!0,e=!1,r=void 0;try{for(var o,i=t.windows[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value;this.addAnnotationWindow(a)}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}}},{key:"addAnnotationWindow",value:function(){var t,n=(t=regeneratorRuntime.mark(function t(n){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.debug("Grid#addAnnotationWindow options:",n),t.next=3,(0,u.default)().show("Opening an annotation window...");case 3:return e=Mirador.genUUID(),r=n.imageWindowId||null,i={id:e,type:"component",componentName:"Annotations",componentState:{windowId:e}},this._layout.root.contentItems[0].addChild(i),a=(0,o.default)().getAnnotationExplorer(),s=new c.default({id:e,appendTo:jQuery("#"+e),explorer:a,miradorId:n.miradorId||null,canvasWindowId:r,initialLayerId:n.layerId||this._pickLayer(),initialTocTags:n.tocTags||[],annotationId:n.annotationId||null,appState:this._state}),t.next=11,s.init().catch(function(t){f.error("Grid#addAnnotationWindow annoWin.init failed:",t)});case 11:return this._annotationWindows[e]=s,this._resizeWindows(),(0,u.default)().hide(),t.abrupt("return",s);case 15:case"end":return t.stop()}},t,this)}),function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})});return function(t){return n.apply(this,arguments)}}()},{key:"getAnnotationWindows",value:function(){return this._annotationWindows}},{key:"getAnnotationWindowByLayer",value:function(t){f.debug("Grid#getAnnotationWindowByLayer layerId:",t,"windows:",this._annotationWindows);var n=!0,e=!1,r=void 0;try{for(var o,i=Object.values(this._annotationWindows)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value;if(a.getCurrentLayerId()===t)return a}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return null}},{key:"bindEvents",value:function(){var t=this;f.debug("Grid#bindEvents"),jQuery.subscribe("YM_ADD_WINDOW",function(n,e){t.addAnnotationWindow(e||{})}),jQuery.subscribe("YM_ADD_WINDOWS",function(n,e){f.debug("Received YM_ADD_WINDOWS config:",e),t.addAnnotationWindows(e)})}},{key:"_resizeWindows",value:function(){var t=Object.keys(this._annotationWindows),n=t.length,e=0;switch(n){case 1:e=20;break;case 2:e=25;break;default:e=100/(n+1)}var r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;this._setWidth(s,e)}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"_setWidth",value:function(t,n){f.debug("Grid#_setWidth itemId:",t,"width:",n),this._layout.root.getItemsById(t)[0].parent.config.width=n,this._layout.updateSize()}},{key:"_pickLayer",value:function(){var t=(0,s.default)().getTransient("annotationLayers"),n=!0,e=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value["@id"],u=!0,c=!0,l=!1,f=void 0;try{for(var d,h=Object.values(this._annotationWindows)[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){if(a===d.value.getCurrentLayerId()){u=!1;break}}}catch(t){l=!0,f=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}if(u)return a}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return t[0]["@id"]}}]),t}();n.default=d},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(1),a=p(e(47)),u=p(e(53)),s=p(e(12)),c=p(e(4)),l=p(e(0)),f=p(e(3)),d=p(e(2)),h=p(e(54)),v=p(e(16)),g=p(e(5));p(e(7));function p(t){return t&&t.__esModule?t:{default:t}}function y(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var m=(0,l.default)(),_=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),m.debug("AnnotationWindow#constructor options:",n),this._id=n.id,this._miradorId=n.miradorId,this._imageWindowId=n.canvasWindowId,this._appendTo=n.appendTo,this._listWidget=n.annotationListWidget,this._explorer=n.explorer,this._initialLayerId=n.initialLayerId||null,this._initialTocTags=n.initialTocTags||[],this._annotationId=n.annotationId,this._state=n.appState,this._miradorProxy=(0,f.default)().getMiradorProxy(this._miradorId),this._tocSpec=(0,d.default)().getSetting("annotations","tocSpec"),this._annotationTocCache=(0,c.default)().getAnnotationTocCache(),this._id||(this._id=Mirador.genUUID()),this._imageWindow=this._miradorProxy.getWindowProxyById(this._imageWindowId),this._dom=new u.default(this._appendTo,this._state.getSetting("ui","annotationWindow","enableDirectionToggle")),this._orderConfirm=this._dom.getOrderConfirm(),this._continuousPages=this._state.getSetting("ui","annotationWindow","continuousPages"),this._jQuerySubscribed={},this._miradorSubscribed={},this._setDirty(!1),this._ignoredEvents={}}return o(t,[{key:"getId",value:function(){return this._id}},{key:"init",value:function(){var t=y(regeneratorRuntime.mark(function t(){var n,e,r,o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this._imageWindow.getCurrentCanvasId(),e=this._imageWindow.getAnnotationsList(),!this._tocSpec){t.next=8;break}return t.next=5,(0,c.default)().getAnnotationTocCache().getToc(n);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=null;case 9:return r=t.t0,o=this._processDataParams({annotationId:this._annotationId,annotationList:e,layerId:this._initialLayerId,toc:r,tocTags:this._initialTocTags}),i=o.targetAnno,o.layerId,a=o.tocTags,m.debug("AnnotationWindow#init targetAnno:",i),this.initLayerSelector(),this.placeHolder=this._dom.getPlaceHolder(),this.placeHolder.text("Loading...").show(),this._setupAnnotationListWidget(),t.next=18,this.reload().catch(function(t){throw"AnnotationWindow#init reload failed - "+t});case 18:return this._annotationId?(this._listWidget.highlightAnnotations([i],"SELECTED"),this._listWidget.goToAnnotation(this._annotationId,n)):this._initialTocTags.length>0?this._listWidget.goToPageByTags(a):this._listWidget.goToPageByCanvas(n),this.bindEvents(),t.abrupt("return",this);case 21:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"ignoreEvent",value:function(t,n){this._ignoredEvents[t]=(new Date).valueOf()+n}},{key:"_shouldIgnoreEvent",value:function(t){var n=this._ignoredEvents[t];if("number"==typeof n){if((new Date).valueOf()<n)return!0;delete this._ignoredEvents[t]}return!1}},{key:"_processDataParams",value:function(t){m.debug("AnnotationWindow#_processDataParams params:",t);var n=null,e=t.layerId,r=t.tocTags;return t.annotationId&&(n=i.annoUtil.findAnnotationFromListById(t.annotationId,t.annotationList))&&(e=n.layerId,t.toc&&(r=t.toc.getTagsFromAnnotationId(t.annotationId))),{targetAnno:n,layerId:e,tocTags:r}}},{key:"_getTargetAnnoWithToc",value:function(t,n,e,r){var o=t.filter(function(t){return t.layerId==n}).filter(function(t){return e.matchHierarchy(t,r.slice(0,1))}).filter(function(t){return e.matchHierarchy(t,r)});o.length>0&&!targetAnno&&(targetAnno=o[0])}},{key:"_processAnnotationId",value:function(t){var n=i.annoUtil.findAnnotationFromListById(t.annotationId,t.annotationList)[0],e=t.layerId,r=[];return n&&(e=n.layerId,t.toc&&(r=toc.getTagsFromAnnotationId(t.annotationId))),{targetAnno:n,layerId:e,tocTags:r}}},{key:"_processLayerId",value:function(t,n,e,r){var o=this,i=n.filter(function(t){return t.layerId==o._initialLayerId});if(e&&r.length>0){var a=(i=i.filter(function(t){return e.matchHierarchy(t,r.slice(0,1))})).filter(function(t){return e.matchHierarchy(t,r)});a.length>0&&!targetAnno&&(targetAnno=a[0])}}},{key:"getDomHelper",value:function(){return this._dom}},{key:"getMiradorProxy",value:function(){return this._miradorProxy}},{key:"getImageWindowId",value:function(){return this._imageWindowId}},{key:"getImageWindowProxy",value:function(){var t=this.getImageWindowId();return(0,f.default)().getWindowProxyById(t)}},{key:"_setupAnnotationListWidget",value:function(){if(!this._listWidget){var t=(0,f.default)().getWindowProxyById(this._imageWindowId).getManifest().getCanvases();this._listWidget=new a.default({annotationWindow:this,canvases:t,tocTags:this._initialTocTags,annotationExplorer:this._explorer,state:(0,d.default)(),isEditor:g.default.isEditor(),continuousPages:this._continuousPages}),this._listWidget.reload(this._initialLayerId)}}},{key:"destroy",value:function(){m.debug("AnnotationWindow#destroy"),this._unsubscribeAll()}},{key:"getAnnoListNav",value:function(){return this._listWidget.getNav()}},{key:"initMenuTagSelector",value:function(){var t,n=this;m.debug("AnnotationWindow#initMenuTagSelector"),this.menuTagSelector&&this.menuTagSelector.destroy(),this.menuTagSelector=new h.default({parent:this._dom.getTocTagSelector(),tocSpec:(0,d.default)().getSetting("annotations","tocSpec"),annotationExplorer:this._explorer,initialTags:this._initialTocTags,changeCallback:(t=y(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return m.debug("Change from TOC selector: ",e),t.next=3,n._listWidget.goToPageByTags([e]);case 3:case"end":return t.stop()}},t,n)})),function(n,e){return t.apply(this,arguments)})})}},{key:"initLayerSelector",value:function(){var t=this;this._setCurrentLayerId(this._initialLayerId),this.layerSelector=new v.default({parent:this._dom.getLayerSelectorContainer(),annotationExplorer:this._explorer,initialLayerId:this._initialLayerId,changeCallback:function(n,e){m.debug("Change from Layer selector: ",n),t._setCurrentLayerId(n),t.updateList()}})}},{key:"_toggleDirection",value:function(){var t=this._dom.getRoot();t.hasClass("row-reverse")?t.toggleClass("row-reverse",!1):t.toggleClass("row-reverse",!0),this._dom.updateDirection()}},{key:"getCurrentLayerId",value:function(){return this._currentLayerId}},{key:"_setCurrentLayerId",value:function(t){m.debug("AnnotationWindow#_setCurrentLayerId layerId:",t),this._currentLayerId=t}},{key:"show",value:function(){this._dom.getRoot().show()}},{key:"hide",value:function(){this._dom.getRoot().hide()}},{key:"_isDirty",value:function(){return this._dirty}},{key:"_setDirty",value:function(t){this._dirty=t}},{key:"reload",value:function(){var t=this;m.debug("AnnotationWindow#reload"),this.hide();var n=this;(0,d.default)();this.placeHolder.hide();this.getCurrentCanvas();var e=new Promise(function(t,e){n._explorer.getLayers().then(function(r){r.length>0?n.layerSelector.isLoaded()?t():n.layerSelector.init(r).then(function(e){n._setCurrentLayerId(e.val()),t()}).catch(function(t){e("layerSelector.init failed - "+t)}):e("No layers from annotation explorer")})}),r=new Promise(function(t,e){n._explorer.getAnnotationToc()?n.menuTagSelector.reload().then(function(){t()}).catch(function(t){e("menuTagSelector.reload failed - "+t)}):t()});return Promise.all([e,r]).then(y(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.updateList().catch(function(t){throw"AnnotationWindow#updateList failed: "+t});case 2:return t._dom.updateDirection(),t.show(),n.abrupt("return",t);case 5:case"end":return n.stop()}},n,t)})))}},{key:"reloadIfDirty",value:function(){m.debug("AnnotationWindow#reloadIfDirty dirty:",this._dirty),this._isDirty()&&(this._setDirty(!1),this.reload())}},{key:"updateList",value:function(){var t=y(regeneratorRuntime.mark(function t(){var n,e,r,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this._listWidget,(0,d.default)(),e=this._imageWindow.getCurrentCanvasId(),m.debug("AnnotationWindow#updateList canvasId:",e),t.next=6,n.reload(this.layerSelector.val());case 6:if(r=0,!(this._initialTocTags.length>0)){t.next=14;break}return t.next=10,n.goToPageByTags(this._initialTocTags).catch(function(t){throw"listWidget#goToPageByTags failed: "+t+"(tags: "+o._initialTocTags+")"});case 10:r=t.sent,this._annotationId&&n.scrollToAnnotation(this._annotationId),t.next=17;break;case 14:return t.next=16,n.goToPageByCanvas(e).catch(function(t){throw"listWidget#goToPageByCanvas failed: "+t});case 16:r=t.sent;case 17:0===r?this.placeHolder.text("No annotations found.").show():this.placeHolder.hide();case 18:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getCurrentCanvasId",value:function(){return this._imageWindow.getCurrentCanvasId()}},{key:"getCurrentCanvas",value:function(){var t=this.getCurrentCanvasId(),n=this._imageWindow.getManifest().getCanvases().filter(function(n){return n["@id"]===t});if(!(n.length<1))return n[0];(0,s.default)("Could not find the requested canvas: "+t)}},{key:"select",value:function(t){this._listWidget.select(t)}},{key:"scrollToAnnotation",value:function(t){this._listWidget.scrollToAnnotation(t)}},{key:"goToAnnotation",value:function(){var t=y(regeneratorRuntime.mark(function t(n,e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return m.debug("AnnotationWindow#goToAnnotation annoId:",n,"canvasId:",e),t.abrupt("return",this._listWidget.goToAnnotation(n,e));case 2:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"createInfoDiv",value:function(t,n){var e=t.on.full;return jQuery(infoTemplate({on:'<a target="_blank" href="'+e+'">'+e+"</a>"}))}},{key:"hasOpenEditor",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;if(!0===jQuery(i).data("editing"))return!0}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}return!1}},{key:"fadeUp",value:function(t,n){t.transition({animation:"fade up",duration:"0.3s",onComplete:n})}},{key:"fadeDown",value:function(t,n){t.transition({animation:"fade down",duration:"0.3s",onComplete:n})}},{key:"clearAnnotationHighlights",value:function(){this._listWidget.clearAnnotationHighlights()}},{key:"highlightAnnotationElem",value:function(t,n){this._listWidget.highlightAnnotationElem(t,n)}},{key:"showSaveOrderConfirmation",value:function(t){this._reorderedPageElem=t,this._dom.getOrderConfirm().show()}},{key:"_saveAnnotationsOrder",value:function(t){var n=this,e=t.find(".annowin_anno"),r=[],o=t.data("canvasId"),i=t.data("layerId");return e.each(function(t,n){var e=jQuery(n).data("annotationId");r.push(e)}),m.debug("AnnotationWindow#_saveAnnotationsOrder canvasId:",o,"layerId:",i,"annoIds:",r),this._explorer.updateAnnotationListOrder(o,i,r).catch(function(t){throw n._dom.getOrderConfirm().hide(),"AnnotationWindow#_saveAnnotationsOrder updateAnnotationListOrder failed: "+t})}},{key:"bindEvents",value:function(){var t=this;m.debug("AnnotationWindow#bindEvents"),this._dom.getCreateWindowButton().click(function(n){t._miradorProxy.publish("YM_DISPLAY_ON"),jQuery.publish("YM_ADD_WINDOW",{miradorId:t._miradorId,imageWindowId:t._imageWindowId})});var n,e,r=this._dom.getToggleDirectionButton();r&&r.click(function(n){t._toggleDirection()}),this._dom.getSaveOrderButton().click(function(n){t._saveAnnotationsOrder(t._reorderedPageElem),t._dom.getOrderConfirm().hide()}),this._dom.getCancelOrderButton().click(function(n){t._dom.getOrderConfirm().hide()}),this._subscribe(this._miradorProxy,"ANNOTATIONS_LIST_UPDATED",function(n,e){m.debug("AnnotationWindow:SUB:ANNOTATIONS_LIST_UPDATED, params:",e),e.windowId!==t.getImageWindowId()||t._shouldIgnoreEvent("ANNOTATIONS_LIST_UPDATED")||(t.hasOpenEditor()?t._setDirty(!0):t.reload())}),this._subscribe(jQuery,"ANNOWIN_ANNOTATION_FOCUSED",(n=y(regeneratorRuntime.mark(function n(e,r){var o,a,u,s,l,f,h,v,g,p,y,_,b,w,x,A,k,S,T,P,I;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(m.debug("AnnotationWindow:SUB:ANNOWIN_ANNOTATION_FOCUSED annotation window id:",t._id,"params:",r,"layer:",t.getCurrentLayerId()),(0,i.Anno)(r.annotation),o=t._listWidget,a=null,r.annotationWindowId!==t._id){n.next=6;break}return n.abrupt("return");case 6:if(o.clearHighlights(),u=t._imageWindow.getAnnotationsList(),s=t.getCurrentLayerId(),!(0,d.default)().getSetting("annotations","tocSpec")){n.next=40;break}return n.next=13,(0,c.default)().getAnnotationTocCache().getToc(r.canvasId);case 13:for(l=n.sent,f=o.getTocSiblingElems(r.annotation,u,s,l),o.clearHighlights(),h=!0,v=!1,g=void 0,n.prev=19,p=f[Symbol.iterator]();!(h=(y=p.next()).done);h=!0)_=y.value,o.highlightAnnotationElem(_);n.next=27;break;case 23:n.prev=23,n.t0=n.catch(19),v=!0,g=n.t0;case 27:n.prev=27,n.prev=28,!h&&p.return&&p.return();case 30:if(n.prev=30,!v){n.next=33;break}throw g;case 33:return n.finish(30);case 34:return n.finish(27);case 35:if(!(f.length>0)){n.next=39;break}return n.next=38,o.goToPageByCanvas(r.canvasId);case 38:o.scrollToElem(f[0],-r.offset);case 39:return n.abrupt("return");case 40:return n.next=42,o.goToPageByCanvas(r.canvasId);case 42:for(b={},w=!0,x=!1,A=void 0,n.prev=46,k=u[Symbol.iterator]();!(w=(S=k.next()).done);w=!0)T=S.value,b[T["@id"]]=T;n.next=54;break;case 50:n.prev=50,n.t1=n.catch(46),x=!0,A=n.t1;case 54:n.prev=54,n.prev=55,!w&&k.return&&k.return();case 57:if(n.prev=57,!x){n.next=60;break}throw A;case 60:return n.finish(57);case 61:return n.finish(54);case 62:if(!((P=(P=i.annoUtil.findTransitiveTargetingAnnotations(r.annotation,b)).filter(function(n){return n.layerId===t.getCurrentLayerId()})).length>0)){n.next=69;break}return o.highlightAnnotations(P,"TARGETING"),a=t._dom.findAnnoElemByAnnoId(P[0]["@id"]),o.scrollToElem(a,-r.offset),n.abrupt("return");case 69:if(!((I=i.annoUtil.findTransitiveTargetAnnotations(r.annotation,b).filter(function(n){return n.layerId===t.getCurrentLayerId()})).length>0)){n.next=75;break}return o.highlightAnnotations(I,"TARGET"),a=t._dom.findAnnoElemByAnnoId(I[0]["@id"]),o.scrollToElem(a,-r.offset),n.abrupt("return");case 75:case"end":return n.stop()}},n,t,[[19,23,27,35],[28,,30,34],[46,50,54,62],[55,,57,61]])})),function(t,e){return n.apply(this,arguments)})),this._subscribe(jQuery,"YM_ANNOTATION_TOC_TAGS_SELECTED",function(n,e,r,o){m.debug("AnnotationWindow:SUB:YM_ANNOTATION_TOC_TAGS_SELECTED imageWindow:",e,"canvasId:",r,"tags:",o),t._listWidget.goToPageByTags(o)}),this._subscribe(this._miradorProxy,"YM_IMAGE_WINDOW_TOOLTIP_ANNO_CLICKED",(e=y(regeneratorRuntime.mark(function n(e,r,o){var i,a,u,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(m.debug("AnnotationWindow:SUB:YM_IMAGE_WINDOW_TOOLTIP_ANNO_CLICKED windowId:",r,"annoId:",o,"annoWin:",t.id),i=t._miradorProxy.getWindowProxyById(r),a=i.getCurrentCanvasId(),!t._continuousPages){n.next=11;break}return n.next=6,t._annotationTocCache.getToc(a);case 6:u=n.sent,(s=u.annotations.filter(function(t){return t["@id"]===o})[0])&&t._listWidget.goToPageByTags(s.tocTags),n.next=12;break;case 11:t._listWidget.goToAnnotation(o,a);case 12:case"end":return n.stop()}},n,t)})),function(t,n,r){return e.apply(this,arguments)}))}},{key:"_subscribe",value:function(t,n,e){var r=void 0;if(t===jQuery)r=this._jQuerySubscribed;else{if(t!==this._miradorProxy){var o="AnnotationWindow#_subscribe invalid context ";throw m.error(o,t),o+t}r=this._miradorSubscribed}r[n]instanceof Array||(r[n]=[]),r[n].push(e),t.subscribe(n,e)}},{key:"_unsubscribeAll",value:function(){for(var t=[jQuery,this._miradorProxy],n=0;n<t.length;n++){var e=t[n],o=e===jQuery?this._jQuerySubscribed:this._miradorSubscribed,i=!0,a=!1,u=void 0;try{for(var s,c=Object.entries(o)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=r(s.value,2),f=l[0],d=l[1],h=!0,v=!1,g=void 0;try{for(var p,y=d[Symbol.iterator]();!(h=(p=y.next()).done);h=!0){var m=p.value;console.log("UNSUB",f,m),e.unsubscribe(f,m)}}catch(t){v=!0,g=t}finally{try{!h&&y.return&&y.return()}finally{if(v)throw g}}}}catch(t){a=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}}}}]),t}();n.default=_},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=f(e(48)),i=f(e(49)),a=e(1),u=f(e(4)),s=f(e(0)),c=f(e(2)),l=f(e(52));function f(t){return t&&t.__esModule?t:{default:t}}function d(t){return function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})}}var h=(0,s.default)(),v=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),h.debug("AnnotationListWidget#constructor options:",n),this._annoWin=n.annotationWindow,this._annoPageRenderer=n.annotationPageRenderer,this._annoExplorer=n.annotationExplorer,this._canvases=n.canvases,this._state=n.state,this._isEditor=n.isEditor,this._continuousPages=n.continuousPages,this._dom=this._annoWin.getDomHelper(),this._rootElem=this._dom.getListContainer(),this._minContentRelativeHeight=1.5,this._maxContentRelativeHeight=5,this._state||(this._state=(0,c.default)()),this._annoPageRenderer||(this._annoPageRenderer=new i.default({annotationWindow:this._annoWin,annotationExplorer:this._annoExplorer})),this._tocSpec=this._state.getSetting("annotations","tocSpec")}return r(t,[{key:"getRootElement",value:function(){return this._rootElem}},{key:"getAnnotationElems",value:function(){return this._dom.getAllAnnotationCells()}},{key:"reload",value:function(t){this._layerId=t,this._nav=this._setupNavigation(),this._loading=!1,this._rootElem.empty(),this._createPageElements(),this._scrollHelper=new l.default({annotationWindow:this._annoWin,listWidget:this,listNavigator:this._nav,groupHeaderHeight:19,continuousPages:this._continuousPages}),this._unbindEvents(),this._bindEvents()}},{key:"_setupNavigation",value:function(){return new o.default({canvases:this._canvases})}},{key:"getNav",value:function(){return this._nav}},{key:"goToPage",value:function(){var t=d(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidgetr#goToPage",n,"from",this._nav.getPage()),n===this._nav.getPage()){t.next=5;break}return this._nav.setPage(n),t.next=5,this._onNavSetPage(n).catch(function(t){throw"AnnotationListWidget#goToPage _onNavSetPage("+n+") failed: "+t});case 5:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"goToPageByCanvas",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h.debug("AnnotationListWidgetr#goToPageByCanvas canvasId:",n),e=this._nav.getPageNumForCanvas(n),t.next=4,this.goToPage(e).catch(function(t){throw"AnnotationListWidget#goToPageByCanvas: goToPage("+e+") failed: "+t});case 4:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"goToPageByTags",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidgetr#goToPageByTags",n),!((e=this._tocSpec.canvasMap[n[0]])instanceof Array&&e.length>0)){t.next=6;break}return t.next=5,this.goToPageByCanvas(e[0]);case 5:this._scrollHelper.scrollToTags(n);case 6:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"goToAnnotation",value:function(){var t=d(regeneratorRuntime.mark(function t(n,e){var r,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#goToAnnotation annoId",n,"canvasId:",e),r=this._nav,!((o=r.getPageNumForCanvas(e))>=0)){t.next=9;break}return t.next=6,this.goToPage(o);case 6:setTimeout(function(){i._scrollHelper.scrollToAnnotation(n),i.clearAnnotationHighlights(),i.highlightAnnotation(n,"SELECTED")},0),t.next=10;break;case 9:h.debug("AnnotationListWidget#goToAnnotation page not found for canvasId",e);case 10:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"_onNavSetPage",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#_onNavSetPage pageNum:",n),e=this._nav.getCanvas(n),r=this._annoWin.getCurrentCanvasId(),o=e["@id"],this._nav.isLoaded(n)){t.next=8;break}return this._unloadAllPages(),t.next=8,this._loadPage(n).catch(function(t){throw"AnnotationListWidget#_onNavSetPage _loadPage("+n+") failed: "+t});case 8:if(!this._continuousPages){t.next=15;break}return t.next=11,this.loadPreviousPage();case 11:return t.next=13,this.loadNextPage();case 13:return t.next=15,this._scrollHelper.scrollToPage(n);case 15:r!==o&&this._annoWin.getImageWindowProxy().setCurrentCanvasId(o);case 16:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"loadNextPage",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#loadNextPage loading:",this._loading),t.prev=1,!this._loading){t.next=4;break}return t.abrupt("return");case 4:if(this._loading=!0,!((n=this._nav.getActiveRange().endPage+1)<this._nav.getNumPages())){t.next=10;break}return t.next=9,this._loadPage(n);case 9:this._scrollHelper.scrollDown(30);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),h.error("AnnotationListWidget#loadNextPages failed",t.t0);case 15:return t.prev=15,this._loading=!1,t.finish(15);case 18:case"end":return t.stop()}},t,this,[[1,12,15,18]])}));return function(){return t.apply(this,arguments)}}()},{key:"loadPreviousPage",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#loadPreviousPage loading:",this._loading),t.prev=1,!this._loading){t.next=4;break}return t.abrupt("return");case 4:if(this._loading=!0,!((n=this._nav.getActiveRange().startPage-1)>=0)){t.next=10;break}return t.next=9,this._loadPage(n);case 9:this._scrollHelper.scrollUp(30);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),h.error("AnnotationListWidget#loadNextPages failed",t.t0);case 15:return t.prev=15,this._loading=!1,t.finish(15);case 18:case"end":return t.stop()}},t,this,[[1,12,15,18]])}));return function(){return t.apply(this,arguments)}}()},{key:"LoadNextPages",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n,e,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#loadNextPages loading:",this._loading),t.prev=1,!this._loading){t.next=4;break}return t.abrupt("return");case 4:this._loading=!0,n=this._rootElem.height()*this._minContentRelativeHeight,e=this._nav.getNumPages(),r=this._rootElem[0].scrollHeight,o=this._nav.getActiveRange().endPage+1;case 9:if(!(o<e&&r<n)){t.next=16;break}return h.debug("AnnotationListWidget#loadNextPages nextPage:",o,"numPages:",e,"scrollHeight:",r,"minHeight:",n),t.next=13,this._loadPage(o);case 13:r=this._rootElem[0].scrollHeight,++o,t.next=9;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),h.error("AnnotationListWidget#loadNextPages failed",t.t0);case 21:return t.prev=21,this._loading=!1,t.finish(21);case 24:case"end":return t.stop()}},t,this,[[1,18,21,24]])}));return function(){return t.apply(this,arguments)}}()},{key:"loadPreviousPages",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n,e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#loadPreviousPages",this._loading),t.prev=1,!this._loading){t.next=4;break}return t.abrupt("return");case 4:this._loading=!0,n=this._rootElem.height()*this._minContentRelativeHeight,this._nav.getNumPages(),e=this._rootElem[0].scrollHeight,r=this._nav.getActiveRange().startPage-1;case 9:if(!(r>=0&&e<n)){t.next=16;break}return h.debug("AnnotationListWidget#_loadPreviousPages nextPage:",r,"scrollHeight:",e,"minHeight:",n),t.next=13,this._loadPage(r);case 13:e=this._rootElem[0].scrollHeight,--r,t.next=9;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),h.error("AnnotationListWidget#loadPreviousPages failed",t.t0);case 21:return t.prev=21,this._loading=!1,t.finish(21);case 24:case"end":return t.stop()}},t,this,[[1,18,21,24]])}));return function(){return t.apply(this,arguments)}}()},{key:"select",value:function(t){this.clearAnnotationHighlights(),this._nav.setPageByCanvasId(t.data("canvasId")),t.focus(),jQuery.publish("ANNOWIN_ANNOTATION_FOCUSED",[{annotationWindowId:this._annoWin.getId(),annotation:t.data("annotation"),canvasId:t.data("canvasId"),imageWindowId:this._annoWin.getImageWindowId(),offset:t.position().top-this._rootElem.scrollTop()}])}},{key:"clearAnnotationHighlights",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;jQuery(i).removeClass("ym_anno_selected")}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}}},{key:"highlightAnnotations",value:function(t,n){h.debug("AnnotationListWidget#highlightAnnotations annotations:",t,"flag:",n),this.clearAnnotationHighlights();var e=!0,r=!1,o=void 0;try{for(var i,a=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=i.value,s=jQuery(u),c=s.data("annotationId"),l=!0,f=!1,d=void 0;try{for(var v,g=t[Symbol.iterator]();!(l=(v=g.next()).done);l=!0){v.value["@id"]===c&&this.highlightAnnotationElem(s,n)}}catch(t){f=!0,d=t}finally{try{!l&&g.return&&g.return()}finally{if(f)throw d}}}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}}},{key:"highlightAnnotation",value:function(t,n){var e=!0,r=!1,o=void 0;try{for(var i,a=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=i.value,s=jQuery(u);s.data("annotationId")===t&&this.highlightAnnotationElem(s,n)}}catch(t){r=!0,o=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw o}}}},{key:"highlightAnnotationElem",value:function(t,n){h.debug("AnnotationListWidget#highlightAnnotationElem annoElem:",t,"flag:",n,"annoId:",t.data("annotationId"));var e="TARGETING"===n?"ym_anno_targeting":"TARGETED"===n?"ym_anno_targeted":"ym_anno_selected";t.addClass(e)}},{key:"_createPageElements",value:function(){h.debug("AnnotationListWidget#_createPageElements");for(var t=this._nav,n=this._annoPageRenderer,e=0;e<this._canvases.length;++e){var r=t.getCanvas(e),o=n.createPageElement({pageNum:e,canvasId:r["@id"],canvasLabel:r.label,layerId:this._layerId});this._rootElem.append(o),o.hide(),t.setPageElement(e,o)}}},{key:"_activateMorePagesForward",value:function(){var t=d(regeneratorRuntime.mark(function t(n,e){var r,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.debug("AnnotationListWidget#_activateMorePagesForward",n,e),r=this._rootElem,o=n;case 3:if(!(o<e)){t.next=13;break}return h.debug("AnnotationListWidget#_activateMorePagesForward nextPage:",o,"numPages:",e,"scroll height:",r[0].scrollHeight,"element height:",r.height()),i=o,t.next=8,this._activatePageForward(i);case 8:if(!((o=t.sent)===i||r[0].scrollHeight>r.height())){t.next=11;break}return t.abrupt("break",13);case 11:t.next=3;break;case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}},t,this)}));return function(n,e){return t.apply(this,arguments)}}()},{key:"_activateMorePagesBackward",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.debug("AnnotationListWidget#_activateMorePagesBackward",n),e=this._rootElem,r=n;case 3:if(!(r>=0)){t.next=13;break}return h.debug("AnnotationListWidget#_activateMorePagesBackward nextPage:",r,"scroll height:",e[0].scrollHeight,"element height:",e.height()),o=r,t.next=8,this._activatePageBackward(o);case 8:if(!((r=t.sent)===o||e[0].scrollHeight>e.height())){t.next=11;break}return t.abrupt("break",13);case 11:t.next=3;break;case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_deactivatePage",value:function(t){h.debug("AnnotationListWidget#_deactivatePage",t),this._nav.getPageElement(t).hide(),this._nav.unload(t)}},{key:"_loadPage",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h.debug("AnnotationListWidget#_loadPage pageNum:",n),!this._nav.isLoaded(n)){t.next=4;break}return h.debug("AnnotationListWidget#_loadPage alread loaded; page:",n),t.abrupt("return");case 4:return t.next=6,this._getAnnotationsForPage(n);case 6:return e=t.sent,t.next=9,this._getTocForPage(n);case 9:r=t.sent,o=this._nav.getPageElement(n),this._nav.load(n,e,r),this._annoPageRenderer.render(o,{annotations:e,annotationToc:r,isEditor:this._isEditor,pageNum:n}),o.show();case 14:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_unloadAllPages",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this._nav.getPageElements()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.hide()}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}this._nav.unloadAll()}},{key:"_unloadNextPages",value:function(){h.debug("AnnotationListWidget#_unloadNextPages");for(var t=this._nav,n=this._rootElem,e=n.height(),r=this._maxContentRelativeHeight*e,o=t.getActiveRange().endPage;o>t.getPage()+1&&n[0].scrollHeight-e>r;--o)h.debug("AnnotationListWidget#_deactivatePagesBackward nextPage:",o,"scroll height:",n[0].scrollHeight,"maxHeight:",r),t.getPageElement(o).hide()}},{key:"_unloadPreviousPages",value:function(){h.debug("AnnotationListWidget#_unloadPreviousPages");for(var t=this._rootElem,n=t.height(),e=this._maxContentRelativeHeight*n,r=0;r<this._currentPageNum-1&&t[0].scrollHeight-n>e;++r)h.debug("AnnotationListWidget#_unloadPreviousPages nextPage:",r,"scroll height:",t[0].scrollHeight,"maxHeight:",e),nav.getPageElement(r).hide()}},{key:"_getTocForPage",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._nav.getCanvas(n),!(r=(0,u.default)().getAnnotationTocCache())){t.next=8;break}return t.next=5,r.getToc(e["@id"]);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=null;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"_getAnnotationsForPage",value:function(){var t=d(regeneratorRuntime.mark(function t(n){var e,r,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._nav.getCanvas(n)["@id"],t.next=3,this._annoExplorer.getAnnotations({canvasId:e});case 3:return r=t.sent,t.abrupt("return",r.filter(function(t){return t.layerId===o._layerId}));case 5:case"end":return t.stop()}},t,this)}));return function(n){return t.apply(this,arguments)}}()},{key:"clearHighlights",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;jQuery(i).removeClass("annowin_targeted").removeClass("ym_anno_selected ym_anno_targeting ym_anno_targeted")}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}}},{key:"getTocSiblingElems",value:function(t,n,e,r){h.debug("AnnotationListWidget#getTocSiblingElems annotation:",t,"annotations:",n,"layerId:",e,"toc:",r);var o=[],i=a.annoUtil.findTocSiblings(t,n,e,r),u=!0,s=!1,c=void 0;try{for(var l,f=this._dom.getAllAnnotationCells()[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var d=l.value,v=jQuery(d),g=v.data("annotationId"),p=!0,y=!1,m=void 0;try{for(var _,b=i[Symbol.iterator]();!(p=(_=b.next()).done);p=!0){_.value["@id"]===g&&o.push(v)}}catch(t){y=!0,m=t}finally{try{!p&&b.return&&b.return()}finally{if(y)throw m}}}}catch(t){s=!0,c=t}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}return o}},{key:"_focusNextAnnotation",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n,e,r,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=this._nav,e=jQuery(this._rootElem.find(".annowin_anno:focus")),r=e.next();r.size()>0&&!r.hasClass("annowin_anno");)r=r.next();if(!(r.size()>0)){t.next=8;break}this.select(r),t.next=17;break;case 8:if(!this._continuousPages){t.next=17;break}if(!((o=n.getPage()+1)<n.getNumPages())){t.next=17;break}if(n.isLoaded(o)){t.next=14;break}return t.next=14,this.loadNextPage();case 14:i=n.getPageElement(o),(r=i.find(".annowin_anno").first())&&(this.select(r),n.setPage(o));case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_focusPrevAnnotation",value:function(){var t=d(regeneratorRuntime.mark(function t(){var n,e,r,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=this._nav,e=jQuery(this._rootElem.find(".annowin_anno:focus")),r=e.prev();r.size()>0&&!r.hasClass("annowin_anno");)r=r.prev();if(!(r.size()>0)){t.next=8;break}this.select(r),t.next=17;break;case 8:if(!this._continuousPages){t.next=17;break}if(!((o=n.getPage()-1)>=0)){t.next=17;break}if(n.isLoaded(o)){t.next=14;break}return t.next=14,this.loadPreviousPage();case 14:i=n.getPageElement(o),(r=i.find(".annowin_anno").last())&&(this.select(r),n.setPage(o));case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"scrollToElem",value:function(t,n){this._scrollHelper.scrollToElem(t,n)}},{key:"scrollToAnnotation",value:function(t,n){this._scrollHelper.scrollToAnnotation(t,n)}},{key:"_bindEvents",value:function(){var t=this;this._scrollHelper.bindScrollEvent(),this._rootElem.keydown(function(n){switch(n.preventDefault(),n.key){case"ArrowDown":t._focusNextAnnotation();break;case"ArrowUp":t._focusPrevAnnotation()}})}},{key:"_unbindEvents",value:function(){this._scrollHelper.unbindScrollEvent(),this._rootElem.off("keydown")}}]),t}();n.default=v},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);var a=(0,((r=i)&&r.__esModule?r:{default:r}).default)(),u=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({canvases:[]},n),this._pageNum=-1,this._numPages=this.options.canvases.length,this._activeRange={startPage:-1,endPage:-1},this._pageStateList=this._createPageStateList()}return o(t,[{key:"getPage",value:function(){return this._pageNum}},{key:"setPage",value:function(t){if(!(t>=0&&t<this._numPages))throw"AnnotationNav#setPage invalid pageNum "+t;this._pageNum=t}},{key:"setPageByCanvasId",value:function(t){for(var n=0;n<this._pageStateList.length;++n)if(this._pageStateList[n].canvas["@id"]===t)return void this.setPage(n);a.error("AnnotationNav#setPageByCanvasId page not found for canvas",t)}},{key:"getNumPages",value:function(){return this._numPages}},{key:"getPageElements",value:function(){return this._pageStateList.map(function(t){return t.element})}},{key:"getPageElement",value:function(t){return this._pageStateList[t].element}},{key:"setPageElement",value:function(t,n){this._pageStateList[t].element=n}},{key:"getCanvas",value:function(t){return this._pageStateList[t].canvas}},{key:"isLoaded",value:function(t){return this._pageStateList[t].loaded}},{key:"setLoaded",value:function(t){this._pageStateList[t].loaded=!0}},{key:"load",value:function(t,n,e){var r=this._pageStateList[t];r.annotations=n,r.toc=e,r.loaded=!0,this._addToActiveRange(t)}},{key:"unload",value:function(t){var n=this._pageStateList[t];this._unloadPageItem(n),this._removeFromActiveRange(t)}},{key:"_unloadPageItem",value:function(t){delete t.annotations,delete t.toc,t.loaded=!1}},{key:"unloadAll",value:function(){var t=!0,n=!1,e=void 0;try{for(var r,o=this._pageStateList[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;this._unloadPageItem(i)}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}this._activeRange.startPage=-1,this._activeRange.endPage=-1}},{key:"getActiveRange",value:function(){return a.debug("AnnotationNav get activeRange",this._activeRange.startPage,this._activeRange.endPage),this._activeRange}},{key:"_addToActiveRange",value:function(t){a.debug("AnnotationNav#_addToActiveRange",t,this._activeRange.startPage,this._activeRange.endPage);var n=this._activeRange;(-1===n.startPage||t<n.startPage)&&(n.startPage=t),(-1===n.endPage||t>n.endPage)&&(n.endPage=t)}},{key:"_removeFromActiveRange",value:function(t){a.debug("AnnotationNav#_removeFromActiveRange",t,this._activeRange.startPage,this._activeRange.endPage);var n=this._activeRange;t===n.startPage&&(++n.startPage,n.startPage>=this._numPages&&(n.startPage=-1,n.endPage=-1)),t===n.endPage&&(--n.endtPage,-1===n.endPage&&(n.startPage=-1))}},{key:"getPageNumForCanvas",value:function(t){for(var n=0;n<this._pageStateList.length;++n)if(this._pageStateList[n].canvas["@id"]===t)return n;return-1}},{key:"_createPageStateList",value:function(){var t=[],n=!0,e=!1,r=void 0;try{for(var o,i=this.options.canvases[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value;t.push({toc:null,canvas:a,loaded:!1,annotations:[],element:null})}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return t}}]),t}();n.default=u},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=s(e(50)),i=s(e(51)),a=s(e(0)),u=s(e(2));function s(t){return t&&t.__esModule?t:{default:t}}var c=(0,a.default)(),l=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._annoWin=n.annotationWindow,this._annoRenderer=n.annotationRenderer,this._annoExplorer=n.annotationExplorer,this._state=n.state,this._state||(this._state=(0,u.default)()),this._annoRenderer||(this._annoRenderer=new o.default({annotationWindow:this._annoWin,state:this._state}))}return r(t,[{key:"createPageElement",value:function(t){var n=f({pageNum:t.pageNum}),e=jQuery(n);return e.data("canvasId",t.canvasId),e.data("layerId",t.layerId),e.find(".page-header").text(t.canvasLabel),e}},{key:"render",value:function(t,n){n.annotationToc?this._renderToc(t,n):this._renderDefault(t,n)}},{key:"unload",value:function(t){t.find(".annowin_group_header, .annowin_anno").remove()}},{key:"_renderDefault",value:function(t,n){c.debug("AnnotationPageRenderer#_renderDefault options:",n);var e=t.data("canvasId"),r=t.data("layerId"),o=0,i=!0,a=!1,u=void 0;try{for(var s,l=n.annotations[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var f=s.value;try{if(f.layerId===r){++o;var d=this._annoRenderer.createAnnoElem(f,{pageElem:t,canvasId:e,isEditor:n.isEditor});t.append(d)}}catch(t){throw c.error("ERROR AnnotationPageRenderer#_renderDefault",t),t}}}catch(t){a=!0,u=t}finally{try{!i&&l.return&&l.return()}finally{if(a)throw u}}return o}},{key:"_renderToc",value:function(t,n){return c.debug("AnnotationPageRenderer#_renderToc options:",n),new i.default({container:t,canvasId:t.data("canvasId"),layerId:t.data("layerId"),toc:n.annotationToc,annotationRenderer:this._annoRenderer}).render()}}]),t}();n.default=l;var f=Handlebars.compile(['<div class="ym-annotation-page page-{{pageNum}}">','  <div class="page-header">{{text}}',"  </div>","</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=e(1),i=s(e(13)),a=s(e(0)),u=s(e(9));function s(t){return t&&t.__esModule?t:{default:t}}var c=(0,a.default)(),l=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._annoWin=n.annotationWindow,this._state=n.state,this.layerIndexMap=this._state.getTransient("layerIndexMap"),this.hideTags=this._state.getSetting("ui","annotationWindow","hideTags"),this._miradorProxy=this._annoWin.getMiradorProxy()}return r(t,[{key:"createAnnoElem",value:function(t,n){var e=(0,o.Anno)(t),r=e.bodyText,i=e.tags,a=this.getTagsHtml(i),u=(e.bodyStyle,f({content:r,tags:a,isEditor:n.isEditor,orderable:n.isEditor})),s=jQuery(u),c=(s.find(".content"),s.find(".menu_bar"));s.data("annotationId",t["@id"]),s.data("canvasId",n.canvasId),s.data("pageElem",n.pageElem);var l=s.find(".ui.dropdown");l.dropdown({direction:"downward"}),l.click(function(t){t.stopPropagation()});var d=this.layerIndexMap[t.layerId];return c.addClass("layer_"+d%10),"oa:Annotation"==t.on["@type"]?c.addClass("targeting_anno"):c.removeClass("targeting_anno"),this.hideTags&&s.find(".tags").hide(),this.bindAnnotationItemEvents(s,t,n),s}},{key:"getTagsHtml",value:function(t){var n="";return jQuery.each(t,function(t,e){n+='<span class="tag">'+e+"</span>"}),n}},{key:"bindAnnotationItemEvents",value:function(t,n,e){var r=this,a=this._annoWin;a.getAnnoListNav();t.data("annotation",n),t.click(function(t){a.select(jQuery(this))}),t.find(".annotate").click(function(t){var e=a.getImageWindowProxy(),o=jQuery("#ym_annotation_dialog"),u=new i.default({parent:o,windowId:a.getImageWindowId(),mode:"create",targetAnnotation:n,endpoint:a.endpoint,saveCallback:function(t){try{o.dialog("close"),e.getAnnotationsList().push(t),r._miradorProxy.publish("ANNOTATIONS_LIST_UPDATED",{windowId:e.getWindowId(),annotationsList:e.getAnnotationsList()})}catch(t){c.error('AnnotationRenderer saving from "annotate" failed:',t),a.reloadIfDirty()}},cancelCallback:function(){o.dialog("close"),annoWind.reloadIfDirty()}});o.dialog({title:"Create annotation",modal:!0,draggable:!0,dialogClass:"no_close",width:400}),u.show()}),t.find(".edit").click(function(e){r._annoWin.getDomHelper();var s=new i.default({parent:t,windowId:a.getImageWindowId(),mode:"update",endpoint:a.endpoint,annotation:n,saveCallback:function(n,e){if(a.getCurrentLayerId()===n.layerId){var r=t.find(".normal_view"),i=r.find(".content");i.html(e),u.default.setTextDirectionClass(i,(0,o.Anno)(n).bodyStyle),r.show(),t.data("editing",!1)}else t.remove();a.reloadIfDirty()},cancelCallback:function(n){t.find(".normal_view").show(),t.data("editing",!1),a.reloadIfDirty()}});t.data("editing",!0),t.find(".normal_view").hide(),s.show()}),t.find(".delete").click(function(t){window.confirm("Do you really want to delete the annotation?")&&r._miradorProxy.publish("annotationDeleted."+a.getImageWindowProxy().getWindowId(),[n["@id"]])}),t.find(".order-up").click(function(n){n.stopPropagation();var e=t.prev();e.length>0&&e.hasClass("annowin_anno")&&a.fadeDown(t,function(){t.after(e),a.fadeUp(t,function(){a.showSaveOrderConfirmation(t.data("pageElem"))})})}),t.find(".order-down").click(function(n){n.stopPropagation();var e=t.next();e.length>0&&e.hasClass("annowin_anno")&&a.fadeUp(t,function(){t.before(e),a.fadeDown(t,function(){a.showSaveOrderConfirmation(t.data("pageElem"))})})})}}]),t}();n.default=l;var f=Handlebars.compile(['<div class="annowin_anno" tabindex="-1">','  <div class="normal_view">',"    {{#if isEditor}}",'      <div class="menu_bar">','        <div class="ui text menu">','          <div class="ui dropdown item">','            <i class="fa fa-bars fa-fw"></i>','            <div class="menu">','              <div class="annotate item"><i class="fa fa-hand-o-left fa-fw"></i> Annotate</div>','              <div class="edit item"><i class="fa fa-edit fa-fw"></i> {{t "edit"}}</div>','              <div class="delete item"><i class="fa fa-times fa-fw"></i> {{t "delete"}}</div>',"            </div>","          </div>","          {{#if orderable}}",'            <div class="right menu">','              <i class="order-down caret down icon"></i>','              <i class="order-up caret up icon"></i>',"            </div>","          {{/if}}","        </div>","      </div>","    {{/if}}",'    <div class="content">{{{content}}}</div>','    <div class="tags">{{{tags}}}</div>',"  </div>","</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=a(e(0)),i=a(e(5));function a(t){return t&&t.__esModule?t:{default:t}}var u=(0,o.default)(),s=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({container:null,canvasId:null,layerId:null,toc:null,annotationRenderer:null},n),u.debug("AnnotationTocRenderer#constructor options:",n),this._isEditor=i.default.isEditor()}return r(t,[{key:"render",value:function(){var t=this;u.debug("AnnotationTocRenderer#render"),this.options.toc.walk(function(n,e){n.isRoot||(e<2&&!n.isDummy&&t.appendHeader(n),t.appendAnnotations(n))}),this.appendUnattachedAnnotations()}},{key:"appendHeader",value:function(t){if(function t(n,e){var r=!0;var o=!1;var i=void 0;try{for(var a,u=n.annotations[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;if(s.layerId===e)return!0}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}var c=!0;var l=!1;var f=void 0;try{for(var d,h=Object.values(n.childNodes)[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var v=d.value;if(t(v,e))return!0}}catch(t){l=!0,f=t}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}return!1}(t,this.options.layerId)){var n=this.createHeaderElem(t);this.options.container.append(n)}}},{key:"appendAnnotations",value:function(t){var n=this.options.annotationRenderer,e=this.options.container,r=!0,o=!1,i=void 0;try{for(var a,u=t.annotations[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;if(s.layerId===this.options.layerId){var c=n.createAnnoElem(s,{pageElem:e,canvasId:e.data("canvasId"),isEditor:this._isEditor});e.append(c)}}}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}}},{key:"appendUnattachedAnnotations",value:function(){this.options.annotationRenderer;if(this.options.toc.numUnassigned()>0){var t=!0,n=!1,e=void 0;try{for(var r,o=this.options.toc.unassigned()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;u.error("AnnotationTocRenderer#appendUnattachedAnnotations unassigned:",i)}}catch(t){n=!0,e=t}finally{try{!t&&o.return&&o.return()}finally{if(n)throw e}}}}},{key:"createHeaderElem",value:function(t){var n=c({text:t.label}),e=jQuery(n).addClass("header-level-"+t.tags.length);return t.tags instanceof Array&&t.tags.length>0||u.error("AnnotationTocRenderer#createHeaderElem invalid tags for node:",t),e.data("tags",t.tags),e}}]),t}();n.default=s;var c=Handlebars.compile(['<div class="annowin_group_header">{{text}}',"</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);var a=(0,((r=i)&&r.__esModule?r:{default:r}).default)(),u=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._annoWin=n.annotationWindow,this._listWidget=n.listWidget,this._groupHeaderHeight=n.groupHeaderHeight,this._continousPages=n.continuousPages,this._rootElem=this._listWidget.getRootElement(),this._nav=this._listWidget.getNav(),this._annoWinDom=this._annoWin.getDomHelper()}return o(t,[{key:"scrollToPage",value:function(t){var n=this,e=this._nav.getPageElement(t).find(".page-header");return this.unbindScrollEvent(),new Promise(function(t,r){n._rootElem.scrollTo(e,{onAfter:function(){n.bindScrollEvent(),t()}})})}},{key:"scrollToTags",value:function(t){a.debug("ScrollHelper#scrollToTags targetTags:",t);var n=null,e=null;this._rootElem.find(".annowin_group_header").each(function(e,r){var o=jQuery(r),i=o.data("tags");if(i instanceof Array&&i.length>0||(a.error("ScrollHelper#scrollToTags invalid tags",i,"for header elem",o[0].outerHTML),i=[]),1===t.length){if(i[0]===t[0])return n=o,!1}else if(i[0]===t[0]&&i[1]===t[1])return n=o,!1}),a.debug("ScrollHelper#scrollToTags targetHeaderElem:",n),n?(e=this._getNextAnnoElem(n))&&this._rootElem.scrollTo(e,{offset:{top:-this._groupHeaderHeight}}):a.warning("ScrollHelper#scrollToTags Header element not found for",t)}},{key:"_getNextAnnoElem",value:function(t){for(var n=t;n.size()>0&&!this._annoWinDom.isAnnotationCell(n);)n=n.next();return n.size()>0?n:null}},{key:"scrollToElem",value:function(t,n){var e=this,r=this._calcOffset(t,n);return this.unbindScrollEvent(),new Promise(function(n,o){e._rootElem.scrollTo(t,{offset:{top:r},onAfter:function(){e.bindScrollEvent(),n()}})})}},{key:"_calcOffset",value:function(t,n){if(void 0===n)return-this._groupHeaderHeight;var e=t.height()-this._rootElem.height();return n<e?e:n}},{key:"scrollToAnnotation",value:function(t,n){a.debug("AnnotationListWidget#scrollToAnnotation annotationId:",t,"yOffset:",n);var e=!0,r=!1,o=void 0;try{for(var i,u=this._listWidget.getAnnotationElems()[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=i.value,c=jQuery(s);if(c.data("annotationId")===t)return this.scrollToElem(c,n)}}catch(t){r=!0,o=t}finally{try{!e&&u.return&&u.return()}finally{if(r)throw o}}}},{key:"scrollDown",value:function(t){this._rootElem.scrollTo("+="+t)}},{key:"scrollUp",value:function(t){this._rootElem.scrollTo("-="+t)}},{key:"_windBack",value:function(){var t=this._rootElem,n=t.scrollTop();0===t[0].scrollHeight-t.scrollTop()-t.height()&&(a.debug("Winding back"),this.unbindScrollEvent(),t.scrollTop(n-5),this.bindScrollEvent())}},{key:"_windForward",value:function(){a.debug("_windForward");var t=this._rootElem,n=t.scrollTop();0===n&&(a.debug("Winding forward"),this.unbindScrollEvent(),t.scrollTop(n+5),this.bindScrollEvent())}},{key:"bindScrollEvent",value:function(){var t,n,e=this;this._continousPages&&this._rootElem.scroll((t=regeneratorRuntime.mark(function t(n){var r,o,i,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e._listWidget,o=jQuery(this),i=o.scrollTop(),a=i+o.height(),u=this.scrollHeight,!(i<20)){t.next=8;break}return t.next=8,r.loadPreviousPage();case 8:if(!(u-a<20)){t.next=11;break}return t.next=11,r.loadNextPage();case 11:case"end":return t.stop()}},t,this)}),n=function(){var n=t.apply(this,arguments);return new Promise(function(t,e){return function r(o,i){try{var a=n[o](i),u=a.value}catch(t){return void e(t)}if(!a.done)return Promise.resolve(u).then(function(t){r("next",t)},function(t){r("throw",t)});t(u)}("next")})},function(t){return n.apply(this,arguments)}))}},{key:"unbindScrollEvent",value:function(){this._continousPages&&this._rootElem.off("scroll")}}]),t}();n.default=u},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),i=e(0);var a=(0,((r=i)&&r.__esModule?r:{default:r}).default)(),u=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._root=jQuery(s({})),n.append(this._root),this._header=this._findOne(this._root,".header"),this._placeHolder=this._findOne(this._root,".placeholder"),this._layerSelectorContainer=this._findOne(this._root,".layer-selector-container"),this._tocTagSelector=this._findOne(this._root,".toc-tag-selector-container"),this._orderConfirm=this._findOne(this._root,".order-confirm"),this._saveOrderButton=this._findOne(this._orderConfirm,".ym_button.save"),this._cancelOrderButton=this._findOne(this._orderConfirm,".ym_button.cancel"),this._toggleDirectionButton=e?this._addToggleDirectionButton():null,this._createWindowButton=this._addCreateWindowButton(),this._listContainer=this._findOne(this._root,".list-container"),this._orderConfirm.hide()}return o(t,[{key:"getRoot",value:function(){return this._root}},{key:"getHeader",value:function(){return this._header}},{key:"getPlaceHolder",value:function(){return this._placeHolder}},{key:"getLayerSelectorContainer",value:function(){return this._layerSelectorContainer}},{key:"getTocTagSelector",value:function(){return this._tocTagSelector}},{key:"getOrderConfirm",value:function(){return this._orderConfirm}},{key:"getSaveOrderButton",value:function(){return this._saveOrderButton}},{key:"getCancelOrderButton",value:function(){return this._cancelOrderButton}},{key:"getCreateWindowButton",value:function(){return this._createWindowButton}},{key:"getToggleDirectionButton",value:function(){return this._toggleDirectionButton}},{key:"getListContainer",value:function(){return this._listContainer}},{key:"getAllAnnotationCells",value:function(){return this.getListContainer().find(".annowin_anno").toArray()}},{key:"_findOne",value:function(t,n){var e=t.find(n);return e.length>0?jQuery(e[0]):null}},{key:"findAnnoListElem",value:function(t){return t.find(".annowin_list")}},{key:"isAnnotationCell",value:function(t){return t.hasClass("annowin_anno")}},{key:"findAnnoElemByAnnoId",value:function(t){var n=!0,e=!1,r=void 0;try{for(var o,i=this.getAllAnnotationCells()[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var a=o.value,u=jQuery(a);if(u.data("annotationId")===t)return u}}catch(t){e=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(e)throw r}}return null}},{key:"updateDirection",value:function(){var t=this._root.hasClass("row-reverse");a.debug("DomHelper#updateDirection rowReverse:",t),t?(this._root.find(".fa-arrows-h").hide(),this._root.find(".fa-arrows-v").show(),this._root.find(".order-down").attr("class","order-down caret left icon"),this._root.find(".order-up").attr("class","order-up caret right icon"),this._root.find(".annowin_anno .ui.dropdown").toggleClass("right",!0)):(this._root.find(".fa-arrows-h").show(),this._root.find(".fa-arrows-v").hide(),this._root.find(".order-down").attr("class","order-down caret down icon"),this._root.find(".order-up").attr("class","order-up caret up icon"),this._root.find(".annowin_anno .ui.dropdown").toggleClass("right",!1))}},{key:"_addCreateWindowButton",value:function(){var t=this._root.find(".annowin_layer_row .right"),n=jQuery("<div/>").addClass("ym_create_window_button").append(jQuery('<i class="fa fa-plus fa-lg fa-fw"></i>'));return t.append(n),n}},{key:"_addToggleDirectionButton",value:function(){var t=this._root.find(".annowin_layer_row .right"),n=jQuery("<div/>").addClass("ym_toggle_direction_button").append(jQuery('<i class="fa fa-arrows-h fa-lg fa-fw"></i>')).append(jQuery('<i class="fa fa-arrows-v fa-lg fa-fw"></i>'));return t.append(n),n.find(".fa-arrows-v").hide(),n}}]),t}();n.default=u;var s=Handlebars.compile(['<div class="ym_annotation_window">','  <div class="header">','    <div class="annowin_layer_row">','      <span class="layer-selector-container"></span>','      <div class="right"></div>',"    </div>",'    <div class="annowin_menu_tag_row">','      <span class="toc-tag-selector-container"></span>',"    </div>",'  <div class="order-confirm">','    <span class="ui small orange button ym_button save">Save new order</span>','    <span class="ui small orange button ym_button cancel">Cancel</span>',"  </div>","  </div>",'  <div class="placeholder"></div>','  <div class="list-container" tabindex="-1">',"  </div>","</div>"].join(""))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),o=u(e(0)),i=u(e(17)),a=u(e(9));function u(t){return t&&t.__esModule?t:{default:t}}var s=(0,o.default)(),c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),s.debug("MenuTagSelector#constructor options:",n),this.options=Object.assign({selector:null,parent:null,tocSpec:null,annotationExplorer:null,changeCallback:null,initialTags:null,depth:1},n),this.init()}return r(t,[{key:"init",value:function(){var t=this;return this.options.initialTags&&(this.options.initialTags=this.options.initialTags.slice(0,this.options.depth)),this.options.selector=new i.default({appendTo:this.options.parent,changeCallback:function(n,e){s.debug("MenuTagSelector select value:",n,"text:",e),"function"==typeof t.options.changeCallback&&t.options.changeCallback(n,e)}}),this.reload()}},{key:"reload",value:function(){var t=this,n=this.options.tocSpec;return new Promise(function(e,r){t.options.selector.empty();var o=t.buildMenu(n,null,0);s.debug("MenuTagSelector menu:",o),t.options.selector.setItems(o);var i=n.generator[0].tag.prefix+"1";setTimeout(function(){var n=t.options.initialTags&&t.options.initialTags.length>0?t.options.initialTags.join("|"):i;s.debug("MenuTagSelector#reload initially setting value to",n),t.options.selector.val(n,!0),e()},0)})}},{key:"val",value:function(t,n){return s.debug("MenuTagSelector#val value:",t,"skipNotify:",n),this.options.selector.val(t,n)}},{key:"buildMenu",value:function(t){for(var n=t.generator[0],e=[],r=1;r<=n.max;++r)e.push({label:n.label.prefix+r,value:n.tag.prefix+r,children:[]});return e}},{key:"buildMenu_old",value:function(t,n,e){if(s.debug("MenuTagSelector#buildMenu node:",t,"parentItem:",n,"currentDepth:",e),e>this.options.depth)return null;var r=this,o=a.default.getValues(t.childNodes).sort(function(t,n){return t.weight-n.weight}),i={children:[]};if(!t.isRoot){var u=n?n.label+", "+t.spec.label:t.spec.label,c=n?n.value+"|"+t.spec.tag:t.spec.tag;i.label=u,i.value=c}return o.length>0&&jQuery.each(o,function(n,o){var a=r.buildMenu(o,t.isRoot?null:i,e+1);a&&i.children.push(a)}),t.isRoot?[{label:"All",value:"all",children:[]}].concat(i.children):i}},{key:"destroy",value:function(){this.options.selector.destroy()}}]),t}();n.default=c},function(t,n,e){"use strict";var r=i(e(4)),o=i(e(12));function i(t){return t&&t.__esModule?t:{default:t}}window.YaleMirador={getApp:r.default,fatalError:o.default}},function(t,n){}]);
//# sourceMappingURL=yale-mirador.bundle.js.map